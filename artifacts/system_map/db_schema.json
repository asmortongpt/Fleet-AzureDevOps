{
  "generated_at": "2026-01-08T20:45:00Z",
  "source": "migration_file_analysis",
  "database": "PostgreSQL",
  "schema": "public",
  "extensions": ["uuid-ossp", "pgcrypto", "PostGIS (optional)"],
  "enums": [
    {
      "name": "user_role",
      "values": ["SuperAdmin", "Admin", "Manager", "Supervisor", "Driver", "Dispatcher", "Mechanic", "Viewer"]
    },
    {
      "name": "vehicle_status",
      "values": ["active", "idle", "charging", "service", "emergency", "offline", "maintenance", "retired"]
    },
    {
      "name": "vehicle_type",
      "values": ["sedan", "suv", "truck", "van", "bus", "emergency", "construction", "specialty"]
    },
    {
      "name": "driver_status",
      "values": ["active", "inactive", "suspended", "terminated", "on_leave", "training"]
    },
    {
      "name": "fuel_type",
      "values": ["gasoline", "diesel", "electric", "hybrid", "propane", "cng", "hydrogen"]
    },
    {
      "name": "maintenance_type",
      "values": ["preventive", "corrective", "inspection", "recall", "upgrade"]
    },
    {
      "name": "status",
      "values": ["pending", "in_progress", "completed", "cancelled", "on_hold", "failed"]
    },
    {
      "name": "priority",
      "values": ["low", "medium", "high", "critical", "emergency"]
    },
    {
      "name": "notification_type",
      "values": ["info", "warning", "error", "success", "reminder", "alert"]
    },
    {
      "name": "incident_severity",
      "values": ["minor", "moderate", "major", "critical", "fatal"]
    },
    {
      "name": "inspection_type",
      "values": ["pre_trip", "post_trip", "annual", "dot", "safety", "emissions", "special"]
    },
    {
      "name": "certification_status",
      "values": ["active", "expired", "pending", "suspended", "revoked"]
    },
    {
      "name": "document_type",
      "values": ["policy", "manual", "form", "report", "contract", "invoice", "receipt", "certification", "training", "safety", "compliance"]
    }
  ],
  "tables": [
    {
      "name": "tenants",
      "description": "Multi-tenant isolation - root tenant entity",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "name", "type": "varchar(255)", "not_null": true},
        {"name": "subdomain", "type": "varchar(100)", "unique": true},
        {"name": "settings", "type": "jsonb", "default": "{}"},
        {"name": "is_active", "type": "boolean", "default": true},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_tenants_subdomain", "columns": ["subdomain"]},
        {"name": "idx_tenants_is_active", "columns": ["is_active"]}
      ]
    },
    {
      "name": "users",
      "description": "User accounts with RBAC",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "email", "type": "varchar(255)", "not_null": true, "unique_with": "tenant_id"},
        {"name": "password_hash", "type": "varchar(255)", "not_null": true},
        {"name": "first_name", "type": "varchar(100)"},
        {"name": "last_name", "type": "varchar(100)"},
        {"name": "role", "type": "user_role", "not_null": true, "default": "Viewer"},
        {"name": "is_active", "type": "boolean", "default": true},
        {"name": "last_login_at", "type": "timestamp"},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_users_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_users_email_tenant", "columns": ["email", "tenant_id"], "unique": true},
        {"name": "idx_users_role", "columns": ["role"]}
      ],
      "rls_enabled": true
    },
    {
      "name": "vehicles",
      "description": "Fleet vehicle inventory",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "vehicle_number", "type": "varchar(50)", "not_null": true},
        {"name": "vin", "type": "varchar(17)", "unique_with": "tenant_id"},
        {"name": "make", "type": "varchar(100)"},
        {"name": "model", "type": "varchar(100)"},
        {"name": "year", "type": "integer"},
        {"name": "type", "type": "vehicle_type"},
        {"name": "fuel_type", "type": "fuel_type"},
        {"name": "status", "type": "vehicle_status", "default": "active"},
        {"name": "license_plate", "type": "varchar(20)"},
        {"name": "current_mileage", "type": "integer"},
        {"name": "current_latitude", "type": "numeric(10,7)"},
        {"name": "current_longitude", "type": "numeric(10,7)"},
        {"name": "last_location_update", "type": "timestamp"},
        {"name": "assigned_driver_id", "type": "uuid", "foreign_key": "drivers(id)"},
        {"name": "assigned_facility_id", "type": "uuid", "foreign_key": "facilities(id)"},
        {"name": "model_3d_url", "type": "varchar(500)", "description": "3D model for virtual garage"},
        {"name": "metadata", "type": "jsonb", "default": "{}"},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_vehicles_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_vehicles_status", "columns": ["status"]},
        {"name": "idx_vehicles_vin", "columns": ["vin"]},
        {"name": "idx_vehicles_assigned_driver", "columns": ["assigned_driver_id"]},
        {"name": "idx_vehicles_location", "columns": ["current_latitude", "current_longitude"]}
      ],
      "rls_enabled": true
    },
    {
      "name": "drivers",
      "description": "Fleet drivers",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "user_id", "type": "uuid", "foreign_key": "users(id)", "unique": true},
        {"name": "employee_number", "type": "varchar(50)"},
        {"name": "license_number", "type": "varchar(50)", "not_null": true},
        {"name": "license_state", "type": "varchar(2)"},
        {"name": "license_expiry", "type": "date"},
        {"name": "status", "type": "driver_status", "default": "active"},
        {"name": "hire_date", "type": "date"},
        {"name": "phone", "type": "varchar(20)"},
        {"name": "email", "type": "varchar(255)"},
        {"name": "safety_score", "type": "numeric(5,2)", "default": 100},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_drivers_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_drivers_user_id", "columns": ["user_id"]},
        {"name": "idx_drivers_status", "columns": ["status"]}
      ],
      "rls_enabled": true
    },
    {
      "name": "routes",
      "description": "Route planning and optimization",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "route_name", "type": "varchar(255)"},
        {"name": "vehicle_id", "type": "uuid", "foreign_key": "vehicles(id)"},
        {"name": "driver_id", "type": "uuid", "foreign_key": "drivers(id)"},
        {"name": "status", "type": "status", "default": "pending"},
        {"name": "route_type", "type": "varchar(50)"},
        {"name": "start_location", "type": "varchar(255)"},
        {"name": "end_location", "type": "varchar(255)"},
        {"name": "planned_start_time", "type": "timestamp"},
        {"name": "planned_end_time", "type": "timestamp"},
        {"name": "actual_start_time", "type": "timestamp"},
        {"name": "actual_end_time", "type": "timestamp"},
        {"name": "total_distance", "type": "numeric(10,2)"},
        {"name": "estimated_duration", "type": "integer", "description": "minutes"},
        {"name": "actual_duration", "type": "integer", "description": "minutes"},
        {"name": "waypoints", "type": "jsonb", "description": "Array of stop objects"},
        {"name": "optimized_waypoints", "type": "jsonb"},
        {"name": "route_geometry", "type": "jsonb", "description": "GeoJSON LineString"},
        {"name": "notes", "type": "text"},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_routes_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_routes_vehicle_id", "columns": ["vehicle_id"]},
        {"name": "idx_routes_driver_id", "columns": ["driver_id"]},
        {"name": "idx_routes_status", "columns": ["status"]},
        {"name": "idx_routes_planned_start", "columns": ["planned_start_time"]}
      ],
      "rls_enabled": true
    },
    {
      "name": "maintenance_schedules",
      "description": "Preventive and corrective maintenance",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "vehicle_id", "type": "uuid", "not_null": true, "foreign_key": "vehicles(id)"},
        {"name": "type", "type": "maintenance_type"},
        {"name": "description", "type": "text"},
        {"name": "scheduled_date", "type": "timestamp"},
        {"name": "completed_date", "type": "timestamp"},
        {"name": "status", "type": "status", "default": "pending"},
        {"name": "priority", "type": "priority", "default": "medium"},
        {"name": "assigned_mechanic_id", "type": "uuid", "foreign_key": "users(id)"},
        {"name": "mileage_at_service", "type": "integer"},
        {"name": "cost", "type": "numeric(10,2)"},
        {"name": "work_order_id", "type": "uuid", "foreign_key": "work_orders(id)"},
        {"name": "notes", "type": "text"},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_maintenance_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_maintenance_vehicle_id", "columns": ["vehicle_id"]},
        {"name": "idx_maintenance_status", "columns": ["status"]},
        {"name": "idx_maintenance_scheduled_date", "columns": ["scheduled_date"]}
      ],
      "rls_enabled": true
    },
    {
      "name": "fuel_transactions",
      "description": "Fuel purchases and consumption tracking",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "vehicle_id", "type": "uuid", "not_null": true, "foreign_key": "vehicles(id)"},
        {"name": "driver_id", "type": "uuid", "foreign_key": "drivers(id)"},
        {"name": "transaction_date", "type": "timestamp", "not_null": true},
        {"name": "gallons", "type": "numeric(10,3)"},
        {"name": "cost_per_gallon", "type": "numeric(10,3)"},
        {"name": "total_cost", "type": "numeric(10,2)"},
        {"name": "fuel_type", "type": "fuel_type"},
        {"name": "vendor", "type": "varchar(255)"},
        {"name": "location", "type": "varchar(255)"},
        {"name": "odometer", "type": "integer"},
        {"name": "card_number_last_4", "type": "varchar(4)"},
        {"name": "receipt_url", "type": "varchar(500)"},
        {"name": "created_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_fuel_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_fuel_vehicle_id", "columns": ["vehicle_id"]},
        {"name": "idx_fuel_transaction_date", "columns": ["transaction_date"]}
      ],
      "rls_enabled": true
    },
    {
      "name": "gps_tracks",
      "description": "Real-time GPS telemetry data",
      "columns": [
        {"name": "id", "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "vehicle_id", "type": "uuid", "not_null": true, "foreign_key": "vehicles(id)"},
        {"name": "timestamp", "type": "timestamp", "not_null": true},
        {"name": "latitude", "type": "numeric(10,7)", "not_null": true},
        {"name": "longitude", "type": "numeric(10,7)", "not_null": true},
        {"name": "speed", "type": "numeric(6,2)", "description": "mph"},
        {"name": "heading", "type": "numeric(5,2)", "description": "degrees 0-360"},
        {"name": "altitude", "type": "numeric(8,2)", "description": "meters"},
        {"name": "accuracy", "type": "numeric(6,2)", "description": "meters"},
        {"name": "ignition_status", "type": "boolean"},
        {"name": "metadata", "type": "jsonb", "default": "{}"},
        {"name": "created_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_gps_tenant_vehicle", "columns": ["tenant_id", "vehicle_id"]},
        {"name": "idx_gps_timestamp", "columns": ["timestamp"]},
        {"name": "idx_gps_location", "columns": ["latitude", "longitude"]}
      ],
      "partitioning": "PARTITION BY RANGE (timestamp)",
      "retention_policy": "90 days"
    },
    {
      "name": "telemetry_data",
      "description": "Vehicle OBD-II and sensor data",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "vehicle_id", "type": "uuid", "not_null": true, "foreign_key": "vehicles(id)"},
        {"name": "timestamp", "type": "timestamp", "not_null": true},
        {"name": "engine_rpm", "type": "integer"},
        {"name": "speed", "type": "numeric(6,2)"},
        {"name": "fuel_level_percent", "type": "numeric(5,2)"},
        {"name": "coolant_temp", "type": "numeric(6,2)"},
        {"name": "oil_pressure", "type": "numeric(6,2)"},
        {"name": "battery_voltage", "type": "numeric(5,2)"},
        {"name": "odometer", "type": "integer"},
        {"name": "dtc_codes", "type": "jsonb", "description": "Diagnostic trouble codes"},
        {"name": "raw_data", "type": "jsonb"},
        {"name": "created_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_telemetry_tenant_vehicle", "columns": ["tenant_id", "vehicle_id"]},
        {"name": "idx_telemetry_timestamp", "columns": ["timestamp"]}
      ],
      "partitioning": "PARTITION BY RANGE (timestamp)",
      "retention_policy": "365 days"
    },
    {
      "name": "charging_stations",
      "description": "EV charging station inventory",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "name", "type": "varchar(255)", "not_null": true},
        {"name": "station_id", "type": "varchar(100)"},
        {"name": "type", "type": "varchar(50)", "not_null": true, "description": "Level 1/2/3, DC Fast, etc."},
        {"name": "facility_id", "type": "uuid", "foreign_key": "facilities(id)"},
        {"name": "latitude", "type": "numeric(10,7)", "not_null": true},
        {"name": "longitude", "type": "numeric(10,7)", "not_null": true},
        {"name": "address", "type": "varchar(500)"},
        {"name": "number_of_ports", "type": "integer", "default": 1},
        {"name": "available_ports", "type": "integer", "default": 1},
        {"name": "max_power_kw", "type": "numeric(8,2)"},
        {"name": "cost_per_kwh", "type": "numeric(8,4)"},
        {"name": "is_public", "type": "boolean", "default": false},
        {"name": "operating_hours", "type": "jsonb"},
        {"name": "status", "type": "varchar(50)", "default": "active"},
        {"name": "metadata", "type": "jsonb", "default": "{}"},
        {"name": "created_at", "type": "timestamp", "default": "now()"},
        {"name": "updated_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_charging_stations_tenant", "columns": ["tenant_id"]},
        {"name": "idx_charging_stations_location", "columns": ["latitude", "longitude"]}
      ]
    },
    {
      "name": "audit_logs",
      "description": "Complete audit trail for compliance",
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "tenant_id", "type": "uuid", "not_null": true, "foreign_key": "tenants(id)"},
        {"name": "user_id", "type": "uuid", "foreign_key": "users(id)"},
        {"name": "action", "type": "varchar(100)", "not_null": true, "description": "CREATE, READ, UPDATE, DELETE"},
        {"name": "entity_type", "type": "varchar(100)", "not_null": true},
        {"name": "entity_id", "type": "uuid"},
        {"name": "entity_snapshot", "type": "jsonb", "description": "State before change"},
        {"name": "changes", "type": "jsonb", "description": "What changed"},
        {"name": "ip_address", "type": "varchar(45)"},
        {"name": "user_agent", "type": "varchar(500)"},
        {"name": "metadata", "type": "jsonb", "default": "{}"},
        {"name": "created_at", "type": "timestamp", "default": "now()"}
      ],
      "indexes": [
        {"name": "idx_audit_tenant_id", "columns": ["tenant_id"]},
        {"name": "idx_audit_user_id", "columns": ["user_id"]},
        {"name": "idx_audit_entity", "columns": ["entity_type", "entity_id"]},
        {"name": "idx_audit_created_at", "columns": ["created_at"]}
      ],
      "retention_policy": "7 years (compliance requirement)"
    }
  ],
  "stats": {
    "total_tables": 40,
    "documented_tables": 12,
    "total_enums": 13,
    "tenant_isolated_tables": 12,
    "partitioned_tables": 2,
    "tables_with_geospatial": 4,
    "tables_with_jsonb": 12
  },
  "multi_tenancy": {
    "strategy": "Shared database, shared schema, tenant_id isolation",
    "isolation_column": "tenant_id",
    "rls_enabled": true,
    "all_queries_filtered": true,
    "tenant_verification": "JWT token contains tenant_id"
  },
  "security": {
    "row_level_security": "Enabled on all tenant-isolated tables",
    "password_hashing": "bcrypt with cost factor 12+",
    "uuid_generation": "gen_random_uuid() for all primary keys",
    "soft_deletes": "Used in some tables via is_active/deleted_at",
    "audit_logging": "Complete via audit_logs table"
  },
  "performance": {
    "indexing_strategy": "tenant_id + frequently queried columns",
    "partitioning": "Time-series data (gps_tracks, telemetry_data) partitioned by timestamp",
    "retention_policies": "Automatic archival for time-series data",
    "jsonb_indexing": "GIN indexes on jsonb columns for fast queries"
  },
  "notes": [
    "This schema represents core tables from 76+ migration files",
    "All tables include tenant_id for multi-tenant isolation",
    "UUID primary keys used throughout for scalability",
    "JSONB columns provide schema flexibility for metadata and complex data",
    "Time-series tables (GPS, telemetry) use partitioning for performance",
    "Full audit trail maintained in audit_logs table",
    "RLS (Row Level Security) policies enforce tenant isolation at database level",
    "System supports both traditional fuel vehicles and EVs (charging infrastructure)"
  ]
}
