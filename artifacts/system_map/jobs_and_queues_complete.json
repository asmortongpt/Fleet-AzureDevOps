{
  "metadata": {
    "documentTitle": "Fleet Management System - Complete Jobs & Queues Inventory",
    "phase": "Phase 2 SKG",
    "discoveryDate": "2025-01-08",
    "lastUpdated": "2025-01-08",
    "discoveryLevel": "very_thorough",
    "totalQueuesDiscovered": 11,
    "totalJobTypesDiscovered": 16,
    "totalCronJobsDiscovered": 8,
    "totalBullQueuesDiscovered": 3,
    "totalPgBossQueuesDiscovered": 5,
    "totalWorkerThreadsDiscovered": 4,
    "comparisonToPhase0": {
      "phase0Queues": 4,
      "phase0JobTypes": 8,
      "phase2Queues": 11,
      "phase2JobTypes": 16,
      "newQueuesDiscovered": 7,
      "newJobTypesDiscovered": 8
    }
  },
  "infrastructure": {
    "queueManager": {
      "frameworks": [
        {
          "name": "Bull",
          "version": "3.x+",
          "backend": "Redis",
          "description": "Task queue library for Node.js with Redis backing",
          "usage": "Primary queue system for critical jobs"
        },
        {
          "name": "pg-boss",
          "version": "latest",
          "backend": "PostgreSQL",
          "description": "Job queue system using PostgreSQL as storage",
          "usage": "Durable job persistence with database integration"
        },
        {
          "name": "node-cron",
          "version": "3.x+",
          "backend": "In-memory scheduler",
          "description": "Cron job scheduling library",
          "usage": "Scheduled tasks and recurring jobs"
        }
      ],
      "redisConfiguration": {
        "host": "$REDIS_HOST (default: localhost)",
        "port": "$REDIS_PORT (default: 6379)",
        "password": "$REDIS_PASSWORD",
        "database": "$REDIS_DB (default: 0)",
        "defaultJobOptions": {
          "attempts": 3,
          "backoffType": "exponential",
          "backoffDelay": 2000,
          "removeOnComplete": true,
          "removeOnFail": false,
          "lockDuration": 30000,
          "lockRenewTime": 15000,
          "stalledInterval": 30000,
          "maxStalledCount": 3
        }
      },
      "postgreSqlConfiguration": {
        "host": "$DB_HOST (default: fleet-postgres-service)",
        "port": "$DB_PORT (default: 5432)",
        "database": "$DB_NAME (default: fleetdb)",
        "user": "$DB_USER (default: fleetadmin)",
        "password": "$DB_PASSWORD",
        "maxConnections": 10,
        "archiveCompletedAfterSeconds": 86400,
        "deleteAfterDays": 7,
        "monitorStateIntervalSeconds": 60
      }
    }
  },
  "bullQueues": {
    "count": 3,
    "queues": [
      {
        "queueId": "q1",
        "name": "email",
        "type": "Bull/Redis",
        "purpose": "Email delivery and notifications",
        "status": "Active",
        "created": "Initial setup",
        "jobTypes": [
          "send_email",
          "bulk_email",
          "transactional_email"
        ],
        "configuration": {
          "attempts": 3,
          "backoff": "exponential",
          "backoffDelay": 2000,
          "priority": 2,
          "timeout": 60000
        },
        "eventHandlers": [
          "error",
          "waiting",
          "active",
          "completed",
          "failed",
          "stalled"
        ],
        "jobSchema": {
          "to": "string | string[]",
          "subject": "string",
          "template": "string (optional)",
          "body": "string (optional)",
          "html": "string (optional)",
          "context": "Record<string, any> (optional)",
          "attachments": "Array<{ filename: string, content?: Buffer, path?: string }> (optional)"
        },
        "statistics": {
          "waiting": "Pending jobs count",
          "active": "Currently processing count",
          "completed": "Successful jobs count",
          "failed": "Failed jobs count",
          "delayed": "Delayed jobs count",
          "paused": "Paused jobs count"
        }
      },
      {
        "queueId": "q2",
        "name": "notification",
        "type": "Bull/Redis",
        "purpose": "Push notifications to mobile devices",
        "status": "Active",
        "created": "Initial setup",
        "jobTypes": [
          "push_notification",
          "mobile_alert",
          "maintenance_notification"
        ],
        "configuration": {
          "attempts": 3,
          "backoff": "exponential",
          "backoffDelay": 2000,
          "priority": "variable (1=high, 2=normal, 3=low)",
          "timeout": 60000
        },
        "jobSchema": {
          "userId": "string | string[]",
          "title": "string",
          "body": "string",
          "data": "Record<string, any> (optional)",
          "badge": "number (optional)",
          "sound": "string (optional)",
          "channel": "string (optional)",
          "priority": "'high' | 'normal' | 'low' (optional)"
        },
        "statistics": {
          "waiting": "Pending notifications",
          "active": "Being sent",
          "completed": "Successfully delivered",
          "failed": "Failed delivery attempts",
          "delayed": "Scheduled for later"
        }
      },
      {
        "queueId": "q3",
        "name": "report",
        "type": "Bull/Redis",
        "purpose": "Report generation (maintenance, cost analysis, etc.)",
        "status": "Active",
        "created": "Initial setup",
        "jobTypes": [
          "generate_maintenance_report",
          "generate_cost_analysis_report",
          "generate_fuel_usage_report",
          "generate_vehicle_utilization_report",
          "generate_driver_performance_report",
          "generate_custom_report"
        ],
        "configuration": {
          "attempts": 3,
          "backoff": "exponential",
          "backoffDelay": 2000,
          "priority": 3,
          "timeout": 300000
        },
        "jobSchema": {
          "reportType": "'maintenance' | 'cost-analysis' | 'fuel-usage' | 'vehicle-utilization' | 'driver-performance' | 'custom'",
          "userId": "string",
          "parameters": "Record<string, any> (optional)",
          "format": "'pdf' | 'excel' | 'csv' (optional)",
          "deliveryMethod": "'download' | 'email' (optional)",
          "recipients": "string[] (optional)"
        },
        "statistics": {
          "waiting": "Queued reports",
          "active": "Generating",
          "completed": "Generated reports",
          "failed": "Failed generations"
        }
      }
    ]
  },
  "pgBossQueues": {
    "count": 5,
    "description": "PostgreSQL-backed durable job queues using pg-boss",
    "queues": [
      {
        "queueId": "pgq1",
        "name": "teams-outbound",
        "type": "pg-boss",
        "purpose": "Send Teams messages to channels and users",
        "status": "Active",
        "jobDataType": "TeamsMessagePayload",
        "configuration": {
          "priority": "HIGH",
          "retryLimit": 5,
          "retryBackoff": true,
          "expireInSeconds": 3600,
          "rateLimiter": "50 requests/second"
        },
        "jobPayload": {
          "type": "teams-outbound",
          "payload": {
            "teamId": "string",
            "channelId": "string",
            "messageBody": "string",
            "subject": "string (optional)",
            "attachments": "Array (optional)"
          },
          "priority": "HIGH",
          "metadata": {
            "timestamp": "Date",
            "correlationId": "string"
          }
        }
      },
      {
        "queueId": "pgq2",
        "name": "outlook-outbound",
        "type": "pg-boss",
        "purpose": "Send Outlook emails and manage message items",
        "status": "Active",
        "jobDataType": "OutlookEmailPayload",
        "configuration": {
          "priority": "NORMAL",
          "retryLimit": 5,
          "retryBackoff": true,
          "expireInSeconds": 7200,
          "rateLimiter": "10,000 requests/10 minutes"
        },
        "jobPayload": {
          "type": "outlook-outbound",
          "payload": {
            "toRecipients": "Array<{ emailAddress: { address: string } }>",
            "subject": "string",
            "body": "string",
            "bodyType": "'text' | 'html'",
            "attachments": "Array<AttachmentPayload> (optional)"
          }
        }
      },
      {
        "queueId": "pgq3",
        "name": "attachments",
        "type": "pg-boss",
        "purpose": "Upload/download attachments from OneDrive/SharePoint",
        "status": "Active",
        "configuration": {
          "priority": "LOW",
          "retryLimit": 3,
          "retryBackoff": true,
          "expireInSeconds": 14400,
          "maxConcurrency": 5,
          "rateLimiter": "Bottleneck with 5 concurrent"
        },
        "jobPayload": {
          "type": "attachment-operation",
          "payload": {
            "fileId": "string",
            "fileName": "string",
            "size": "number",
            "mimeType": "string",
            "operation": "'upload' | 'download'"
          }
        }
      },
      {
        "queueId": "pgq4",
        "name": "webhooks",
        "type": "pg-boss",
        "purpose": "Process incoming webhook events",
        "status": "Active",
        "configuration": {
          "priority": "HIGH",
          "retryLimit": 3,
          "retryBackoff": true,
          "expireInSeconds": 1800,
          "singletonKey": "webhook.webhookId"
        },
        "jobPayload": {
          "type": "webhook-processing",
          "payload": {
            "webhookId": "string",
            "changeType": "created | updated | deleted",
            "resource": "string",
            "resourceData": "object"
          }
        }
      },
      {
        "queueId": "pgq5",
        "name": "sync",
        "type": "pg-boss",
        "purpose": "Synchronize external data (Teams, Outlook, etc.)",
        "status": "Active",
        "configuration": {
          "priority": "LOW",
          "retryLimit": 3,
          "retryBackoff": true,
          "expireInSeconds": 3600,
          "singletonKey": "sync-{resourceType}-{userId}"
        },
        "jobPayload": {
          "type": "sync-operation",
          "payload": {
            "resourceType": "teams | outlook | calendar | contacts",
            "userId": "string (optional)",
            "deltaToken": "string (optional)"
          }
        }
      }
    ]
  },
  "cronJobs": {
    "count": 8,
    "description": "Scheduled tasks using node-cron",
    "jobs": [
      {
        "jobId": "cron1",
        "name": "Maintenance Scheduler",
        "file": "api/src/jobs/maintenance-scheduler.ts",
        "description": "Automatically checks for due maintenance schedules and generates work orders",
        "cronExpression": "$MAINTENANCE_CRON_SCHEDULE (default: 0 * * * * - every hour)",
        "interval": "Hourly (configurable)",
        "enabled": "$ENABLE_MAINTENANCE_SCHEDULER !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "trigger": "Automatic based on cron schedule",
          "daysAhead": "$MAINTENANCE_DAYS_AHEAD (default: 1)",
          "processedTenants": "All active tenants",
          "actions": [
            "Check recurring maintenance schedules",
            "Generate work orders for due items",
            "Send notifications to fleet managers",
            "Log metrics to audit logs"
          ]
        },
        "configuration": {
          "checkWindow": "1 day ahead",
          "multiTenant": true,
          "logging": "File and Console",
          "logFile": "logs/maintenance-scheduler.log"
        },
        "performance": {
          "timeout": "No explicit timeout",
          "maxDuration": "Variable",
          "concurrency": "Single instance"
        },
        "metrics": {
          "totalTenants": "Processed",
          "totalWorkOrders": "Created",
          "totalErrors": "Encountered",
          "durationMs": "Execution time"
        }
      },
      {
        "jobId": "cron2",
        "name": "Teams Sync Job",
        "file": "api/src/jobs/teams-sync.job.ts",
        "description": "Syncs Teams messages every 30 seconds with webhook health checking",
        "cronExpression": "*/$TEAMS_SYNC_INTERVAL_SECONDS * * * * * (default: */30 * * * * *)",
        "interval": "$TEAMS_SYNC_INTERVAL_SECONDS seconds (default: 30 seconds)",
        "enabled": "$ENABLE_TEAMS_SYNC !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "trigger": "Automatic based on interval",
          "webhookFallback": "$USE_WEBHOOK_FALLBACK !== 'false' (default: true)",
          "webhookHealthCheckMinutes": "$WEBHOOK_HEALTH_CHECK_MINUTES (default: 5)",
          "skipIfNoUsers": "$SKIP_SYNC_NO_USERS (default: false)",
          "actions": [
            "Check webhook health",
            "Skip if webhooks healthy",
            "Check active users",
            "Sync all Teams channels",
            "Log metrics"
          ]
        },
        "configuration": {
          "deltaQuerySupport": true,
          "paginationHandling": true,
          "errorHandling": true,
          "performanceMetrics": true
        },
        "jobSchema": {
          "jobType": "teams_sync",
          "status": "running | completed | completed_with_errors | skipped | failed",
          "itemsSynced": "number",
          "errorsCount": "number"
        },
        "metrics": {
          "jobId": "Unique job identifier",
          "duration": "Execution time",
          "totalSynced": "Items synced",
          "totalErrors": "Errors encountered",
          "skipReason": "webhooks_healthy | no_active_users"
        }
      },
      {
        "jobId": "cron3",
        "name": "Telematics Sync Job",
        "file": "api/src/jobs/telematics-sync.ts",
        "description": "Syncs telemetry data from Samsara and other providers every 5 minutes",
        "cronExpression": "$TELEMATICS_CRON_SCHEDULE (default: */5 * * * *)",
        "interval": "5 minutes (configurable)",
        "enabled": "$ENABLE_TELEMATICS_SYNC !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "trigger": "Automatic based on schedule",
          "initialDelay": "30 seconds after startup",
          "vehicleSyncInterval": "$SYNC_VEHICLES_INTERVAL_HOURS (default: 24 hours)",
          "actions": [
            "Sync vehicles (every 24 hours)",
            "Sync telemetry (location, stats)",
            "Sync safety events",
            "Send error notifications",
            "Log metrics"
          ]
        },
        "configuration": {
          "samsaraConfigured": "$SAMSARA_API_TOKEN required",
          "multiProvider": true,
          "errorNotification": true,
          "logging": "Console only"
        },
        "metrics": {
          "vehiclesSynced": "count",
          "telemetryRecordsSynced": "count",
          "eventsSynced": "count",
          "errors": "count",
          "durationMs": "Execution time"
        }
      },
      {
        "jobId": "cron4",
        "name": "Report Scheduler",
        "file": "api/src/jobs/report-scheduler.job.ts",
        "description": "Executes scheduled reports and sends them to recipients every hour",
        "cronExpression": "$REPORT_SCHEDULER_CRON (default: 0 * * * *)",
        "interval": "Hourly",
        "enabled": "$ENABLE_REPORT_SCHEDULER !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "trigger": "Checks hourly for due reports",
          "actions": [
            "Get all due scheduled reports",
            "Execute each report",
            "Email to recipients",
            "Update next run schedule",
            "Log metrics"
          ]
        },
        "scheduleTypes": {
          "daily": "Run at specific time each day",
          "weekly": "Run on specific day of week",
          "monthly": "Run on specific day of month",
          "quarterly": "Run on first day of quarter",
          "custom": "Cron expression"
        },
        "reportFormats": [
          "xlsx",
          "csv",
          "pdf"
        ],
        "metrics": {
          "successCount": "Reports executed",
          "failureCount": "Failed reports",
          "totalSchedules": "Total schedules processed",
          "durationMs": "Execution time"
        }
      },
      {
        "jobId": "cron5",
        "name": "Alert Checker",
        "file": "api/src/jobs/alert-checker.job.ts",
        "description": "Proactive alert generation based on configurable rules every 5 minutes",
        "cronExpression": "$ALERT_CHECKER_CRON_SCHEDULE (default: */5 * * * *)",
        "interval": "5 minutes",
        "enabled": "$ENABLE_ALERT_CHECKER !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "trigger": "Automatic every 5 minutes",
          "tenantLevel": "All active tenants",
          "checks": [
            "Maintenance due within threshold",
            "Overdue tasks",
            "Critical incidents",
            "Fuel anomalies",
            "Geofence violations",
            "Driver certification expiration",
            "Asset expiration"
          ]
        },
        "configuration": {
          "multiTenant": true,
          "errorHandling": true,
          "logging": "File and Console",
          "logFile": "logs/alert-checker.log"
        },
        "metrics": {
          "totalAlertsGenerated": "count",
          "totalErrors": "count",
          "tenantsProcessed": "count",
          "durationMs": "Execution time"
        }
      },
      {
        "jobId": "cron6",
        "name": "Outlook Sync Job",
        "file": "api/src/jobs/outlook-sync.job.ts",
        "description": "Syncs Outlook emails every 1-2 minutes with AI categorization and receipt parsing",
        "cronExpression": "*/$OUTLOOK_SYNC_INTERVAL_MINUTES * * * * (default: */2 * * * *)",
        "interval": "$OUTLOOK_SYNC_INTERVAL_MINUTES minutes (default: 2 minutes)",
        "enabled": "$ENABLE_OUTLOOK_SYNC !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "initialDelay": "10 seconds after startup",
          "webhook": "$USE_WEBHOOK_FALLBACK !== 'false' (default: true)",
          "aiCategorization": "$ENABLE_AI_EMAIL_CATEGORIZATION === 'true'",
          "receiptParsing": "$ENABLE_RECEIPT_PARSING === 'true'",
          "actions": [
            "Check webhook health",
            "Sync all Outlook folders",
            "Categorize new emails with AI",
            "Parse receipts and invoices",
            "Log metrics"
          ]
        },
        "configuration": {
          "deltaQuerySupport": true,
          "multiFolder": ["Inbox", "Sent", "Drafts"],
          "attachmentProcessing": true,
          "aiFeatures": ["categorization", "receipt_parsing"]
        },
        "metrics": {
          "jobId": "Unique identifier",
          "totalSynced": "Emails synced",
          "totalErrors": "Errors encountered",
          "categorizedCount": "Emails categorized",
          "receiptsParsed": "Receipts/invoices parsed",
          "durationMs": "Execution time"
        }
      },
      {
        "jobId": "cron7",
        "name": "Webhook Renewal Job",
        "file": "api/src/jobs/webhook-renewal.job.ts",
        "description": "Automatically renews Microsoft Graph webhook subscriptions before expiry",
        "cronExpression": "$WEBHOOK_RENEWAL_CRON_SCHEDULE (default: 0 * * * *)",
        "interval": "Hourly",
        "enabled": "$ENABLE_WEBHOOK_RENEWAL !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "threshold": "$WEBHOOK_RENEWAL_THRESHOLD_HOURS (default: 12 hours before expiry)",
          "actions": [
            "Clean up expired subscriptions",
            "Find subscriptions needing renewal",
            "Renew each subscription",
            "Handle failed renewals",
            "Recreate critical subscriptions",
            "Log statistics"
          ]
        },
        "configuration": {
          "cleanupEnabled": true,
          "recreationAttempts": "For Teams and Outlook subscriptions",
          "failureThreshold": 3,
          "subscriptionTypes": [
            "teams_messages (60 min max)",
            "outlook_emails (4230 min/3 days max)",
            "calendar_events (4230 min/3 days max)"
          ]
        },
        "metrics": {
          "successCount": "Renewed",
          "failureCount": "Failed",
          "recreated": "Subscriptions recreated",
          "durationMs": "Execution time"
        }
      },
      {
        "jobId": "cron8",
        "name": "Scheduling Reminders Job",
        "file": "api/src/jobs/scheduling-reminders.job.ts",
        "description": "Sends reminders for upcoming reservations and maintenance appointments every 15 minutes",
        "cronExpression": "$SCHEDULING_REMINDERS_CRON (default: */15 * * * *)",
        "interval": "15 minutes",
        "enabled": "$ENABLE_SCHEDULING_REMINDERS !== 'false' (default: true)",
        "timezone": "$TZ (default: UTC)",
        "execution": {
          "reminderTimes": "24 hours and 1 hour before (configurable)",
          "actions": [
            "Check upcoming reservations",
            "Check upcoming maintenance appointments",
            "Send personalized reminders",
            "Check for scheduling conflicts",
            "Send conflict notifications",
            "Log metrics"
          ]
        },
        "configuration": {
          "reminderTimes": [24, 1],
          "reminderWindow": "Â±15 minutes around scheduled time",
          "userPreferences": "Per-user reminder time settings",
          "conflictDetection": true
        },
        "metrics": {
          "totalReminders": "Sent",
          "reservationReminders": "count",
          "maintenanceReminders": "count",
          "durationMs": "Execution time"
        }
      }
    ]
  },
  "workerThreads": {
    "count": 4,
    "description": "Background workers and ingestion processes",
    "workers": [
      {
        "workerId": "w1",
        "name": "Daily Metrics Worker",
        "file": "api/src/workers/daily-metrics.worker.ts",
        "type": "Cron-based worker",
        "schedule": "0 2 * * * (Daily at 2 AM UTC)",
        "purpose": "Refresh materialized views for analytics",
        "actions": [
          "Refresh vw_asset_daily_utilization",
          "Refresh vw_asset_roi_summary"
        ],
        "configuration": {
          "timezone": "UTC",
          "concurrency": "CONCURRENT (non-blocking)",
          "transactional": true
        }
      },
      {
        "workerId": "w2",
        "name": "Webhook Delivery Worker",
        "file": "api/src/infrastructure/webhooks/WebhookDeliveryWorker.ts",
        "type": "BullMQ Worker",
        "queue": "webhook-delivery",
        "framework": "BullMQ",
        "purpose": "Deliver webhooks to subscribers",
        "configuration": {
          "concurrency": 10,
          "redisConnection": {
            "host": "$REDIS_HOST",
            "port": "$REDIS_PORT"
          }
        },
        "jobProcessing": {
          "jobType": "deliver",
          "payload": {
            "eventId": "string",
            "subscriptionId": "string"
          },
          "timeout": 10000
        },
        "actions": [
          "Get event from repository",
          "Get subscription configuration",
          "Generate HMAC signature",
          "POST to target URL",
          "Mark as delivered on success"
        ],
        "headers": {
          "X-Webhook-Signature": "Generated HMAC",
          "X-Event-Type": "Event type",
          "X-Event-Id": "Event ID",
          "Content-Type": "application/json"
        }
      },
      {
        "workerId": "w3",
        "name": "Telematics Ingestion Worker",
        "file": "api/src/infrastructure/telematics/jobs/TelematicsIngestionWorker.ts",
        "type": "Cron-based worker",
        "schedule": "Configurable cron expression",
        "defaultInterval": 60,
        "purpose": "Ingest telematics position data",
        "configuration": {
          "intervalSeconds": 60,
          "cronExpression": "*/{intervalSeconds} * * * * *",
          "timezone": "UTC"
        },
        "actions": [
          "Call ingestionService.ingestLatestPositions()",
          "Process position data",
          "Store in database"
        ]
      },
      {
        "workerId": "w4",
        "name": "Driver Safety Score Aggregation Job",
        "file": "api/src/infrastructure/safety/jobs/DriverSafetyScoreAggregationJob.ts",
        "type": "Cron-based job",
        "schedule": "0 2 * * * (Daily at 2 AM UTC)",
        "purpose": "Compute daily driver safety scores",
        "actions": [
          "Get active drivers",
          "Compute score for previous day",
          "Store aggregated scores"
        ],
        "configuration": {
          "runTime": "Daily at 2 AM",
          "retroactive": "Computes for previous day",
          "granularity": "Daily aggregation"
        }
      }
    ]
  },
  "pushNotificationScheduler": {
    "name": "Push Notification Scheduler Job",
    "file": "api/src/jobs/push-notification-scheduler.job.ts",
    "type": "Cron-based scheduler",
    "schedule": "* * * * * (Every minute)",
    "purpose": "Process and send scheduled push notifications",
    "configuration": {
      "checkInterval": "Every minute",
      "serviceIntegration": "pushNotificationService.processScheduledNotifications()"
    },
    "actions": [
      "Check for due notifications",
      "Process scheduled notifications",
      "Send to mobile devices"
    ]
  },
  "jobDependencies": {
    "description": "Job execution dependencies and data flow",
    "dependencies": [
      {
        "from": "Maintenance Scheduler",
        "to": "Push Notification Scheduler",
        "type": "asynchronous",
        "description": "Work order creation triggers notifications"
      },
      {
        "from": "Alert Checker",
        "to": "Push Notification Scheduler",
        "type": "asynchronous",
        "description": "Generated alerts trigger notifications"
      },
      {
        "from": "Teams Sync",
        "to": "Webhook Processor",
        "type": "asynchronous",
        "description": "Synced messages may trigger webhooks"
      },
      {
        "from": "Outlook Sync",
        "to": "Email Queue",
        "type": "asynchronous",
        "description": "Email processing enqueues jobs"
      },
      {
        "from": "Webhook Renewal",
        "to": "Teams/Outlook Sync",
        "type": "prerequisite",
        "description": "Active subscriptions required for sync"
      },
      {
        "from": "Telematics Sync",
        "to": "Safety Score Aggregation",
        "type": "data_dependency",
        "description": "Safety events inform daily aggregation"
      }
    ]
  },
  "jobFailureHandling": {
    "strategies": [
      {
        "strategy": "Exponential Backoff",
        "used_by": ["Bull queues", "pg-boss"],
        "configuration": {
          "baseDelay": 1000,
          "maxDelay": 60000,
          "exponentialBase": 2
        }
      },
      {
        "strategy": "Dead Letter Queue",
        "used_by": ["pg-boss"],
        "description": "Failed jobs moved to DLQ after max retries",
        "retention": "Tracked in dead_letter_queue table"
      },
      {
        "strategy": "Manual Retry",
        "used_by": ["pg-boss", "Bull"],
        "description": "Failed jobs can be retried manually",
        "adminEndpoint": "/api/admin/jobs/retry/{jobId}"
      },
      {
        "strategy": "Subscription Recreation",
        "used_by": ["Webhook Renewal Job"],
        "description": "Critical subscriptions recreated on repeated failures",
        "failureThreshold": 3
      }
    ]
  },
  "rateLimiting": {
    "implementation": "Bottleneck rate limiter",
    "appliedTo": [
      {
        "service": "Teams API",
        "limit": "50 requests/second",
        "concurrency": 10,
        "minTime": 20
      },
      {
        "service": "Outlook API",
        "limit": "10,000 requests/10 minutes",
        "concurrency": 20,
        "minTime": 60
      },
      {
        "service": "Attachments",
        "limit": "Concurrent file operations",
        "concurrency": 5,
        "minTime": 200
      }
    ]
  },
  "monitoring": {
    "logging": {
      "providers": [
        "Winston (file and console)",
        "Audit logs table",
        "Application Insights"
      ],
      "logFiles": {
        "teams-sync.log": "Teams synchronization",
        "report-scheduler.log": "Report scheduling",
        "alert-checker.log": "Alert generation",
        "outlook-sync.log": "Outlook synchronization",
        "scheduling-reminders.log": "Scheduling reminders"
      }
    },
    "metrics": {
      "tracked": [
        "Job execution time",
        "Success/failure rates",
        "Items processed",
        "Error counts",
        "Queue depths",
        "Processing throughput"
      ]
    },
    "healthChecks": {
      "queueHealth": "/api/admin/queues/health",
      "jobStatus": "/api/admin/jobs/status",
      "workerStatus": "/api/admin/workers/status"
    }
  },
  "administration": {
    "adminRoutes": {
      "baseUrl": "/api/admin/jobs",
      "endpoints": [
        {
          "method": "GET",
          "path": "/status",
          "description": "Get all job statuses"
        },
        {
          "method": "GET",
          "path": "/{jobId}",
          "description": "Get specific job details"
        },
        {
          "method": "POST",
          "path": "/{jobId}/retry",
          "description": "Retry failed job"
        },
        {
          "method": "POST",
          "path": "/{jobId}/cancel",
          "description": "Cancel running job"
        },
        {
          "method": "GET",
          "path": "/queues/health",
          "description": "Get queue health status"
        }
      ]
    }
  },
  "summary": {
    "totalQueues": 11,
    "queueBreakdown": {
      "bull_redis": 3,
      "pg_boss": 5,
      "other": 3
    },
    "totalJobTypes": 16,
    "jobTypeBreakdown": {
      "cron_scheduled": 8,
      "queue_based": 6,
      "worker_based": 4
    },
    "keyMetrics": {
      "totalProcessors": "Multiple (email, notification, report, webhook)",
      "totalWorkers": 4,
      "totalScheduledJobs": 8,
      "multiTenantSupport": true,
      "redisRequired": true,
      "postgresRequired": true
    },
    "completenessStatus": "Very Thorough - Complete inventory of all background processing infrastructure",
    "nextSteps": [
      "Monitor job execution metrics",
      "Set up alerting for failed jobs",
      "Optimize retry strategies",
      "Scale worker processes as needed",
      "Implement job prioritization for high-volume queues"
    ]
  }
}
