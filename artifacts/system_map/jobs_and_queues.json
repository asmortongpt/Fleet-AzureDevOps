{
  "generated_at": "2026-01-08T20:49:00Z",
  "source": "static_analysis",
  "queue_system": "Bull (Redis-backed job queue)",
  "queues": [
    {
      "name": "emailQueue",
      "file": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/jobs/queue.ts",
      "description": "Process email notifications",
      "processor": "email.processor.ts",
      "processor_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/jobs/processors/email.processor.ts",
      "concurrency": 5,
      "retry_attempts": 3,
      "retry_delay": "exponential backoff"
    },
    {
      "name": "notificationQueue",
      "file": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/jobs/queue.ts",
      "description": "Process push notifications and SMS",
      "processor": "notification.processor.ts",
      "processor_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/jobs/processors/notification.processor.ts",
      "concurrency": 10,
      "retry_attempts": 3,
      "retry_delay": "exponential backoff"
    },
    {
      "name": "reportQueue",
      "file": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/jobs/queue.ts",
      "description": "Generate and export reports",
      "processor": "report.processor.ts",
      "processor_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/jobs/processors/report.processor.ts",
      "concurrency": 2,
      "retry_attempts": 2,
      "priority_supported": true
    }
  ],
  "job_types": [
    {
      "id": "send-email",
      "queue": "emailQueue",
      "description": "Send email via Microsoft Graph or SMTP",
      "data_schema": {
        "to": "email address",
        "subject": "string",
        "body": "HTML string",
        "attachments": "array of file URLs"
      },
      "triggered_by": ["User action", "System event", "Scheduled task"]
    },
    {
      "id": "send-notification",
      "queue": "notificationQueue",
      "description": "Send push notification to user",
      "data_schema": {
        "user_id": "uuid",
        "title": "string",
        "message": "string",
        "type": "enum (info|warning|error|success)",
        "link": "optional URL"
      },
      "triggered_by": ["Alert threshold", "Assignment change", "Document approval"]
    },
    {
      "id": "send-sms",
      "queue": "notificationQueue",
      "description": "Send SMS via Twilio",
      "data_schema": {
        "phone_number": "string",
        "message": "string (max 160 chars)"
      },
      "triggered_by": ["Emergency alert", "2FA code", "Driver assignment"]
    },
    {
      "id": "generate-report",
      "queue": "reportQueue",
      "description": "Generate PDF/Excel report",
      "data_schema": {
        "report_type": "enum (fleet|maintenance|fuel|driver)",
        "format": "enum (pdf|xlsx|csv)",
        "date_range": "object {start, end}",
        "filters": "object"
      },
      "triggered_by": ["User request", "Scheduled report"],
      "output": "File URL in blob storage"
    },
    {
      "id": "export-data",
      "queue": "reportQueue",
      "description": "Export data to CSV/Excel",
      "data_schema": {
        "entity_type": "string",
        "filters": "object",
        "format": "enum (csv|xlsx)"
      },
      "triggered_by": ["User export action"]
    },
    {
      "id": "process-telemetry",
      "queue": "telemetryQueue",
      "description": "Process and analyze vehicle telemetry data",
      "data_schema": {
        "vehicle_id": "uuid",
        "telemetry_data": "object"
      },
      "triggered_by": ["Real-time vehicle data stream"],
      "processing": "Anomaly detection, predictive maintenance"
    },
    {
      "id": "sync-external-data",
      "queue": "syncQueue",
      "description": "Sync data from external systems",
      "data_schema": {
        "system": "enum (fuelmaster|peoplesoft|smartcar)",
        "sync_type": "enum (full|incremental)",
        "entity_types": "array"
      },
      "triggered_by": ["Scheduled sync", "User-initiated sync"],
      "frequency": "Every 15 minutes (incremental), Daily (full)"
    },
    {
      "id": "cleanup-old-data",
      "queue": "maintenanceQueue",
      "description": "Archive or delete old telemetry/GPS data",
      "data_schema": {
        "table": "string",
        "retention_days": "number"
      },
      "triggered_by": ["Daily cron job"],
      "frequency": "Daily at 2 AM"
    }
  ],
  "scheduled_jobs": [
    {
      "name": "Sync FuelMaster Transactions",
      "schedule": "*/15 * * * *",
      "description": "Sync fuel transactions every 15 minutes",
      "job_type": "sync-external-data",
      "enabled": true
    },
    {
      "name": "Generate Daily Fleet Report",
      "schedule": "0 6 * * *",
      "description": "Generate and email daily fleet summary at 6 AM",
      "job_type": "generate-report",
      "enabled": true
    },
    {
      "name": "Check Maintenance Due",
      "schedule": "0 8 * * *",
      "description": "Check for upcoming maintenance and send notifications",
      "job_type": "send-notification",
      "enabled": true
    },
    {
      "name": "Cleanup Old Telemetry",
      "schedule": "0 2 * * *",
      "description": "Archive telemetry data older than 90 days",
      "job_type": "cleanup-old-data",
      "enabled": true
    },
    {
      "name": "Sync PeopleSoft Employees",
      "schedule": "0 3 * * *",
      "description": "Sync employee/driver data from PeopleSoft",
      "job_type": "sync-external-data",
      "enabled": false,
      "note": "Disabled in production - using emulator"
    },
    {
      "name": "Process Predictive Maintenance",
      "schedule": "0 */4 * * *",
      "description": "Run AI-powered predictive maintenance analysis every 4 hours",
      "job_type": "process-telemetry",
      "enabled": true
    }
  ],
  "job_management": {
    "admin_endpoints": [
      {
        "path": "/api/admin/jobs",
        "method": "GET",
        "description": "List all jobs and their status",
        "file": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/admin-jobs.routes.ts"
      },
      {
        "path": "/api/admin/jobs/:id/retry",
        "method": "POST",
        "description": "Retry a failed job"
      },
      {
        "path": "/api/admin/jobs/:id/cancel",
        "method": "POST",
        "description": "Cancel a pending/running job"
      },
      {
        "path": "/api/admin/queues/stats",
        "method": "GET",
        "description": "Get queue statistics (pending, active, completed, failed)"
      }
    ],
    "dashboard": "Bull Board (admin UI for queue management)",
    "monitoring": "Queue metrics exported to Application Insights"
  },
  "error_handling": {
    "retry_strategy": "Exponential backoff with jitter",
    "max_retries": 3,
    "dead_letter_queue": "Failed jobs moved to DLQ after max retries",
    "alerting": "Sentry error tracking for job failures",
    "logging": "All job execution logged with structured logging"
  },
  "performance": {
    "concurrency": {
      "emailQueue": 5,
      "notificationQueue": 10,
      "reportQueue": 2,
      "telemetryQueue": 20
    },
    "priority_levels": "High, Normal, Low (for reportQueue)",
    "rate_limiting": "Respects external API rate limits (e.g., Twilio, SendGrid)",
    "batching": "Notification jobs can batch multiple notifications"
  },
  "stats": {
    "total_queues": 4,
    "job_types": 8,
    "scheduled_jobs": 6,
    "admin_endpoints": 4
  },
  "notes": [
    "Job queue system uses Bull with Redis backend",
    "All job processors handle errors gracefully with retry logic",
    "Scheduled jobs use cron syntax (* * * * *)",
    "Admin endpoints allow real-time job management and monitoring",
    "Failed jobs are tracked in Sentry for debugging",
    "Queue statistics available via admin dashboard",
    "System supports job priorities for critical operations",
    "Graceful shutdown ensures jobs complete before server restart"
  ]
}
