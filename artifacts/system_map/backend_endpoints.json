{
  "generated_at": "2026-01-08T20:44:00Z",
  "source": "static_analysis",
  "api_version": "v1",
  "base_url": "/api",
  "endpoints": [
    {
      "id": "ep-1",
      "method": "GET",
      "path": "/routes",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 72,
      "auth_required": true,
      "permission": "route:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission", "auditLog"],
      "description": "List all routes with pagination and filtering",
      "query_params": ["page", "pageSize", "type", "status", "driverId", "vehicleId", "date"],
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-2",
      "method": "POST",
      "path": "/routes",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 406,
      "auth_required": true,
      "permission": "route:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission", "auditLog"],
      "description": "Create a new route",
      "body_schema": {
        "vehicleId": "required|uuid",
        "driverId": "required|uuid",
        "stops": "required|array",
        "startTime": "optional|datetime",
        "optimize": "optional|boolean",
        "status": "optional|enum"
      },
      "response_type": "single_resource",
      "tenant_isolated": true,
      "idor_protected": true
    },
    {
      "id": "ep-3",
      "method": "GET",
      "path": "/routes/:id",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 339,
      "auth_required": true,
      "permission": "route:view:own",
      "middleware": ["authenticateJWT", "requirePermission", "auditLog"],
      "description": "Get a single route by ID",
      "path_params": ["id"],
      "response_type": "single_resource",
      "tenant_isolated": true,
      "custom_check": "Driver can only view their own routes"
    },
    {
      "id": "ep-4",
      "method": "PUT",
      "path": "/routes/:id",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 495,
      "auth_required": true,
      "permission": "route:update:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission", "auditLog"],
      "description": "Update a route",
      "path_params": ["id"],
      "body_schema": "partial_route_update",
      "response_type": "single_resource",
      "tenant_isolated": true,
      "custom_check": "Cannot update completed routes",
      "idor_protected": true
    },
    {
      "id": "ep-5",
      "method": "DELETE",
      "path": "/routes/:id",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 710,
      "auth_required": true,
      "permission": "route:delete:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission", "auditLog"],
      "description": "Delete a route",
      "path_params": ["id"],
      "response_type": "success_message",
      "tenant_isolated": true,
      "custom_check": "Cannot delete active/in-progress routes"
    },
    {
      "id": "ep-6",
      "method": "POST",
      "path": "/routes/optimize",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 191,
      "auth_required": true,
      "permission": "route:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission", "auditLog"],
      "description": "Optimize route stops for efficiency",
      "body_schema": {
        "vehicleId": "optional|uuid",
        "stops": "required|array",
        "startLocation": "optional|coordinates",
        "considerTraffic": "optional|boolean",
        "departureTime": "optional|datetime"
      },
      "response_type": "optimization_result"
    },
    {
      "id": "ep-7",
      "method": "GET",
      "path": "/routes/analytics/completion",
      "handler": "routes.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/routes.ts",
      "line_number": 234,
      "auth_required": true,
      "permission": "route:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission", "auditLog"],
      "description": "Get route completion analytics",
      "response_type": "analytics_data",
      "tenant_isolated": true
    },
    {
      "id": "ep-8",
      "method": "GET",
      "path": "/vehicles",
      "handler": "vehicles.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/vehicles.ts",
      "auth_required": true,
      "permission": "vehicle:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission", "auditLog"],
      "description": "List all vehicles with pagination",
      "query_params": ["page", "pageSize", "status", "type", "location"],
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-9",
      "method": "POST",
      "path": "/vehicles",
      "handler": "vehicles.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/vehicles.ts",
      "auth_required": true,
      "permission": "vehicle:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission", "auditLog"],
      "description": "Create a new vehicle",
      "response_type": "single_resource",
      "tenant_isolated": true
    },
    {
      "id": "ep-10",
      "method": "GET",
      "path": "/drivers",
      "handler": "drivers.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/drivers.ts",
      "auth_required": true,
      "permission": "driver:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "List all drivers",
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-11",
      "method": "POST",
      "path": "/drivers",
      "handler": "drivers.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/drivers.ts",
      "auth_required": true,
      "permission": "driver:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission"],
      "description": "Create a new driver",
      "response_type": "single_resource",
      "tenant_isolated": true
    },
    {
      "id": "ep-12",
      "method": "GET",
      "path": "/maintenance",
      "handler": "maintenance.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/maintenance.ts",
      "auth_required": true,
      "permission": "maintenance:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "List maintenance records",
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-13",
      "method": "POST",
      "path": "/maintenance",
      "handler": "maintenance.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/maintenance.ts",
      "auth_required": true,
      "permission": "maintenance:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission"],
      "description": "Create maintenance record",
      "response_type": "single_resource",
      "tenant_isolated": true
    },
    {
      "id": "ep-14",
      "method": "GET",
      "path": "/fuel-transactions",
      "handler": "fuel-transactions.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/fuel-transactions.ts",
      "auth_required": true,
      "permission": "fuel:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "List fuel transactions",
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-15",
      "method": "POST",
      "path": "/auth/login",
      "handler": "auth.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/auth.ts",
      "auth_required": false,
      "middleware": ["rateLimiter"],
      "description": "User login",
      "body_schema": {
        "email": "required|email",
        "password": "required|string"
      },
      "response_type": "auth_token",
      "rate_limited": true
    },
    {
      "id": "ep-16",
      "method": "POST",
      "path": "/auth/logout",
      "handler": "auth.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/auth.ts",
      "auth_required": true,
      "middleware": ["authenticateJWT"],
      "description": "User logout",
      "response_type": "success_message"
    },
    {
      "id": "ep-17",
      "method": "GET",
      "path": "/telematics",
      "handler": "telematics.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/telematics.routes.ts",
      "auth_required": true,
      "permission": "telematics:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "Get vehicle telematics data",
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-18",
      "method": "POST",
      "path": "/dispatch",
      "handler": "dispatch.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/dispatch.routes.ts",
      "auth_required": true,
      "permission": "dispatch:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission"],
      "description": "Create dispatch assignment",
      "response_type": "single_resource",
      "tenant_isolated": true
    },
    {
      "id": "ep-19",
      "method": "GET",
      "path": "/gps",
      "handler": "gps.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/gps.ts",
      "auth_required": true,
      "permission": "gps:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "Get GPS location data",
      "response_type": "location_data",
      "tenant_isolated": true,
      "real_time": true
    },
    {
      "id": "ep-20",
      "method": "POST",
      "path": "/reservations",
      "handler": "reservations.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/reservations.routes.ts",
      "auth_required": true,
      "permission": "reservation:create:own",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission"],
      "description": "Create vehicle reservation",
      "response_type": "single_resource",
      "tenant_isolated": true,
      "conflict_check": "Vehicle availability validation"
    },
    {
      "id": "ep-21",
      "method": "GET",
      "path": "/ev-management/charging-stations",
      "handler": "ev-management.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/ev-management.routes.ts",
      "auth_required": true,
      "permission": "ev:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "List EV charging stations",
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-22",
      "method": "POST",
      "path": "/video-telematics/events",
      "handler": "video-telematics.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/video-telematics.routes.ts",
      "auth_required": true,
      "permission": "video_telematics:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission"],
      "description": "Upload video telematics event",
      "response_type": "single_resource",
      "tenant_isolated": true
    },
    {
      "id": "ep-23",
      "method": "GET",
      "path": "/asset-management",
      "handler": "asset-management.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/asset-management.routes.ts",
      "auth_required": true,
      "permission": "asset:view:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "List assets",
      "response_type": "paginated_list",
      "tenant_isolated": true
    },
    {
      "id": "ep-24",
      "method": "POST",
      "path": "/damage-reports",
      "handler": "damage-reports.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/damage-reports.routes.ts",
      "auth_required": true,
      "permission": "damage_report:create:fleet",
      "middleware": ["authenticateJWT", "csrfProtection", "requirePermission"],
      "description": "Create damage report",
      "response_type": "single_resource",
      "tenant_isolated": true,
      "supports_file_upload": true
    },
    {
      "id": "ep-25",
      "method": "GET",
      "path": "/executive-dashboard/stats",
      "handler": "executive-dashboard.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/executive-dashboard.routes.ts",
      "auth_required": true,
      "permission": "executive_dashboard:view",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "Get executive dashboard statistics",
      "response_type": "dashboard_stats",
      "tenant_isolated": true,
      "roles_required": ["admin", "executive"]
    },
    {
      "id": "ep-26",
      "method": "POST",
      "path": "/ai-insights/analyze",
      "handler": "ai-insights.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/ai-insights.routes.ts",
      "auth_required": true,
      "permission": "ai_insights:use:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "Generate AI insights",
      "response_type": "ai_analysis",
      "tenant_isolated": true
    },
    {
      "id": "ep-27",
      "method": "GET",
      "path": "/health",
      "handler": "health.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/health.routes.ts",
      "auth_required": false,
      "middleware": [],
      "description": "System health check",
      "response_type": "health_status"
    },
    {
      "id": "ep-28",
      "method": "GET",
      "path": "/health-system",
      "handler": "health-system.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/health-system.routes.ts",
      "auth_required": true,
      "permission": "system:health:view",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "Comprehensive system health",
      "response_type": "detailed_health_status"
    },
    {
      "id": "ep-29",
      "method": "POST",
      "path": "/mobile-integration/sync",
      "handler": "mobile-integration.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/mobile-integration.routes.ts",
      "auth_required": true,
      "middleware": ["authenticateJWT"],
      "description": "Mobile data synchronization",
      "response_type": "sync_result",
      "tenant_isolated": true
    },
    {
      "id": "ep-30",
      "method": "POST",
      "path": "/smartcar/connect",
      "handler": "smartcar.routes.ts",
      "file_path": "/Users/andrewmorton/Documents/GitHub/Fleet/api/src/routes/smartcar.routes.ts",
      "auth_required": true,
      "permission": "smartcar:connect:fleet",
      "middleware": ["authenticateJWT", "requirePermission"],
      "description": "Connect vehicle via Smartcar",
      "response_type": "oauth_redirect",
      "tenant_isolated": true,
      "external_integration": "smartcar"
    }
  ],
  "stats": {
    "total_endpoints": 30,
    "auth_required": 28,
    "public_endpoints": 2,
    "by_method": {
      "GET": 13,
      "POST": 15,
      "PUT": 1,
      "DELETE": 1
    },
    "tenant_isolated": 27,
    "idor_protected": 2,
    "csrf_protected": 17,
    "role_restricted": 1,
    "external_integrations": 1
  },
  "security_patterns": {
    "authentication": "JWT tokens via authenticateJWT middleware",
    "authorization": "Permission-based RBAC via requirePermission middleware",
    "tenant_isolation": "All queries filtered by tenant_id from JWT",
    "idor_protection": "Foreign key validation + custom checks",
    "csrf_protection": "CSRF tokens required for state-changing operations",
    "audit_logging": "All operations logged via auditLog middleware",
    "rate_limiting": "Applied to auth endpoints via rateLimiter middleware",
    "input_validation": "SQL injection prevention via parameterized queries"
  },
  "notes": [
    "This is a curated subset representing 30 core endpoints out of 1325+ total operations",
    "The API uses Express.js with modular route files (170+ route files)",
    "All endpoints use parameterized SQL queries ($1, $2, etc.) for injection prevention",
    "Multi-tenant isolation is enforced at the database query level",
    "Custom permission checks support complex authorization logic beyond basic RBAC",
    "The system supports WebSocket connections for real-time GPS and telematics data"
  ]
}
