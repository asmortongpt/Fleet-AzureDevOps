{
  "agent_id": 21,
  "name": "QueryErrorBoundary",
  "file": "src/components/errors/QueryErrorBoundary.tsx",
  "status": "success",
  "content": "/**\n * Query Error Boundary Component\n *\n * Provides error handling specifically for React Query errors\n * with retry functionality and user-friendly error messages\n */\n\nimport { QueryErrorResetBoundary } from '@tanstack/react-query';\nimport { AlertCircle, RefreshCw, WifiOff, ServerCrash } from 'lucide-react';\nimport React from 'react';\n\nimport { EnhancedErrorBoundary } from '@/components/EnhancedErrorBoundary';\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { getErrorMessage } from '@/hooks/useQueryWithErrorHandling';\nimport logger from '@/utils/logger';\ninterface QueryErrorFallbackProps {\n  error: Error;\n  resetErrorBoundary: () => void;\n}\n\n/**\n * Error fallback component for query errors\n */\nexport const QueryErrorFallback: React.FC<QueryErrorFallbackProps> = ({\n  error,\n  resetErrorBoundary,\n}) => {\n  const errorMessage = getErrorMessage(error);\n  const isNetworkError = error.message?.toLowerCase().includes('network') ||\n    error.message?.toLowerCase().includes('fetch');\n  const isServerError = error.message?.toLowerCase().includes('500') ||\n    error.message?.toLowerCase().includes('502') ||\n    error.message?.toLowerCase().includes('503');\n\n  return (\n    <Card className=\"border-red-200 dark:border-red-800\">\n      <CardHeader>\n        <div className=\"flex items-center gap-3\">\n          {isNetworkError ? (\n            <WifiOff className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\n          ) : isServerError ? (\n            <ServerCrash className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\n          ) : (\n            <AlertCircle className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\n          )}\n          <CardTitle className=\"text-red-600 dark:text-red-400\">\n            {isNetworkError\n              ? 'Connection Error'\n              : isServerError\n              ? 'Server Error'\n              : 'Error Loading Data'}\n          </CardTitle>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-2\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>Unable to load data</AlertTitle>\n          <AlertDescription className=\"mt-2\">\n            {errorMessage}\n          </AlertDescription>\n        </Alert>\n\n        {isNetworkError && (\n          <Alert>\n            <WifiOff className=\"h-4 w-4\" />\n            <AlertTitle>Troubleshooting Network Issues</AlertTitle>\n            <AlertDescription className=\"mt-2\">\n              <ul className=\"list-disc list-inside space-y-1 text-sm\">\n                <li>Check your internet connection</li>\n                <li>Verify you can access other websites</li>\n                <li>Try refreshing the page</li>\n                <li>Contact IT support if the problem persists</li>\n              </ul>\n            </AlertDescription>\n          </Alert>\n        )}\n\n        <div className=\"flex gap-3\">\n          <Button\n            onClick={resetErrorBoundary}\n            variant=\"default\"\n            className=\"flex items-center gap-2\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n            Try Again\n          </Button>\n          <Button\n            onClick={() => window.location.reload()}\n            variant=\"outline\"\n          >\n            Reload Page\n          </Button>\n        </div>\n\n        {import.meta.env.DEV && (\n          <details className=\"mt-2\">\n            <summary className=\"cursor-pointer text-sm font-semibold text-slate-700 dark:text-gray-400\">\n              Technical Details\n            </summary>\n            <pre className=\"mt-2 text-xs bg-gray-100 dark:bg-gray-800 p-3 rounded overflow-x-auto\">\n              {error.stack}\n            </pre>\n          </details>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\ninterface QueryErrorBoundaryProps {\n  children: React.ReactNode;\n  fallback?: React.ReactNode;\n  onReset?: () => void;\n}\n\n/**\n * Wraps components that use React Query with error handling\n *\n * @example\n * ```tsx\n * <QueryErrorBoundary>\n *   <VehicleList />\n * </QueryErrorBoundary>\n * ```\n */\nexport const QueryErrorBoundary: React.FC<QueryErrorBoundaryProps> = ({\n  children,\n  fallback,\n  onReset,\n}) => {\n  return (\n    <QueryErrorResetBoundary>\n      {({ reset }) => (\n        <EnhancedErrorBoundary\n          onError={(error, errorInfo) => {\n            logger.error('Query Error Boundary caught:', error, errorInfo);\n          }}\n          fallbackRender={({ error: actualError, resetErrorBoundary }) => \n            fallback ? (\n              <>{fallback}</>\n            ) : (\n              <QueryErrorFallback\n                error={actualError || new Error('An unknown error occurred')}\n                resetErrorBoundary={() => {\n                  resetErrorBoundary();\n                  reset();\n                  onReset?.();\n                }}\n              />\n            )\n          }\n        >\n          {children}\n        </EnhancedErrorBoundary>\n      )}\n    </QueryErrorResetBoundary>\n  );\n};\n\n/**\n * Inline error display for queries (not a boundary)\n */\ninterface QueryErrorDisplayProps {\n  error: Error | null;\n  onRetry?: () => void;\n  className?: string;\n}\n\nexport const QueryErrorDisplay: React.FC<QueryErrorDisplayProps> = ({\n  error,\n  onRetry,\n  className = '',\n}) => {\n  if (!error) return null;\n\n  const errorMessage = getErrorMessage(error);\n\n  return (\n    <Alert variant=\"destructive\" className={className}>\n      <AlertCircle className=\"h-4 w-4\" />\n      <AlertTitle>Error</AlertTitle>\n      <AlertDescription className=\"mt-2\">\n        {errorMessage}\n        {onRetry && (\n          <Button\n            onClick={onRetry}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"mt-3\"\n          >\n            <RefreshCw className=\"h-3 w-3 mr-1\" />\n            Retry\n          </Button>\n        )}\n      </AlertDescription>\n    </Alert>\n  );\n};\n\n/**\n * Compact inline error for table rows or list items\n */\nexport const InlineQueryError: React.FC<{\n  error: Error;\n  onRetry?: () => void;\n}> = ({ error, onRetry }) => {\n  const errorMessage = getErrorMessage(error);\n\n  return (\n    <div className=\"flex items-center gap-2 text-sm text-red-600 dark:text-red-400 p-2 bg-red-50 dark:bg-red-900/20 rounded\">\n      <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\n      <span className=\"flex-1\">{errorMessage}</span>\n      {onRetry && (\n        <Button onClick={onRetry} variant=\"ghost\" size=\"sm\">\n          <RefreshCw className=\"h-3 w-3\" />\n        </Button>\n      )}\n    </div>\n  );\n};",
  "timestamp": "2026-01-18T16:21:48.534692"
}