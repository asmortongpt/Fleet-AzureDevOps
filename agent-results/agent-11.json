{
  "agent_id": 11,
  "name": "CacheService",
  "file": "api/src/services/cache.service.ts",
  "status": "success",
  "content": "```typescript\nimport { injectable } from 'inversify';\nimport Redis from 'ioredis';\n\nexport const CacheKeys = {\n  vehicle: (id: number) => `vehicle:${id}`,\n  vehicles: (tenantId: number) => `vehicles:${tenantId}:*`\n};\n\n@injectable()\nexport class CacheService {\n  private redis: Redis;\n  private hits = 0;\n  private misses = 0;\n\n  constructor() {\n    this.redis = new Redis(process.env.REDIS_URL || 'redis://localhost:6379');\n  }\n\n  async get(key: string) {\n    const cached = await this.redis.get(key);\n    if (cached) {\n      this.hits++;\n      return JSON.parse(cached);\n    }\n    this.misses++;\n    return null;\n  }\n\n  async set(key: string, value: unknown, ttl = 3600) {\n    await this.redis.setex(key, ttl, JSON.stringify(value));\n  }\n\n  async delete(key: string) {\n    await this.redis.del(key);\n  }\n\n  async del(key: string) {\n    await this.redis.del(key);\n  }\n\n  async deletePattern(pattern: string) {\n    const keys = await this.redis.keys(pattern);\n    if (keys.length > 0) {\n      await this.redis.del(...keys);\n    }\n  }\n\n  async getOrSet<T>(key: string, fetcher: () => Promise<T>, ttl = 3600): Promise<T> {\n    const cached = await this.get(key);\n    if (cached) return cached;\n    const value = await fetcher();\n    if (value) await this.set(key, value, ttl);\n    return value;\n  }\n\n  async getStats() {\n    const info = await this.redis.info('memory');\n    const memoryMatch = info.match(/used_memory:(\\d+)/);\n    const memoryUsage = memoryMatch ? parseInt(memoryMatch[1]) : 0;\n    \n    const total = this.hits + this.misses;\n    const hitRate = total > 0 ? this.hits / total : 0;\n\n    return {\n      memoryUsage,\n      hitRate\n    };\n  }\n\n  // Legacy methods (aliases)\n  async invalidate(pattern: string) {\n    return this.deletePattern(pattern);\n  }\n\n  async cacheVehicle(vehicleId: number, data: unknown) {\n    await this.set(CacheKeys.vehicle(vehicleId), data, 300);\n  }\n\n  async invalidateVehicle(vehicleId: number) {\n    await this.delete(CacheKeys.vehicle(vehicleId));\n  }\n}\n```",
  "timestamp": "2026-01-18T16:21:48.531537"
}