{
  "dashboardName": "Fleet Management - Production Monitoring",
  "description": "Unified monitoring dashboard combining Sentry, PostHog, and Azure Application Insights",
  "refreshInterval": "5m",
  "timeRange": "24h",
  "sections": [
    {
      "name": "System Health Overview",
      "widgets": [
        {
          "type": "metric",
          "title": "Service Availability",
          "source": "azure",
          "query": "availabilityResults | summarize avg(availabilityPercentage) by bin(timestamp, 5m)",
          "visualization": "gauge",
          "target": 99.9,
          "warning": 99.0,
          "critical": 95.0
        },
        {
          "type": "metric",
          "title": "Error Rate",
          "source": "sentry",
          "query": "events/count where level=error",
          "visualization": "line",
          "thresholds": {
            "warning": 1.0,
            "critical": 5.0
          }
        },
        {
          "type": "metric",
          "title": "Active Users (Real-time)",
          "source": "posthog",
          "query": "active_users_count",
          "visualization": "number",
          "comparison": "previous_period"
        },
        {
          "type": "metric",
          "title": "API Response Time (P95)",
          "source": "azure",
          "query": "requests | summarize percentile(duration, 95) by bin(timestamp, 5m)",
          "visualization": "line",
          "target": 2000,
          "warning": 3000,
          "critical": 5000
        }
      ]
    },
    {
      "name": "Error Tracking (Sentry)",
      "widgets": [
        {
          "type": "table",
          "title": "Top 10 Errors (Last Hour)",
          "source": "sentry",
          "query": "issues?query=is:unresolved&sort=freq&limit=10",
          "columns": ["message", "count", "last_seen", "users_affected"]
        },
        {
          "type": "chart",
          "title": "Error Frequency Over Time",
          "source": "sentry",
          "query": "stats?stat=received&resolution=1h",
          "visualization": "area",
          "groupBy": "error_type"
        },
        {
          "type": "list",
          "title": "Recent High-Severity Errors",
          "source": "sentry",
          "query": "issues?query=is:unresolved level:error&sort=date&limit=5",
          "showDetails": true
        }
      ]
    },
    {
      "name": "Performance Monitoring",
      "widgets": [
        {
          "type": "chart",
          "title": "API Endpoint Performance",
          "source": "azure",
          "query": "requests | summarize avg(duration), percentile(duration, 95) by operation_Name, bin(timestamp, 5m)",
          "visualization": "line",
          "groupBy": "operation_Name"
        },
        {
          "type": "chart",
          "title": "Database Query Performance",
          "source": "azure",
          "query": "dependencies | where type == 'SQL' | summarize avg(duration), percentile(duration, 95) by name, bin(timestamp, 5m)",
          "visualization": "line"
        },
        {
          "type": "table",
          "title": "Slowest Transactions",
          "source": "sentry",
          "query": "transactions?query=duration:>3000&sort=duration",
          "columns": ["transaction", "duration", "timestamp"]
        }
      ]
    },
    {
      "name": "User Analytics (PostHog)",
      "widgets": [
        {
          "type": "metric",
          "title": "Daily Active Users",
          "source": "posthog",
          "query": "trends/dau",
          "visualization": "line",
          "comparison": "week_over_week"
        },
        {
          "type": "table",
          "title": "Top Pages",
          "source": "posthog",
          "query": "events?event=$pageview&breakdown=$current_url&limit=10",
          "columns": ["url", "views", "unique_users"]
        },
        {
          "type": "chart",
          "title": "Feature Flag Usage",
          "source": "posthog",
          "query": "events?event=$feature_flag_called&breakdown=$feature_flag",
          "visualization": "bar"
        },
        {
          "type": "funnel",
          "title": "User Onboarding Funnel",
          "source": "posthog",
          "steps": [
            "user_registered",
            "profile_completed",
            "first_vehicle_added",
            "first_route_created"
          ]
        }
      ]
    },
    {
      "name": "Infrastructure Metrics",
      "widgets": [
        {
          "type": "chart",
          "title": "CPU Usage",
          "source": "azure",
          "query": "performanceCounters | where name == '% Processor Time' | summarize avg(value) by bin(timestamp, 5m)",
          "visualization": "area",
          "thresholds": {
            "warning": 70,
            "critical": 85
          }
        },
        {
          "type": "chart",
          "title": "Memory Usage",
          "source": "azure",
          "query": "performanceCounters | where name == 'Available Bytes' | summarize avg(value) by bin(timestamp, 5m)",
          "visualization": "area"
        },
        {
          "type": "chart",
          "title": "Database Connections",
          "source": "azure",
          "query": "customMetrics | where name == 'database_connections' | summarize avg(value) by bin(timestamp, 5m)",
          "visualization": "line"
        },
        {
          "type": "metric",
          "title": "Redis Cache Hit Rate",
          "source": "azure",
          "query": "customMetrics | where name == 'cache_hit_rate' | summarize avg(value)",
          "visualization": "gauge",
          "target": 95.0
        }
      ]
    },
    {
      "name": "Business Metrics",
      "widgets": [
        {
          "type": "metric",
          "title": "Total Active Vehicles",
          "source": "posthog",
          "query": "events?event=vehicle_tracked&aggregation=unique",
          "visualization": "number"
        },
        {
          "type": "chart",
          "title": "Routes Optimized (Daily)",
          "source": "posthog",
          "query": "events?event=route_optimized&interval=day",
          "visualization": "bar"
        },
        {
          "type": "chart",
          "title": "Maintenance Scheduled",
          "source": "posthog",
          "query": "events?event=maintenance_scheduled&interval=day",
          "visualization": "line"
        },
        {
          "type": "table",
          "title": "Most Active Features",
          "source": "posthog",
          "query": "events?breakdown=feature&limit=10",
          "columns": ["feature", "usage_count", "unique_users"]
        }
      ]
    },
    {
      "name": "Alerts & Incidents",
      "widgets": [
        {
          "type": "list",
          "title": "Active Alerts",
          "source": "azure",
          "query": "alerts?state=active",
          "showSeverity": true,
          "showAge": true
        },
        {
          "type": "timeline",
          "title": "Incident Timeline (7 days)",
          "source": "azure",
          "query": "alerts?timeRange=7d",
          "groupBy": "severity"
        },
        {
          "type": "table",
          "title": "Recent Deployments",
          "source": "azure",
          "query": "deployments?limit=5",
          "columns": ["timestamp", "version", "status", "duration"]
        }
      ]
    }
  ],
  "alerts": {
    "highErrorRate": {
      "condition": "error_rate > 1%",
      "window": "15m",
      "severity": "medium",
      "notifications": ["email", "slack"]
    },
    "slowResponse": {
      "condition": "p95_response_time > 3000",
      "window": "15m",
      "severity": "low",
      "notifications": ["email"]
    },
    "serviceDown": {
      "condition": "availability < 99%",
      "window": "5m",
      "severity": "critical",
      "notifications": ["email", "slack", "pagerduty"]
    },
    "highMemory": {
      "condition": "memory_usage > 80%",
      "window": "15m",
      "severity": "medium",
      "notifications": ["email", "slack"]
    }
  },
  "integrations": {
    "sentry": {
      "organization": "fleet-management",
      "projects": ["fleet-api", "fleet-web"],
      "apiEndpoint": "https://sentry.io/api/0/"
    },
    "posthog": {
      "projectId": "${POSTHOG_PROJECT_ID}",
      "apiEndpoint": "${POSTHOG_HOST}/api/"
    },
    "azure": {
      "subscriptionId": "${AZURE_SUBSCRIPTION_ID}",
      "resourceGroup": "fleet-management-rg",
      "appInsightsName": "fleet-management-insights"
    }
  },
  "customQueries": {
    "errorRateTrend": {
      "name": "Error Rate Trend (24h)",
      "sources": ["sentry", "azure"],
      "query": "Compare error rates across monitoring systems",
      "schedule": "hourly"
    },
    "performanceBaseline": {
      "name": "Performance Baseline Comparison",
      "sources": ["azure", "sentry"],
      "query": "Compare current performance to baseline",
      "schedule": "daily"
    },
    "userEngagement": {
      "name": "User Engagement Metrics",
      "sources": ["posthog"],
      "query": "DAU, WAU, MAU, retention metrics",
      "schedule": "daily"
    }
  },
  "metadata": {
    "createdAt": "2025-12-31",
    "version": "1.0",
    "owner": "Platform Engineering Team",
    "lastUpdated": "2025-12-31"
  }
}
