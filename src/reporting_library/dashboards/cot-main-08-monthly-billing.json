{
  "id": "cot-main-08",
  "title": "Monthly Billing",
  "domain": "billing",
  "category": "city_tallahassee_main",
  "description": "Totals by category (Stock Parts, Fuel, Labor, Sublets)",
  "datasource": {"type": "sqlView", "view": "vw_monthly_billing", "parameters": {"month": "{{month}}", "department": "{{department}}"}},
  "filters": [{"name": "month", "type": "month", "default": "current_month", "required": true}, {"name": "department", "type": "multiSelect", "values": "dynamic", "default": "All"}],
  "visuals": [
    {"id": "kpis", "type": "kpiTiles", "title": "Billing Summary", "measures": [{"id": "total_billing", "label": "Total Billing", "format": "currency", "aggregation": "sum", "field": "total_amount"}, {"id": "stock_parts", "label": "Stock Parts", "format": "currency", "aggregation": "sum", "field": "stock_parts_amount"}, {"id": "fuel", "label": "Fuel", "format": "currency", "aggregation": "sum", "field": "fuel_amount"}, {"id": "labor", "label": "Labor", "format": "currency", "aggregation": "sum", "field": "labor_amount"}, {"id": "sublets", "label": "Sublets", "format": "currency", "aggregation": "sum", "field": "sublets_amount"}], "layout": {"x": 0, "y": 0, "w": 12, "h": 2}},
    {"id": "billing_breakdown", "type": "pie", "title": "Billing Breakdown", "encoding": {"theta": {"field": "amount", "type": "quantitative", "aggregate": "sum"}, "color": {"field": "category", "type": "nominal"}}, "layout": {"x": 0, "y": 2, "w": 6, "h": 4}},
    {"id": "monthly_trend", "type": "line", "title": "Monthly Billing Trend", "encoding": {"x": {"field": "month", "type": "temporal"}, "y": {"field": "amount", "type": "quantitative", "aggregate": "sum"}, "color": {"field": "category", "type": "nominal"}}, "layout": {"x": 6, "y": 2, "w": 6, "h": 4}}
  ],
  "exports": [{"format": "csv"}, {"format": "xlsx"}, {"format": "pdf"}],
  "security": {"rowLevel": [{"role": "DepartmentUser", "rule": "department IN user.departments"}, {"role": "Admin", "rule": "TRUE"}]}
}
