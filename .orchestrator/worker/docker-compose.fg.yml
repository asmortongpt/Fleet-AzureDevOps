# ============================================================================
# Fleet Agent Workers F & G - Docker Compose Configuration
# ============================================================================
# Deploy agents F and G to agent-settings VM (172.191.6.180)
# ============================================================================

version: '3.8'

services:
  # Agent F - Remaining Domain Repositories
  agent-f:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: fleet-agent-f
    hostname: agent-f
    environment:
      # Agent Configuration
      AGENT_NAME: agent-f
      AGENT_ROLE: remaining-repos
      LLM_MODEL: claude-sonnet-4

      # Orchestrator Connection
      ORCHESTRATOR_URL: http://172.191.51.49:3000

      # GitHub Authentication
      GITHUB_TOKEN: ${GITHUB_TOKEN}

      # Anthropic API
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}

      # Polling Configuration
      POLL_INTERVAL: 30000
      HEARTBEAT_INTERVAL: 60000

      # Repository Path
      REPO_PATH: /workspace/Fleet
    volumes:
      # Mount Git credentials
      - ~/.gitconfig:/home/fleetagent/.gitconfig:ro
      - ~/.ssh:/home/fleetagent/.ssh:ro

      # Mount repository
      - fleet-repo-agent-f:/workspace/Fleet
    restart: unless-stopped
    networks:
      - fleet-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Agent G - Routes Migration
  agent-g:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: fleet-agent-g
    hostname: agent-g
    environment:
      AGENT_NAME: agent-g
      AGENT_ROLE: routes-migration
      LLM_MODEL: claude-sonnet-4
      ORCHESTRATOR_URL: http://172.191.51.49:3000
      GITHUB_TOKEN: ${GITHUB_TOKEN}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      POLL_INTERVAL: 30000
      HEARTBEAT_INTERVAL: 60000
      REPO_PATH: /workspace/Fleet
    volumes:
      - ~/.gitconfig:/home/fleetagent/.gitconfig:ro
      - ~/.ssh:/home/fleetagent/.ssh:ro
      - fleet-repo-agent-g:/workspace/Fleet
    restart: unless-stopped
    networks:
      - fleet-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  fleet-repo-agent-f:
    driver: local
  fleet-repo-agent-g:
    driver: local

networks:
  fleet-network:
    driver: bridge
