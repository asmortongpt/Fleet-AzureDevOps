# ============================================================================
# Fleet Application - Production Environment Configuration
# ============================================================================
# Last Updated: November 12, 2025
# Key Vault: fleet-secrets-0d326d71
# ============================================================================

# Environment
NODE_ENV=production
ENVIRONMENT=production

# ============================================================================
# Azure Key Vault Configuration
# ============================================================================
# All secrets are fetched from this vault automatically
AZURE_KEY_VAULT_URI=https://fleet-secrets-0d326d71.vault.azure.net/

# Azure Authentication (Managed Identity in production)
AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
AZURE_TENANT_ID=0ec14b81-7b82-45ee-8f3d-cbc31ced5347

# ============================================================================
# Database Configuration (Azure PostgreSQL with High Availability)
# ============================================================================
# Values are fetched from Key Vault:
# - db-host: fleet-production-db.postgres.database.azure.com
# - db-name: fleet_production
DATABASE_HOST=${DB_HOST}
DATABASE_PORT=${DB_PORT:-5432}
DATABASE_NAME=${DB_NAME}

# Admin User (for migrations and schema changes only - use sparingly)
# Key Vault secrets: db-admin-username, db-admin-password
DB_ADMIN_USER=${DB_ADMIN_USER:-fleetadmin}
DB_ADMIN_PASSWORD=${DB_ADMIN_PASSWORD}
DB_ADMIN_POOL_SIZE=5

# Web App User (default for all application operations - recommended)
# Key Vault secrets: db-webapp-username, db-webapp-password
DB_WEBAPP_USER=${DB_WEBAPP_USER:-fleet_webapp_user}
DB_WEBAPP_PASSWORD=${DB_WEBAPP_PASSWORD}
DB_WEBAPP_POOL_SIZE=50

# Read-Only User (for reporting and analytics - optional)
# Key Vault secrets: db-readonly-username, db-readonly-password
DB_READONLY_USER=${DB_READONLY_USER:-fleet_readonly_user}
DB_READONLY_PASSWORD=${DB_READONLY_PASSWORD}
DB_READONLY_POOL_SIZE=20

# Legacy - backward compatibility (defaults to admin user - NOT RECOMMENDED)
DATABASE_USER=${DB_WEBAPP_USER:-fleetadmin}
DATABASE_PASSWORD=${DB_WEBAPP_PASSWORD}

# Connection Pool Settings (Production-optimized)
DATABASE_POOL_MIN=10
DATABASE_POOL_MAX=50
DATABASE_SSL_ENABLED=true
DATABASE_SSL_REJECT_UNAUTHORIZED=true
DB_SSL_CA=${DB_SSL_CA}
DB_HEALTH_CHECK_INTERVAL=30000
DB_LOG_QUERIES=false

# ============================================================================
# Redis Configuration (Azure Redis Cache with Clustering)
# ============================================================================
# Values are fetched from Key Vault:
# - redis-host: fleet-redis-prod.redis.cache.windows.net
# - redis-password: [Secure 32-byte value from Key Vault]
REDIS_HOST=${REDIS_HOST}
REDIS_PORT=6380
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_TLS_ENABLED=true
REDIS_CLUSTER_ENABLED=true

# ============================================================================
# Application Configuration
# ============================================================================
PORT=8080
API_BASE_URL=https://fleet.capitaltechalliance.com/api
FRONTEND_URL=https://fleet.capitaltechalliance.com

# CORS (production domain only)
CORS_ORIGIN=https://fleet.capitaltechalliance.com

# ============================================================================
# Feature Flags (Production)
# ============================================================================
ENABLE_DEBUG_LOGGING=false
ENABLE_HOT_RELOAD=false
ENABLE_MOCK_DATA=false
ENABLE_API_DOCS=false

# ============================================================================
# Azure Maps
# ============================================================================
AZURE_MAPS_KEY=${AZURE_MAPS_KEY}

# ============================================================================
# Azure OpenAI
# ============================================================================
AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
AZURE_OPENAI_KEY=${AZURE_OPENAI_KEY}
AZURE_OPENAI_DEPLOYMENT=gpt-4
AZURE_OPENAI_MAX_TOKENS=2000
AZURE_OPENAI_TEMPERATURE=0.7

# ============================================================================
# Microsoft Graph API
# ============================================================================
MS_GRAPH_CLIENT_ID=${MS_GRAPH_CLIENT_ID}
MS_GRAPH_CLIENT_SECRET=${MS_GRAPH_CLIENT_SECRET}
MS_GRAPH_TENANT_ID=${MS_GRAPH_TENANT_ID}

# ============================================================================
# Azure Storage (Production)
# ============================================================================
AZURE_STORAGE_CONNECTION_STRING=${AZURE_STORAGE_CONNECTION_STRING}
AZURE_STORAGE_CONTAINER=fleet-production
AZURE_STORAGE_CDN_ENABLED=true

# ============================================================================
# Email Configuration (SendGrid - Production)
# ============================================================================
SENDGRID_API_KEY=${SENDGRID_API_KEY}
SMTP_USER=${SMTP_USER}
SMTP_PASSWORD=${SMTP_PASSWORD}
EMAIL_FROM=noreply@capitaltechalliance.com
EMAIL_REPLY_TO=support@capitaltechalliance.com

# ============================================================================
# SMS Configuration (Twilio - Production)
# ============================================================================
TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}

# ============================================================================
# Push Notifications (Production)
# ============================================================================
# Firebase (Android)
FIREBASE_SERVICE_ACCOUNT=${FIREBASE_SERVICE_ACCOUNT}
FIREBASE_PROJECT_ID=fleet-production

# Apple Push Notification Service (iOS)
APNS_KEY_PATH=${APNS_KEY_PATH}
APNS_KEY_ID=${APNS_KEY_ID}
APNS_TEAM_ID=${APNS_TEAM_ID}
APNS_ENVIRONMENT=production

# ============================================================================
# Monitoring & Logging (Production)
# ============================================================================
LOG_LEVEL=warn
ENABLE_SENTRY=true
SENTRY_DSN=${SENTRY_DSN}
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

ENABLE_APP_INSIGHTS=true
APP_INSIGHTS_CONNECTION_STRING=${APP_INSIGHTS_CONNECTION_STRING}
APP_INSIGHTS_SAMPLING_PERCENTAGE=50

# ============================================================================
# Security Settings (Production - Strict)
# ============================================================================
JWT_SECRET=${JWT_SECRET}
JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
SESSION_SECRET=${SESSION_SECRET}
ENCRYPTION_KEY=${ENCRYPTION_KEY}
API_KEY_SALT=${API_KEY_SALT}

SESSION_DURATION=12h
JWT_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d
REQUIRE_2FA=true
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=15m

# Security Headers
ENABLE_HSTS=true
ENABLE_CSP=true
ENABLE_XSS_PROTECTION=true

# ============================================================================
# Performance & Scaling
# ============================================================================
ENABLE_COMPRESSION=true
ENABLE_CACHING=true
CACHE_TTL=3600

# Worker Settings
WORKER_PROCESSES=4
WORKER_MAX_MEMORY=512M

# ============================================================================
# Backup & Disaster Recovery
# ============================================================================
ENABLE_AUTO_BACKUP=true
BACKUP_RETENTION_DAYS=30
BACKUP_SCHEDULE="0 2 * * *"

# ============================================================================
# Compliance & Audit
# ============================================================================
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=365
ENABLE_DATA_ENCRYPTION_AT_REST=true

# ============================================================================
# Deployment Information
# ============================================================================
# This file is used by Azure DevOps pipeline: azure-pipelines-prod.yml
# Secrets are injected from Key Vault during deployment
# Managed Identity is used for Key Vault access in Azure Kubernetes Service
# All production deployments require approval and run through CI/CD pipeline
#
# Production deployment checklist:
# ✓ All secrets rotated within 90 days
# ✓ Database backups verified
# ✓ Monitoring alerts configured
# ✓ Incident response plan updated
# ✓ Change management approval obtained
