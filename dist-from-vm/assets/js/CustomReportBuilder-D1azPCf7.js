function e(){const e=o(),[K,B]=s.useState("builder"),[O,H]=s.useState(null),[P,U]=s.useState(""),[Y,G]=s.useState(""),[Q,W]=s.useState([]),[A,J]=s.useState([]),[X,Z]=s.useState([]),[ee,se]=s.useState([]),[re,ae]=s.useState([]),[te,le]=s.useState(!1),[ie,ce]=s.useState([]),[ne,oe]=s.useState([]),[de,me]=s.useState(!1),[ue,pe]=s.useState("daily"),[he,xe]=s.useState("09:00"),[je,ye]=s.useState(""),[ve,ge]=s.useState("csv"),{data:fe=[],isLoading:Ne}=d({queryKey:["customReports","dataSources"],queryFn:async()=>(await I.get("/custom-reports/data-sources")).data,gcTime:3e5}),{data:we=[],isLoading:Se}=d({queryKey:["customReports","templates"],queryFn:async()=>(await I.get("/custom-reports/templates")).data,gcTime:3e5}),{data:be=[],isLoading:Ce}=d({queryKey:["customReports","myReports"],queryFn:async()=>(await I.get("/custom-reports")).data,gcTime:3e5}),Re=Ne||Se||Ce;s.useMemo(()=>Q.flatMap(e=>{const s=fe.find(s=>s.id===e);return s?s.columns.map(r=>({...r,sourceId:e,sourceName:s.name})):[]}),[Q,fe]),m({mutationFn:async e=>O?.id?(await I.put(`/custom-reports/${O.id}`,e)).data:(await I.post("/custom-reports",e)).data,onSuccess:()=>{e.invalidateQueries({queryKey:["customReports","myReports"]}),u.success(O?.id?"Report updated successfully":"Report created successfully"),B("my-reports")},onError:e=>{q.error("Error saving report:",e),u.error("Failed to save report")}});const Ee=m({mutationFn:async({reportId:e,format:s})=>(await I.post(`/custom-reports/${e}/execute`,{format:s})).data,onSuccess:(e,s)=>{u.success(`Report executed! ${e.rowCount} rows generated.`),window.open(`/api/custom-reports/${s.reportId}/download/${e.executionId}`,"_blank")},onError:e=>{q.error("Error executing report:",e),u.error("Failed to execute report")}}),Fe=m({mutationFn:async()=>{if(!O?.id)throw new Error("No report selected");const e={hour:parseInt(he.split(":")[0]),minute:parseInt(he.split(":")[1])},s=je.split(",").map(e=>e.trim()).filter(e=>e);if(0===s.length)throw new Error("Please enter at least one recipient email");return(await I.post(`/custom-reports/${O.id}`,{schedule_type:ue,schedule_config:e,recipients:s,format:ve})).data},onSuccess:()=>{u.success("Report scheduled successfully"),me(!1)},onError:e=>{const s=e instanceof Error?e.message:"Failed to schedule report";q.error("Error scheduling report:",e),u.error(s)}}),ke=m({mutationFn:async({templateId:e,templateName:s})=>{const r=`${s} - ${(new Date).toLocaleDateString()}`;return(await I.post(`/custom-reports/from-template/${e}`,{report_name:r})).data},onSuccess:e=>{u.success("Template loaded successfully"),H(e),_e(e),B("builder")},onError:e=>{q.error("Error loading template:",e),u.error("Failed to load template")}}),_e=e=>{U(e.report_name),G(e.description||""),W(e.data_sources),J(e.columns),Z(e.filters),se(e.grouping),ae(e.sorting),le(e.is_public)};return Re?r.jsx("div",{className:"flex items-center justify-center h-96",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Loading report builder..."})]})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Custom Report Builder"}),r.jsx("p",{className:"text-gray-600",children:"Create and schedule custom reports with drag-and-drop interface"})]}),r.jsxs(p,{onClick:()=>{H(null),U(""),G(""),W([]),J([]),Z([]),se([]),ae([]),le(!1),B("builder")},children:[r.jsx(a,{className:"w-4 h-4 mr-2"}),"New Report"]})]}),r.jsxs(h,{value:K,onValueChange:B,children:[r.jsxs(x,{className:"grid w-full grid-cols-4",children:[r.jsxs(j,{value:"builder",children:[r.jsx(t,{className:"w-4 h-4 mr-2"}),"Report Builder"]}),r.jsxs(j,{value:"templates",children:[r.jsx(l,{className:"w-4 h-4 mr-2"}),"Templates"]}),r.jsxs(j,{value:"my-reports",children:[r.jsx(i,{className:"w-4 h-4 mr-2"}),"My Reports (",be.length,")"]}),r.jsxs(j,{value:"history",children:[r.jsx(c,{className:"w-4 h-4 mr-2"}),"Execution History"]})]}),r.jsx(y,{value:"builder",className:"space-y-6",children:r.jsxs(v,{children:[r.jsxs(g,{children:[r.jsx(f,{children:"Report Configuration"}),r.jsx(N,{children:"Define your custom report parameters"})]}),r.jsxs(w,{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Report Name *"}),r.jsx(S,{placeholder:"e.g., Monthly Fleet Utilization",value:P,onChange:e=>U(e.target.value)})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Description"}),r.jsx(S,{placeholder:"Optional description",value:Y,onChange:e=>G(e.target.value)})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Select Data Sources *"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(e=>r.jsx(b,{variant:Q.includes(e.id)?"default":"outline",className:"cursor-pointer",onClick:()=>{var s;Q.includes(s=e.id)?(W(Q.filter(e=>e!==s)),J(A.filter(e=>e.table!==s))):W([...Q,s])},children:e.name},e.id))})]}),r.jsx("div",{className:"space-y-2",children:r.jsxs(T,{children:["Selected Columns (",A.length,")"]})})]})]})}),r.jsx(y,{value:"templates",className:"space-y-6",children:r.jsxs(v,{children:[r.jsxs(g,{children:[r.jsx(f,{children:"Report Templates"}),r.jsx(N,{children:"Start with pre-configured report templates"})]}),r.jsx(w,{children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:we.map(e=>r.jsxs(v,{className:"hover:shadow-md transition-shadow",children:[r.jsxs(g,{className:"pb-2",children:[r.jsx(f,{className:"text-lg",children:e.template_name}),r.jsx(N,{children:e.category})]}),r.jsxs(w,{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),r.jsxs(p,{variant:"outline",className:"w-full",onClick:()=>{ke.mutate({templateId:e.id,templateName:e.template_name})},children:[r.jsx(l,{className:"w-4 h-4 mr-2"}),"Use Template"]})]})]},e.id))})})]})}),r.jsx(y,{value:"my-reports",className:"space-y-6",children:r.jsxs(v,{children:[r.jsxs(g,{children:[r.jsx(f,{children:"My Custom Reports"}),r.jsx(N,{children:"Manage your saved reports"})]}),r.jsx(w,{children:0===be.length?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-gray-500",children:"You haven't created any custom reports yet."}),r.jsx(p,{variant:"link",className:"mt-2",onClick:()=>B("builder"),children:"Create Your First Report"})]}):r.jsx("div",{className:"space-y-4",children:be.map(e=>r.jsxs("div",{className:"border rounded-lg p-4 flex flex-col md:flex-row justify-between items-start md:items-center hover:bg-gray-50",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium",children:e.report_name}),r.jsx("p",{className:"text-sm text-gray-500",children:e.description}),r.jsx("div",{className:"flex gap-2 mt-2",children:e.data_sources.map(e=>{const s=fe.find(s=>s.id===e);return s?r.jsx(b,{variant:"outline",children:s.name},e):null})})]}),r.jsxs("div",{className:"flex gap-2 mt-3 md:mt-0",children:[r.jsxs(p,{variant:"outline",size:"sm",onClick:()=>e.id&&((e,s="csv")=>{u.info("Executing report..."),Ee.mutate({reportId:e,format:s})})(e.id),children:[r.jsx(n,{className:"w-4 h-4 mr-2"}),"Run"]}),r.jsxs(p,{variant:"outline",size:"sm",onClick:()=>(e=>{H(e),_e(e),B("builder")})(e),children:[r.jsx(i,{className:"w-4 h-4 mr-2"}),"Edit"]})]})]},e.id))})})]})}),r.jsx(y,{value:"history",className:"space-y-6",children:r.jsxs(v,{children:[r.jsxs(g,{children:[r.jsx(f,{children:"Execution History"}),r.jsx(N,{children:"View past report executions"})]}),r.jsx(w,{children:r.jsx("p",{className:"text-center text-gray-500 py-8",children:"Execution history will be displayed here."})})]})})]}),r.jsx(C,{open:de,onOpenChange:me,children:r.jsxs(R,{children:[r.jsxs(E,{children:[r.jsx(F,{children:"Schedule Report"}),r.jsx(k,{children:"Set up automated report delivery"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Frequency"}),r.jsxs(D,{value:ue,onValueChange:pe,children:[r.jsx($,{children:r.jsx(L,{placeholder:"Select frequency"})}),r.jsxs(M,{children:[r.jsx(V,{value:"daily",children:"Daily"}),r.jsx(V,{value:"weekly",children:"Weekly"}),r.jsx(V,{value:"monthly",children:"Monthly"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Time"}),r.jsx(S,{type:"time",value:he,onChange:e=>xe(e.target.value)})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Recipients (comma-separated emails)"}),r.jsx(z,{placeholder:"Enter email addresses",value:je,onChange:e=>ye(e.target.value)})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(T,{children:"Format"}),r.jsxs(D,{value:ve,onValueChange:ge,children:[r.jsx($,{children:r.jsx(L,{placeholder:"Select format"})}),r.jsxs(M,{children:[r.jsx(V,{value:"csv",children:"CSV"}),r.jsx(V,{value:"pdf",children:"PDF"}),r.jsx(V,{value:"xlsx",children:"Excel"})]})]})]})]}),r.jsxs(_,{children:[r.jsx(p,{variant:"outline",onClick:()=>me(!1),children:"Cancel"}),r.jsx(p,{onClick:()=>{Fe.mutate()},children:"Schedule"})]})]})})]})}import{r as s,j as r,br as a,bf as t,bC as l,bD as i,as as c,ad as n}from"./react-core-hQu9tqS1.js";import{a as o,u as d,b as m}from"./query-vendor--Fe2N4Al.js";import{t as u}from"./index-savvei9t.js";import{h as p,T as h,a as x,b as j,c as y,C as v,d as g,e as f,i as N,f as w,I as S,B as b,D as C,j as R,k as E,l as F,m as k,n as _,p as q,o as I}from"./index-BDwglPMF.js";import{L as T}from"./label-C9sYRYKW.js";import{S as D,a as $,b as L,c as M,d as V}from"./select-Bmd3s7f4.js";import{T as z}from"./textarea-BOBjqKNu.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";export{e as CustomReportBuilder};
