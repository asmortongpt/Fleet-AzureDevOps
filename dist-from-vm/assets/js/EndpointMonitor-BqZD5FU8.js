function e({...e}){return r.jsx(D,{"data-slot":"collapsible",...e})}function t({...e}){return r.jsx(T,{"data-slot":"collapsible-trigger",...e})}function a({...e}){return r.jsx(E,{"data-slot":"collapsible-content",...e})}function s(){const[s,D]=n.useState([]),[T,E]=n.useState(!1),[M,P]=n.useState(null),[$,_]=n.useState(new Set(["core"])),H=function(e=!1){const[t,a]=n.useState(!1),[s,r]=n.useState(!1),[o,d]=n.useState(null),[l,c]=n.useState(null),[i,m]=n.useState(null),[u,x]=n.useState([]),g=n.useRef(null),h=n.useRef(null),p=n.useCallback(e=>{g.current?.readyState===WebSocket.OPEN&&g.current.close();const t="https:"===window.location.protocol?"wss:":"ws:",s="http://localhost:3000".replace(/^https?:\/\//,""),r=new WebSocket(`${t}//${s}/ws/obd2/${e}`);r.onopen=()=>{a(!0),d(null)},r.onmessage=e=>{try{const t=JSON.parse(e.data);"obd2_data"===t.type&&t.data?(m(t.data),x(e=>[...e.slice(-99),t.data])):"error"===t.type&&d(t.message)}catch(t){f.error("Failed to parse WebSocket message:",t)}},r.onclose=()=>{a(!1),l&&(h.current=setTimeout(()=>{p(e)},3e3))},r.onerror=()=>{d("WebSocket connection error")},g.current=r},[l]),b=n.useCallback(()=>{h.current&&clearTimeout(h.current),g.current&&(g.current.close(),g.current=null),a(!1)},[]),y=n.useCallback(async(e={})=>{r(!0),d(null);try{const t=await fetch(`${A}/api/obd2-emulator/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicleId:e.vehicleId||1,profile:e.profile||"sedan",scenario:e.scenario||"city",updateIntervalMs:e.updateIntervalMs||1e3})});if(!t.ok)throw new Error("Failed to start emulator");const a=await t.json();c(a.sessionId),x([]),p(a.sessionId)}catch(t){throw d(t.message),t}finally{r(!1)}},[p]),j=n.useCallback(async()=>{if(l)try{await fetch(`${A}/api/obd2-emulator/stop/${l}`,{method:"POST"}),b(),c(null),m(null)}catch(e){throw d(e.message),e}},[l,b]);return n.useEffect(()=>(e&&y(),()=>{b()}),[e]),{isConnected:t,isLoading:s,error:o,sessionId:l,data:i,startEmulator:y,stopEmulator:j,disconnect:b,dataHistory:u}}(!1),R=function(){const[e,t]=n.useState(null),[a,s]=n.useState(!1),[r,o]=n.useState([]),[d,l]=n.useState([]);return n.useEffect(()=>{const e=I(void 0,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});return t(e),()=>{e.close()}},[]),n.useEffect(()=>{if(!e)return;const t=()=>{s(!0)},a=()=>{s(!1)},r=e=>{};return e.on("connect",t),e.on("disconnect",a),e.on("connection_established",r),()=>{e.off("connect",t),e.off("disconnect",a),e.off("connection_established",r)}},[e]),n.useEffect(()=>{},[e,a,null]),n.useEffect(()=>{if(!e)return;const t=e=>{o(t=>[e,...t].slice(0,100))},a=e=>{o(t=>t.map(t=>t.id===e.transmission_id?{...t,transcript:e.transcript,processing_status:"complete"}:t))},s=e=>{"pending_approval"===e.execution_status&&l(t=>[e,...t])};return e.on("new_transmission",t),e.on("transcript_updated",a),e.on("policy_triggered",s),()=>{e.off("new_transmission",t),e.off("transcript_updated",a),e.off("policy_triggered",s)}},[e]),{isConnected:a,transmissions:r,pendingApprovals:d,approveExecution:n.useCallback(async(e,t)=>{try{(await fetch(`/api/v1/policies/executions/${e}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:t})})).ok&&l(t=>t.filter(t=>t.id!==e))}catch(a){f.error("Failed to approve execution",a)}},[]),rejectExecution:n.useCallback(async(e,t)=>{try{(await fetch(`/api/v1/policies/executions/${e}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:t})})).ok&&l(t=>t.filter(t=>t.id!==e))}catch(a){f.error("Failed to reject execution",a)}},[])}}(),F=O({autoConnect:!1}),L=[{endpoint:"/api/csrf",name:"CSRF Token",category:"core"},{endpoint:"/api/auth/login",name:"Authentication",category:"core"},{endpoint:"/api/vehicles",name:"Vehicles API",category:"core"},{endpoint:"/api/drivers",name:"Drivers API",category:"core"},{endpoint:"/api/telemetry",name:"Telemetry API",category:"core"},{endpoint:"/api/work-orders",name:"Work Orders",category:"management"},{endpoint:"/api/maintenance-schedules",name:"Maintenance",category:"management"},{endpoint:"/api/inspections",name:"Inspections",category:"management"},{endpoint:"/api/fuel-transactions",name:"Fuel Tracking",category:"management"},{endpoint:"/api/purchase-orders",name:"Purchase Orders",category:"management"},{endpoint:"/api/routes",name:"Routes",category:"analytics"},{endpoint:"/api/geofences",name:"Geofences",category:"analytics"},{endpoint:"/api/safety-incidents",name:"Safety Incidents",category:"analytics"},{endpoint:"/api/traffic-cameras",name:"Traffic Cameras",category:"analytics"},{endpoint:"/api/teams",name:"MS Teams",category:"integration"},{endpoint:"/api/outlook/messages",name:"Outlook",category:"integration"},{endpoint:"/api/calendar/events",name:"Calendar",category:"integration"},{endpoint:"/api/arcgis-layers",name:"ArcGIS Layers",category:"integration"}],W=n.useMemo(()=>[{name:"OBD2 Emulator",url:"ws://localhost:8081",port:8081,isConnected:H.isConnected,lastConnected:H.isConnected?new Date:null,lastDisconnected:H.isConnected?null:new Date,reconnectAttempts:0,messagesReceived:H.dataHistory.length,latency:H.data?50:null},{name:"Radio Dispatch",url:"ws://localhost:8082",port:8082,isConnected:R.isConnected,lastConnected:R.isConnected?new Date:null,lastDisconnected:R.isConnected?null:new Date,reconnectAttempts:0,messagesReceived:R.transmissions.length,latency:R.isConnected?40:null},{name:"Dispatch Console",url:"ws://localhost:8083",port:8083,isConnected:F.isConnected,lastConnected:F.isConnected?new Date:null,lastDisconnected:F.isConnected?null:new Date,reconnectAttempts:0,messagesReceived:F.recentTransmissions.length,latency:F.isConnected?45:null}],[H,R,F]),z=n.useCallback(async e=>{const t=performance.now();try{const a=await fetch(`${window.location.origin}${e}`,{method:"HEAD",credentials:"include"}),s=performance.now(),r=Math.round(s-t);return{status:a.ok?"healthy":500>a.status?"degraded":"down",latency:r,lastChecked:new Date,errorCount:a.ok?0:1}}catch(a){const e=performance.now();return{status:"down",latency:Math.round(e-t),lastChecked:new Date,errorCount:1}}},[]),J=n.useCallback(async()=>{E(!0);const e=await Promise.all(L.map(async e=>{const t=await z(e.endpoint);return{...e,status:t.status||"unknown",latency:t.latency||null,lastChecked:t.lastChecked||null,uptime:"healthy"===t.status?99.9:"degraded"===t.status?95:0,errorCount:t.errorCount||0}}));D(e),P(new Date),E(!1)},[z]);n.useEffect(()=>{J();const e=setInterval(J,3e4);return()=>clearInterval(e)},[J]);const B=e=>e?100>e?"text-green-600 dark:text-green-400":300>e?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400":"text-muted-foreground",G=n.useMemo(()=>{const e=new Map;return s.forEach(t=>{e.has(t.category)||e.set(t.category,[]),e.get(t.category).push(t)}),e},[s]),U=n.useMemo(()=>{const e=s.length,t=s.filter(e=>"healthy"===e.status).length;return{total:e,healthy:t,degraded:s.filter(e=>"degraded"===e.status).length,down:s.filter(e=>"down"===e.status).length,avgLatency:s.filter(e=>null!==e.latency).reduce((e,t)=>e+(t.latency||0),0)/e||0,overallHealth:e>0?t/e*100:0}},[s]);return r.jsxs("div",{className:"space-y-4",children:[r.jsxs(y,{className:"border-border/50 bg-card dark:bg-card",children:[r.jsx(j,{className:"pb-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(k,{className:"text-lg font-semibold flex items-center gap-2",children:[r.jsx(o,{className:"w-5 h-5 text-primary",weight:"duotone"}),"Endpoint Health Monitor"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[M&&r.jsxs("span",{className:"text-xs text-muted-foreground dark:text-muted-foreground",children:["Updated ",M.toLocaleTimeString()]}),r.jsxs(v,{size:"sm",variant:"outline",onClick:J,disabled:T,className:"h-8 text-xs",children:[r.jsx(d,{className:"w-3.5 h-3.5 mr-1.5 "+(T?"animate-spin":"")}),"Refresh"]})]})]})}),r.jsxs(w,{className:"space-y-3 pb-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"font-medium dark:text-foreground",children:"Overall System Health"}),r.jsxs("span",{className:"font-semibold "+(U.overallHealth>90?"text-green-600 dark:text-green-400":U.overallHealth>70?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"),children:[U.overallHealth.toFixed(1),"%"]})]}),r.jsx(N,{value:U.overallHealth,className:"h-2 bg-muted dark:bg-muted"})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[r.jsxs("div",{className:"text-center p-2 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:[r.jsx("div",{className:"text-2xl font-bold text-green-700 dark:text-green-400",children:U.healthy}),r.jsx("div",{className:"text-xs text-green-600 dark:text-green-500",children:"Healthy"})]}),r.jsxs("div",{className:"text-center p-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800",children:[r.jsx("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-400",children:U.degraded}),r.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-500",children:"Degraded"})]}),r.jsxs("div",{className:"text-center p-2 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[r.jsx("div",{className:"text-2xl font-bold text-red-700 dark:text-red-400",children:U.down}),r.jsx("div",{className:"text-xs text-red-600 dark:text-red-500",children:"Down"})]}),r.jsxs("div",{className:"text-center p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800",children:[r.jsxs("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-400",children:[Math.round(U.avgLatency),"ms"]}),r.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-500",children:"Avg Latency"})]})]})]})]}),r.jsxs(y,{className:"border-border/50 bg-card dark:bg-card",children:[r.jsx(j,{className:"pb-3",children:r.jsxs(k,{className:"text-base font-semibold flex items-center gap-2",children:[r.jsx(l,{className:"w-4 h-4 text-blue-600 dark:text-blue-400",weight:"duotone"}),"WebSocket Connections"]})}),r.jsx(w,{className:"space-y-2 pb-4",children:W.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border/50 bg-muted/30 dark:bg-muted/10 hover:bg-muted/50 dark:hover:bg-muted/20 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 rounded-full "+(e.isConnected?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800"),children:r.jsx(c,{className:"w-4 h-4 "+(e.isConnected?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-600"),weight:"duotone"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm font-medium dark:text-foreground",children:e.name}),r.jsxs(C,{variant:"outline",className:"text-[10px] h-5 "+(e.isConnected?"bg-green-100 text-green-700 border-green-300 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800":"bg-gray-100 text-gray-600 border-gray-300 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700"),children:[r.jsx(i,{className:"w-2 h-2 mr-1 "+(e.isConnected?"fill-green-500 animate-pulse":"fill-gray-400"),weight:"fill"}),e.isConnected?"Connected":"Disconnected"]})]}),r.jsxs("div",{className:"text-xs text-muted-foreground dark:text-muted-foreground mt-0.5",children:[e.url," â€¢ Port ",e.port]})]})]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.latency&&r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:`font-medium ${B(e.latency)}`,children:[e.latency,"ms"]}),r.jsx("div",{className:"text-muted-foreground dark:text-muted-foreground",children:"Latency"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"font-medium dark:text-foreground",children:e.messagesReceived}),r.jsx("div",{className:"text-muted-foreground dark:text-muted-foreground",children:"Messages"})]})]})]},e.name))})]}),r.jsx("div",{className:"space-y-3",children:Array.from(G.entries()).map(([s,n])=>{const o=$.has(s),d=n.filter(e=>"healthy"===e.status).length,l=n.length,c=d/l*100;return r.jsx(y,{className:"border-border/50 bg-card dark:bg-card overflow-hidden",children:r.jsxs(e,{open:o,onOpenChange:()=>(e=>{_(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})})(s),children:[r.jsx(t,{asChild:!0,children:r.jsx("button",{className:"w-full",children:r.jsx(j,{className:"pb-3 cursor-pointer hover:bg-muted/30 dark:hover:bg-muted/10 transition-colors",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(m,{className:"w-4 h-4 text-primary dark:text-primary",weight:"duotone"}),r.jsxs(k,{className:"text-base font-semibold capitalize dark:text-foreground",children:[s," APIs"]}),r.jsxs(C,{variant:"outline",className:"text-[10px] h-5 dark:border-border dark:bg-muted/20 dark:text-foreground",children:[d,"/",l]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"text-xs font-medium dark:text-foreground",children:[c.toFixed(0),"%"]}),r.jsx(N,{value:c,className:"w-20 h-1.5 bg-muted dark:bg-muted"})]}),r.jsx(o?u:x,{className:"w-4 h-4 text-muted-foreground dark:text-muted-foreground"})]})]})})})}),r.jsx(a,{children:r.jsx(w,{className:"pt-0 pb-4",children:r.jsx(S,{className:"max-h-[400px]",children:r.jsx("div",{className:"space-y-2",children:n.map(e=>{const t=(e=>{switch(e){case"healthy":return{variant:"default",className:"bg-green-100 text-green-700 border-green-300 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800",icon:b};case"degraded":return{variant:"default",className:"bg-yellow-100 text-yellow-700 border-yellow-300 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-800",icon:p};case"down":return{variant:"destructive",className:"bg-red-100 text-red-700 border-red-300 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800",icon:h};default:return{variant:"outline",className:"bg-gray-100 text-gray-700 border-gray-300 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700",icon:i}}})(e.status);return r.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border/50 bg-muted/20 dark:bg-muted/5 hover:bg-muted/40 dark:hover:bg-muted/10 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[r.jsx(t.icon,{className:"w-4 h-4 flex-shrink-0",weight:"fill"}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("div",{className:"text-sm font-medium truncate dark:text-foreground",children:e.name}),r.jsx("div",{className:"text-xs text-muted-foreground dark:text-muted-foreground truncate",children:e.endpoint})]})]}),r.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[r.jsx(C,{variant:t.variant,className:`text-[10px] h-5 ${t.className}`,children:e.status}),null!==e.latency&&r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:`text-xs font-medium ${B(e.latency)}`,children:[e.latency,"ms"]})}),e.lastChecked&&r.jsx("div",{className:"text-right hidden sm:block",children:r.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground dark:text-muted-foreground",children:[r.jsx(g,{className:"w-3 h-3"}),e.lastChecked.toLocaleTimeString()]})})]})]},e.endpoint)})})})})})]})},s)})})]})}import{j as r,r as n,ak as o,bi as d,x as l,bm as c,bw as i,bx as m,bo as u,bp as x,as as g,by as h,bz as p,ah as b}from"./react-core-hQu9tqS1.js";import{p as f,C as y,d as j,e as k,h as v,f as w,P as N,B as C,S}from"./index-BDwglPMF.js";import{O as D,Q as T,U as E}from"./ui-radix-C-X5Qx_8.js";import{l as I,u as O}from"./useDispatchSocket-C_8Ly_Ll.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./query-vendor--Fe2N4Al.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";const A=void 0;export{s as EndpointMonitor};
