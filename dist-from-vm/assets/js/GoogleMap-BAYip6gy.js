function e({vehicles:e=[],facilities:s=[],cameras:d=[],showVehicles:u=!0,showFacilities:m=!0,showCameras:g=!1,showRoutes:f=!1,mapStyle:b="roadmap",center:x=[-84.2807,30.4383],zoom:y=12,className:v="",onReady:h,onError:w,forceSimulatedView:k=!1,onVehicleAction:C}){const z=a.useRef(null),E=a.useRef(null),I=a.useRef([]),j=a.useRef(null),[T,$]=a.useState(!0),[S,R]=a.useState(null),[A,N]=a.useState(0),[L,O]=a.useState(!1);a.useEffect(()=>(window.gm_authFailure||(window.gm_authFailure=()=>{l.error("Google Maps Authentication Failure detected"),O(!0),$(!1)}),()=>{}),[]),a.useEffect(()=>{const e=e=>{C&&C(e.detail.action,e.detail.vehicleId)};return window.addEventListener("vehicle-action",e),()=>{window.removeEventListener("vehicle-action",e)}},[C]);const M=a.useCallback(()=>p||(window.google?.maps&&"loaded"===c?Promise.resolve():(c="loading",p=new Promise((e,t)=>{if(window.google?.maps)return c="loaded",p=null,void e();const o=document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]');o&&o.remove();const n=document.createElement("script");n.src="https://maps.googleapis.com/maps/api/js?key=&libraries=places,geometry,drawing",n.async=!0,n.defer=!0,n.onload=()=>{window.google?.maps?(c="loaded",p=null,e()):(c="error",p=null,t(new Error("Google Maps API loaded but not available")))},n.onerror=()=>{c="error",p=null,n.remove(),t(new Error("Failed to load Google Maps API script"))},document.head.appendChild(n),setTimeout(()=>{"loading"===c&&(c="error",p=null,n.remove(),t(new Error("Google Maps API loading timeout")))},3e4)}),p)),[""]);a.useCallback(()=>{R(null),$(!0),N(e=>e+1),p=null,c="idle"},[]),a.useEffect(()=>{$(!1)},[!1,M,A]),a.useEffect(()=>{if(z.current&&window.google?.maps&&!T&&!S)if(E.current)E.current.setCenter({lat:x[1],lng:x[0]}),E.current.setZoom(y),E.current.setMapTypeId(b);else try{E.current=new google.maps.Map(z.current,{center:{lat:x[1],lng:x[0]},zoom:y,mapTypeId:b,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN]},fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0,rotateControl:!0,gestureHandling:"auto",backgroundColor:"#e5e7eb",clickableIcons:!0,disableDoubleClickZoom:!1,keyboardShortcuts:!0}),setTimeout(()=>{try{const e=z.current;if(e){const t=e.querySelector('button[title="Zoom in"]');t&&t.setAttribute("data-testid","map-zoom-in");const o=e.querySelector('button[title="Zoom out"]');o&&o.setAttribute("data-testid","map-zoom-out");const n=e.querySelector('button[title="Toggle fullscreen view"]');n&&n.setAttribute("data-testid","map-fullscreen")}}catch(e){l.debug("[GoogleMap] Could not add test IDs to controls:",e)}},1e3),h&&h()}catch(e){const t=e instanceof Error?e:new Error("Unknown error");return R(`Failed to initialize map: ${t.message}`),void(w&&w(t))}},[T,S,x,y,b]);const P=a.useCallback(()=>{I.current.forEach(({marker:e,infoWindow:t})=>{t&&t.close(),e.setMap(null)}),I.current=[]},[]);return a.useEffect(()=>{if(!E.current||!window.google?.maps||T||S)return;P();const a=[],i=new google.maps.LatLngBounds;let p=!1;try{u&&e.length>0&&e.forEach(e=>{if(!e.location?.lat||!e.location?.lng)return;const n=new google.maps.Marker({position:{lat:e.location?.lat,lng:e.location?.lng},map:E.current,title:e.name,optimized:!0,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:t(e.status),fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2,scale:8}});google.maps.event.addListenerOnce(n,"visible",()=>{const t=n.getDiv?.();t&&(t.setAttribute("data-testid","vehicle-marker"),t.setAttribute("data-vehicle-id",e.id))});const r=new google.maps.InfoWindow({content:o(e)});n.addListener("click",()=>{I.current.forEach(({infoWindow:e})=>e?.close()),r.open(E.current,n)}),a.push({marker:n,infoWindow:r}),i.extend({lat:e.location?.lat,lng:e.location?.lng}),p=!0}),m&&s.length>0&&s.forEach(e=>{if(!e.location?.lat||!e.location?.lng)return;const t=new google.maps.Marker({position:{lat:e.location?.lat,lng:e.location?.lng},map:E.current,title:e.name,optimized:!0,icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,fillColor:"operational"===e.status?"#10b981":"#f59e0b",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2,scale:6,rotation:0}}),o=new google.maps.InfoWindow({content:n(e)});t.addListener("click",()=>{I.current.forEach(({infoWindow:e})=>e?.close()),o.open(E.current,t)}),a.push({marker:t,infoWindow:o}),i.extend({lat:e.location?.lat,lng:e.location?.lng}),p=!0}),g&&d.length>0&&d.forEach(e=>{if(!e.latitude||!e.longitude)return;const t=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:E.current,title:e.name,optimized:!0,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:e.operational?"#3b82f6":"#6b7280",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2,scale:7}}),o=new google.maps.InfoWindow({content:r(e)});t.addListener("click",()=>{I.current.forEach(({infoWindow:e})=>e?.close()),o.open(E.current,t)}),a.push({marker:t,infoWindow:o}),i.extend({lat:e.latitude,lng:e.longitude}),p=!0}),I.current=a,p&&E.current&&(E.current.fitBounds(i),j.current&&google.maps.event.removeListener(j.current),j.current=google.maps.event.addListenerOnce(E.current,"idle",()=>{if(E.current){const e=E.current.getZoom();void 0!==e&&e>15&&E.current.setZoom(15)}j.current=null}))}catch(c){l.error("Error updating markers:",c),R(`Failed to update markers: ${c instanceof Error?c.message:"Unknown error"}`)}return()=>{P(),j.current&&(google.maps.event.removeListener(j.current),j.current=null)}},[e,s,d,u,m,g,T,S,P]),a.useEffect(()=>()=>{E.current&&(google.maps.event.clearInstanceListeners(E.current),E.current=null)},[]),i.jsxs("div",{className:`relative w-full h-full min-h-[500px] bg-slate-950 overflow-hidden ${v}`,children:[i.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"linear-gradient(rgba(51, 65, 85, 0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(51, 65, 85, 0.3) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),i.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-transparent via-emerald-500/10 to-transparent animate-spin-slow opacity-20",style:{animationDuration:"8s"}}),i.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:[i.jsx("div",{className:"w-64 h-64 border border-emerald-500/20 rounded-full flex items-center justify-center",children:i.jsx("div",{className:"w-48 h-48 border border-emerald-500/20 rounded-full flex items-center justify-center",children:i.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"})})}),i.jsx("div",{className:"absolute w-full h-px bg-emerald-500/20"}),i.jsx("div",{className:"absolute h-full w-px bg-emerald-500/20"})]}),e.map(e=>{const t=e.id.split("").reduce((e,t)=>e+t.charCodeAt(0),0);return i.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 group cursor-pointer animate-patrol",style:{top:17*t%70+15+"%",left:31*t%70+15+"%",animationDuration:20+t%15+"s",animationDelay:-t%20+"s","--tx-1":t%50-25+"px","--ty-1":t%40-20+"px","--tx-2":t%60-30+"px","--ty-2":t%50-25+"px","--tx-3":t%40-20+"px","--ty-3":t%60-30+"px"},children:i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:`w-3 h-3 rounded-full ${"active"===e.status?"bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]":"bg-slate-500"} transition-all`}),i.jsx("div",{className:"absolute -inset-2 border border-emerald-500/30 rounded-full opacity-0 group-hover:opacity-100 scale-0 group-hover:scale-100 transition-all duration-300"}),i.jsxs("div",{className:"absolute left-4 top-0 bg-slate-900 border border-emerald-500/30 px-2 py-1 rounded text-[10px] font-mono whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity z-20 pointer-events-none backdrop-blur-md shadow-xl",children:[i.jsx("div",{className:"text-emerald-400 font-bold",children:e.name}),i.jsx("div",{className:"text-slate-400",children:e.status.toUpperCase()}),i.jsxs("div",{className:"text-[9px] text-slate-500 mt-1",children:["LAT: ","number"==typeof e.location?.lat?e.location.lat.toFixed(4):"N/A"]})]})]})},e.id)})]})}function t(e){return{active:"#10b981",idle:"#6b7280",charging:"#3b82f6",service:"#f59e0b",emergency:"#ef4444",offline:"#374151"}[e]||"#6b7280"}function o(e){const o=e.location?.address||(e.location?.lat&&e.location?.lng?`${e.location?.lat.toFixed(4)}, ${e.location?.lng.toFixed(4)}`:"Unknown");return`\n    <div data-testid="marker-popup" style="padding: 14px; min-width: 220px; max-width: 320px; font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;">\n      <div data-testid="popup-vehicle-id" style="font-weight: 600; font-size: 15px; margin-bottom: 10px; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 6px;">\n        ${s(e.name||"Unknown Vehicle")}\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between;">\n        <strong style="color: #6b7280;">Type:</strong>\n        <span style="text-transform: capitalize;">${s(e.type||"Unknown")}</span>\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between;">\n        <strong style="color: #6b7280;">Status:</strong>\n        <span data-testid="popup-vehicle-status" style="color: ${t(e.status)}; font-weight: 600; text-transform: uppercase; font-size: 12px;">\n          ${s(e.status)}\n        </span>\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between;">\n        <strong style="color: #6b7280;">Driver:</strong>\n        <span>${s(e.driver||"Unassigned")}</span>\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">\n        <strong style="color: #6b7280; display: block; margin-bottom: 4px;">Location:</strong>\n        <span style="font-size: 12px; color: #6b7280;">${s(o)}</span>\n      </div>\n      \n      <div style="margin-top: 12px; display: flex; gap: 8px;">\n        <button \n          onclick="(function(){ window.dispatchEvent(new CustomEvent('vehicle-action', { detail: { action: 'maintenance', vehicleId: '${s(e.id)}' } })); })()"\n          style="flex: 1; border: 1px solid #e5e7eb; background: #f9fafb; color: #374151; border-radius: 6px; padding: 6px 12px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s;"\n          onmouseover="this.style.background='#f3f4f6'"\n          onmouseout="this.style.background='#f9fafb'"\n        >\n          Report Issue\n        </button>\n      </div>\n    </div>\n  `}function n(e){return`\n    <div style="padding: 14px; min-width: 220px; max-width: 320px; font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;">\n      <div style="font-weight: 600; font-size: 15px; margin-bottom: 10px; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 6px;">\n        ${s(e.name)}\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between;">\n        <strong style="color: #6b7280;">Type:</strong>\n        <span style="text-transform: capitalize;">${s(e.type.replace(/-/g," "))}</span>\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between;">\n        <strong style="color: #6b7280;">Status:</strong>\n        <span style="color: ${"operational"===e.status?"#10b981":"#f59e0b"}; font-weight: 600; text-transform: uppercase; font-size: 12px;">\n          ${s(e.status)}\n        </span>\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between;">\n        <strong style="color: #6b7280;">Capacity:</strong>\n        <span>${s(String(e.capacity))} vehicles</span>\n      </div>\n      <div style="font-size: 13px; color: #4b5563; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">\n        <strong style="color: #6b7280; display: block; margin-bottom: 4px;">Address:</strong>\n        <span style="font-size: 12px; color: #6b7280;">${s(e.address)}</span>\n      </div>\n    </div>\n  `}function r(e){const t=e.address?`\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px;">\n        <strong style="color: #6b7280;">Address:</strong><br/>\n        <span style="font-size: 12px;">${s(e.address)}</span>\n      </div>\n    `:"",o=e.crossStreets?`\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px;">\n        <strong style="color: #6b7280;">Cross Streets:</strong><br/>\n        <span style="font-size: 12px;">${s(e.crossStreets)}</span>\n      </div>\n    `:"",n=e.cameraUrl?`\n      <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb;">\n        <a\n          href="${s(e.cameraUrl)}"\n          target="_blank"\n          rel="noopener noreferrer"\n          style="\n            display: inline-block;\n            background-color: #3b82f6;\n            color: white;\n            padding: 8px 16px;\n            border-radius: 6px;\n            text-decoration: none;\n            font-size: 13px;\n            font-weight: 500;\n            transition: background-color 0.2s;\n          "\n          onmouseover="this.style.backgroundColor='#2563eb'"\n          onmouseout="this.style.backgroundColor='#3b82f6'"\n        >\n          üìπ View Live Feed\n        </a>\n      </div>\n    `:"";return`\n    <div style="padding: 14px; min-width: 250px; max-width: 350px; font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;">\n      <div style="font-weight: 600; font-size: 15px; margin-bottom: 10px; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 6px;">\n        ${s(e.name)}\n      </div>\n      ${t}\n      ${o}\n      <div style="font-size: 13px; color: #4b5563; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;">\n        <strong style="color: #6b7280;">Status:</strong>\n        <span style="\n          color: ${e.operational?"#10b981":"#ef4444"};\n          font-weight: 600;\n          text-transform: uppercase;\n          font-size: 12px;\n          background-color: ${e.operational?"#d1fae5":"#fee2e2"};\n          padding: 3px 8px;\n          border-radius: 4px;\n        ">\n          ${e.operational?"‚óè Operational":"‚óè Offline"}\n        </span>\n      </div>\n      ${n}\n    </div>\n  `}function s(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}import{r as a,j as i}from"./react-core-hQu9tqS1.js";import{p as l}from"./index-BDwglPMF.js";let p=null,c="idle";export{e as G};
