function e({onZoomIn:e,onZoomOut:s,onLocate:t,onToggleLayers:a,onToggleFullscreen:l,className:i,isFullscreen:r=!1}){const[n,c]=j.useState(!1),d="h-11 w-11 sm:h-10 sm:w-10",o="h-5 w-5";return f.jsxs("div",{className:pe("fixed bottom-20 right-4 z-40 flex flex-col gap-2","sm:bottom-4 sm:right-4",i),"data-testid":"mobile-map-controls",children:[l&&f.jsx(je,{variant:"default",size:"icon",className:pe(d,"rounded-full shadow-lg bg-white text-slate-900 hover:bg-slate-100","active:scale-95 transition-all touch-manipulation"),onClick:l,"aria-label":r?"Exit fullscreen":"Enter fullscreen","data-testid":"fullscreen-control",children:f.jsx(r?g:v,{className:o})}),a&&f.jsx(je,{variant:"default",size:"icon",className:pe(d,"rounded-full shadow-lg bg-white text-slate-900 hover:bg-slate-100","active:scale-95 transition-all touch-manipulation"),onClick:a,"aria-label":"Toggle layers","data-testid":"layers-control",children:f.jsx(b,{className:o})}),t&&f.jsx(je,{variant:"default",size:"icon",className:pe(d,"rounded-full shadow-lg bg-white text-slate-900 hover:bg-slate-100","active:scale-95 transition-all touch-manipulation"),onClick:t,"aria-label":"Locate me","data-testid":"locate-control",children:f.jsx(N,{className:o})}),f.jsxs("div",{className:"flex flex-col gap-1 bg-white rounded-full shadow-lg p-1",children:[e&&f.jsx(je,{variant:"ghost",size:"icon",className:pe(d,"rounded-full hover:bg-slate-100","active:scale-95 transition-all touch-manipulation"),onClick:e,"aria-label":"Zoom in","data-testid":"zoom-in-control",children:f.jsx(w,{className:o})}),s&&f.jsx(je,{variant:"ghost",size:"icon",className:pe(d,"rounded-full hover:bg-slate-100","active:scale-95 transition-all touch-manipulation"),onClick:s,"aria-label":"Zoom out","data-testid":"zoom-out-control",children:f.jsx(y,{className:o})})]})]})}function s({actions:e,title:s,className:t,layout:a="horizontal-scroll",columns:l=2}){const[i,r]=j.useState(0),n=j.useRef(null),c=e=>{if(!n.current)return;const s=n.current,t=.8*s.offsetWidth;s.scrollBy("left"===e?{left:-t,behavior:"smooth"}:{left:t,behavior:"smooth"})},d=i>10,o=!!n.current&&n.current.scrollWidth-n.current.offsetWidth-10>i;return f.jsxs("div","grid"===a?{className:pe("space-y-3",t),"data-testid":"mobile-quick-actions-grid",children:[s&&f.jsx("h3",{className:"text-sm font-semibold text-slate-700 px-1",children:s}),f.jsx("div",{className:pe("grid gap-2",2===l&&"grid-cols-2",3===l&&"grid-cols-3",4===l&&"grid-cols-4"),children:e.map(e=>f.jsxs(je,{variant:e.variant||"outline",size:"lg",onClick:e.onClick,disabled:e.disabled,className:pe("h-20 flex flex-col items-center justify-center gap-2 relative","active:scale-95 transition-all touch-manipulation"),"data-testid":`quick-action-${e.id}`,children:[f.jsx("div",{className:"text-slate-600",children:e.icon}),f.jsx("span",{className:"text-xs font-medium leading-tight text-center",children:e.label}),e.badge&&f.jsx("div",{className:"absolute top-1 right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.badge})]},e.id))})]}:{className:pe("relative space-y-2",t),"data-testid":"mobile-quick-actions-scroll",children:[s&&f.jsx("h3",{className:"text-sm font-semibold text-slate-700 px-1",children:s}),f.jsxs("div",{className:"relative",children:[d&&f.jsx("button",{onClick:()=>c("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 backdrop-blur-sm rounded-full p-2 shadow-lg","aria-label":"Scroll left","data-testid":"scroll-left",children:f.jsx(C,{className:"h-5 w-5 text-slate-700"})}),f.jsx("div",{ref:n,onScroll:()=>{n.current&&r(n.current.scrollLeft)},className:"flex gap-3 overflow-x-auto scrollbar-hide snap-x snap-mandatory px-1 py-2",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:e.map(e=>f.jsx(fe,{className:pe("flex-shrink-0 snap-start","w-28 sm:w-32",e.disabled&&"opacity-50 pointer-events-none"),children:f.jsx(ge,{className:"p-0",children:f.jsxs("button",{onClick:e.onClick,disabled:e.disabled,className:"w-full h-full p-4 flex flex-col items-center justify-center gap-2 relative active:scale-95 transition-all touch-manipulation","data-testid":`quick-action-${e.id}`,children:[f.jsx("div",{className:"text-slate-600",children:e.icon}),f.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:e.label}),e.badge&&f.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.badge})]})})},e.id))}),o&&f.jsx("button",{onClick:()=>c("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 backdrop-blur-sm rounded-full p-2 shadow-lg","aria-label":"Scroll right","data-testid":"scroll-right",children:f.jsx(k,{className:"h-5 w-5 text-slate-700"})})]})]})}function t({vehicle:e,onClick:s,onQuickAction:t,variant:a="compact",showQuickActions:l=!1,className:i}){const r={active:{color:"bg-green-500",label:"Active",icon:T},maintenance:{color:"bg-amber-500",label:"Maintenance",icon:S},service:{color:"bg-amber-500",label:"Service",icon:I},inactive:{color:"bg-gray-500",label:"Inactive",icon:L},idle:{color:"bg-blue-400",label:"Idle",icon:L},charging:{color:"bg-green-400",label:"Charging",icon:A},emergency:{color:"bg-red-600",label:"Emergency",icon:S},offline:{color:"bg-gray-400",label:"Offline",icon:E},"out-of-service":{color:"bg-red-500",label:"Out of Service",icon:S}},n=r[e.status]||r.inactive,c=n.icon;return"list"===a?f.jsxs("div",{onClick:()=>s?.(e),className:pe("flex items-center gap-3 p-3 border-b border-slate-200","active:bg-slate-50 transition-colors touch-manipulation cursor-pointer",i),"data-testid":`vehicle-card-list-${e.id}`,children:[f.jsx("div",{className:pe("w-1 h-14 rounded-full",n.color)}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("span",{className:"font-semibold text-sm truncate",children:e.id}),e.alerts&&e.alerts.length>0&&f.jsx(ve,{variant:"destructive",className:"h-5 text-xs px-1.5",children:e.alerts.length})]}),f.jsxs("div",{className:"text-xs text-muted-foreground truncate",children:[e.make," ",e.model," ",e.year]}),e.driver&&f.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[f.jsx(F,{className:"h-3 w-3"}),f.jsx("span",{className:"truncate",children:e.driver})]})]}),f.jsxs("div",{className:"flex flex-col items-end gap-1",children:[void 0!==e.fuelLevel&&f.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[f.jsx(z,{className:"h-3 w-3 text-muted-foreground"}),f.jsxs("span",{className:"font-medium",children:[e.fuelLevel,"%"]})]}),f.jsx(ve,{variant:"active"===e.status?"default":"secondary",className:"text-xs",children:n.label})]}),f.jsx(k,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"})]}):f.jsx(fe,"compact"===a?{onClick:()=>s?.(e),className:pe("overflow-hidden active:scale-[0.98] transition-transform touch-manipulation cursor-pointer",i),"data-testid":`vehicle-card-compact-${e.id}`,children:f.jsxs(ge,{className:"p-4",children:[f.jsxs("div",{className:"flex items-start justify-between mb-3",children:[f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(D,{className:"h-4 w-4 text-slate-600 flex-shrink-0"}),f.jsx("h3",{className:"font-semibold text-sm truncate",children:e.id})]}),f.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.make," ",e.model]})]}),f.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.alerts&&e.alerts.length>0&&f.jsx(ve,{variant:"destructive",className:"h-5 text-xs px-1.5",children:e.alerts.length}),f.jsx(c,{className:pe("h-4 w-4",n.color.replace("bg-","text-"))})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[void 0!==e.fuelLevel&&f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx(z,{className:"h-3.5 w-3.5 text-muted-foreground"}),f.jsx("span",{className:"text-muted-foreground",children:"Fuel:"}),f.jsxs("span",{className:"font-medium",children:[e.fuelLevel,"%"]})]}),void 0!==e.odometer&&f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx(O,{className:"h-3.5 w-3.5 text-muted-foreground"}),f.jsx("span",{className:"text-muted-foreground",children:"Miles:"}),f.jsx("span",{className:"font-medium",children:e.odometer.toLocaleString()})]})]}),f.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100",children:f.jsx(ve,{variant:"active"===e.status?"default":"secondary",className:"w-full justify-center text-xs py-1",children:n.label})})]})}:{onClick:()=>s?.(e),className:pe("overflow-hidden active:scale-[0.98] transition-transform touch-manipulation cursor-pointer",i),"data-testid":`vehicle-card-detailed-${e.id}`,children:f.jsxs(ge,{className:"p-4",children:[f.jsxs("div",{className:"flex items-start justify-between mb-4",children:[f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(D,{className:"h-5 w-5 text-slate-600 flex-shrink-0"}),f.jsx("h3",{className:"font-bold text-base truncate",children:e.id})]}),f.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.make," ",e.model," ",e.year]})]}),f.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.alerts&&e.alerts.length>0&&f.jsxs(ve,{variant:"destructive",className:"h-6 text-xs px-2",children:[e.alerts.length," Alert",e.alerts.length>1?"s":""]}),f.jsxs(ve,{variant:"active"===e.status?"default":"secondary",className:"h-6 text-xs px-2",children:[f.jsx(c,{className:"h-3 w-3 mr-1"}),n.label]})]})]}),f.jsxs("div",{className:"space-y-2.5 mb-4",children:[e.driver&&f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx(F,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),f.jsx("span",{className:"text-muted-foreground",children:"Driver:"}),f.jsx("span",{className:"font-medium flex-1 truncate",children:e.driver})]}),void 0!==e.location?.latitude&&void 0!==e.location?.longitude&&f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx(M,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),f.jsx("span",{className:"text-muted-foreground",children:"Location:"}),f.jsxs("span",{className:"font-medium text-xs",children:[e.location.latitude.toFixed(4),", ",e.location.longitude.toFixed(4)]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[void 0!==e.fuelLevel&&f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx(z,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-muted-foreground",children:"Fuel"}),f.jsxs("div",{className:"font-semibold",children:[e.fuelLevel,"%"]})]})]}),void 0!==e.odometer&&f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx(O,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-muted-foreground",children:"Odometer"}),f.jsx("div",{className:"font-semibold",children:e.odometer.toLocaleString()})]})]})]}),e.updatedAt&&f.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[f.jsx(L,{className:"h-3 w-3"}),f.jsxs("span",{children:["Updated ",e.updatedAt]})]})]}),l&&t&&f.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-3 border-t border-slate-100",children:[f.jsxs(je,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),t("locate",e)},className:"h-9 text-xs",children:[f.jsx(M,{className:"h-3.5 w-3.5 mr-1"}),"Locate"]}),f.jsxs(je,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),t("dispatch",e)},className:"h-9 text-xs",children:[f.jsx(D,{className:"h-3.5 w-3.5 mr-1"}),"Dispatch"]}),f.jsxs(je,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),t("service",e)},className:"h-9 text-xs",children:[f.jsx(I,{className:"h-3.5 w-3.5 mr-1"}),"Service"]})]})]})})}function a(e,s,t={}){const{enabled:a=!0,validate:l=!1,deps:i=[]}=t,{subscribe:r,isConnected:n}=be(),c=j.useRef(s);j.useEffect(()=>{c.current=s},[s]),j.useEffect(()=>{if(a&&n)return r(e,s=>{try{let t=s;l&&Object.values(js).includes(e)&&(t=function(e,s){const t=Cs[e];if(!t)return s;const a=t.safeParse(s);if(!a.success)throw new Error(`Invalid message payload for ${e}: ${a.error.message}`);return a.data}(e,s)),c.current(t)}catch(t){Ne.error(`[useWebSocketSubscription] Validation error for ${e}:`,t)}})},[e,a,l,n,r,...i])}function l({variant:e="badge",showDetails:s=!1,className:t}){const{isConnected:a,connectionStatus:l,stats:i}=function(){const{isConnected:e,connectionStatus:s,stats:t}=be();return{isConnected:e,connectionStatus:s,stats:t}}(),r=function(){const{reconnect:e}=be();return e}(),[n,c]=j.useState(!1),d=e=>{const s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return s>0?`${s}h ${t}m`:t>0?`${t}m ${a}s`:`${a}s`},o=(()=>{switch(l){case"connected":return{color:"bg-emerald-500 hover:bg-emerald-600",textColor:"text-emerald-600",label:"Live",icon:f.jsx($,{className:"h-3 w-3"}),variant:"success"};case"connecting":return{color:"bg-amber-500 hover:bg-amber-600",textColor:"text-amber-600",label:"Connecting",icon:f.jsx(R,{className:"h-3 w-3 animate-pulse"}),variant:"warning"};case"error":return{color:"bg-red-500 hover:bg-red-600",textColor:"text-red-600",label:"Error",icon:f.jsx(P,{className:"h-3 w-3"}),variant:"destructive"};default:return{color:"bg-slate-500 hover:bg-slate-600",textColor:"text-slate-600",label:"Offline",icon:f.jsx(V,{className:"h-3 w-3"}),variant:"secondary"}}})();return"badge"===e?s?f.jsxs(we,{open:n,onOpenChange:c,children:[f.jsx(ye,{asChild:!0,children:f.jsxs(ve,{variant:o.variant,className:pe("gap-1 cursor-pointer",t),children:[o.icon,f.jsx("span",{className:"text-xs font-medium",children:o.label})]})}),f.jsxs(Ce,{align:"end",className:"w-64",children:[f.jsx(ke,{children:"WebSocket Connection"}),f.jsx(Se,{}),f.jsxs("div",{className:"px-2 py-1.5 text-sm space-y-2",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{className:"text-slate-500",children:"Status:"}),f.jsx("span",{className:pe("font-medium",o.textColor),children:o.label})]}),a&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{className:"text-slate-500",children:"Uptime:"}),f.jsx("span",{className:"font-mono text-xs",children:d(i.uptime)})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{className:"text-slate-500",children:"Messages:"}),f.jsxs("span",{className:"font-mono text-xs",children:["↓",i.messagesReceived," ↑",i.messagesSent]})]}),null!==i.latency&&f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{className:"text-slate-500",children:"Latency:"}),f.jsxs("span",{className:"font-mono text-xs",children:[i.latency,"ms"]})]})]}),!a&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{className:"text-slate-500",children:"Reconnects:"}),f.jsx("span",{className:"font-mono text-xs",children:i.reconnects})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{className:"text-slate-500",children:"Errors:"}),f.jsx("span",{className:"font-mono text-xs",children:i.errors})]})]})]}),f.jsx(Se,{}),f.jsxs(Ee,{onClick:()=>r(),children:[f.jsx(R,{className:"h-4 w-4 mr-2"}),"Reconnect"]})]})]}):f.jsxs(ve,{variant:o.variant,className:pe("gap-1",t),children:[o.icon,f.jsx("span",{className:"text-xs font-medium",children:o.label})]}):"button"===e?f.jsxs(je,{variant:"outline",size:"sm",className:pe("gap-2",t),onClick:()=>!a&&r(),disabled:a,children:[o.icon,f.jsx("span",{className:"text-xs font-medium",children:o.label}),s&&a&&f.jsx("span",{className:"text-xs font-mono text-slate-500",children:d(i.uptime)})]}):f.jsx("div",{className:pe("flex items-center justify-center w-8 h-8 rounded-full",o.color,"cursor-pointer transition-colors",t),onClick:()=>!a&&r(),title:`WebSocket ${o.label}`,children:o.icon})}function i({visible:e,geofences:s,onGeofenceSelect:t,breachedGeofenceIds:a=[]}){if(!e)return null;const l=s.filter(e=>e.active);return f.jsxs(f.Fragment,{children:[f.jsx("style",{children:"\n                @keyframes pulse-ring {\n                    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }\n                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }\n                }\n                @keyframes pulse-dot {\n                    0% { transform: translate(-50%, -50%) scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }\n                    70% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }\n                    100% { transform: translate(-50%, -50%) scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }\n                }\n                "}),l.map(e=>{if("circle"===e.type&&e.center){const s=a.includes(e.id),l=s?"#EF4444":e.color;return f.jsxs("div",{className:"absolute group z-20",style:{left:(e.center.lng+180)/3.6+"%",top:(e.center.lat+90)/1.8+"%",transform:"translate(-50%, -50%)"},onClick:s=>{s.stopPropagation(),t?.(e)},children:[f.jsx("div",{className:"absolute rounded-full pointer-events-none",style:{width:s?"100px":"80px",height:s?"100px":"80px",border:`1px solid ${l}`,backgroundColor:`${l}20`,animation:s?"pulse-ring 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite":"pulse-ring 3s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite",transform:"translate(-50%, -50%)",left:"50%",top:"50%"}}),f.jsx("div",{className:"relative rounded-full border-2 cursor-pointer transition-all hover:scale-110 shadow-sm",style:{width:"40px",height:"40px",backgroundColor:`${l}40`,borderColor:l,backdropFilter:"blur(2px)",animation:"pulse-dot 2s infinite"}}),f.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none bg-slate-900 text-white text-xs py-1 px-2 rounded shadow-lg whitespace-nowrap z-30",children:[f.jsx("div",{className:"font-semibold",children:e.name}),f.jsxs("div",{className:"text-[10px] text-slate-300",children:[e.type," • ",e.radius,"m"]}),s&&f.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase mt-1",children:"⚠️ Breach Detected"})]})]},e.id)}return null})]})}function r({...e}){return f.jsx(es,{"data-slot":"hover-card",...e})}function n({...e}){return f.jsx(ss,{"data-slot":"hover-card-trigger",...e})}function c({className:e,align:s="center",sideOffset:t=4,...a}){return f.jsx(ts,{"data-slot":"hover-card-portal",children:f.jsx(as,{"data-slot":"hover-card-content",align:s,sideOffset:t,className:pe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...a})})}function d({visible:e,filters:s,onCameraSelect:t,selectedCameraId:a}){const{data:l=[]}=Ke({queryKey:["trafficCameras","cameras"],queryFn:async()=>await Ae.trafficCameras.list(),enabled:e,gcTime:3e5});if(!e)return null;const i=l.filter(e=>{if("operational"===s.status&&!e.operational)return!1;if("offline"===s.status&&e.operational)return!1;if("all"!==s.source&&e.sourceId!==s.source)return!1;if(s.search){const t=s.search.toLowerCase();return e.name?.toLowerCase().includes(t)||e.address?.toLowerCase().includes(t)||!1}return!0});return f.jsx(f.Fragment,{children:i.map(e=>f.jsxs(r,{children:[f.jsx(n,{asChild:!0,children:f.jsx("div",{className:`\n                                group absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer transition-all duration-200\n                                ${a===e.id?"scale-125 z-50":"hover:scale-110 z-10"}\n                            `,style:{left:((e.longitude||0)+180)/3.6+"%",top:((e.latitude||0)+90)/1.8+"%"},onClick:s=>{s.stopPropagation(),t(e)},children:f.jsxs("div",{className:`\n                                    p-1.5 rounded-full shadow-md border-2\n                                    ${e.operational?"bg-white border-green-500 text-green-600":"bg-white border-red-500 text-red-600"}\n                                    ${a===e.id?"ring-2 ring-primary ring-offset-2":""}\n                                `,children:[e.operational&&f.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[f.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),f.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500 border-2 border-white"})]}),f.jsx(U,{weight:"fill",className:"w-4 h-4"})]})})}),f.jsx(c,{className:"w-80",children:f.jsxs("div",{className:"space-y-2",children:[f.jsx("h4",{className:"text-sm font-semibold",children:e.name}),f.jsx("p",{className:"text-xs text-muted-foreground",children:e.address}),f.jsx("div",{className:"flex items-center gap-2",children:f.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+(e.operational?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.operational?"Active":"Offline"})}),e.imageUrl&&f.jsx("div",{className:"relative aspect-video bg-muted rounded-md overflow-hidden",children:f.jsx("img",{src:e.imageUrl,alt:e.name||"Traffic Camera",className:"object-cover w-full h-full",loading:"lazy"})})]})})]},e.id))})}function o({layers:e}){const[s,t]=j.useState(!1),a=e.filter(e=>e.active).length;return f.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-end",children:[f.jsx(is,{children:s&&f.jsxs(rs.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.2},className:"mb-4 bg-white/90 backdrop-blur-md border border-white/20 shadow-xl rounded-2xl p-4 w-64 ring-1 ring-black/5",children:[f.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-slate-100",children:[f.jsx("span",{className:"text-sm font-semibold text-slate-800",children:"Map Layers"}),f.jsxs(ve,{variant:"secondary",className:"text-[10px] h-5 px-1.5",children:[a," Active"]})]}),f.jsx("div",{className:"space-y-3",children:e.map(e=>f.jsxs("div",{className:"flex items-center justify-between group",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"p-2 rounded-lg transition-colors "+(e.active?"bg-blue-50 text-blue-600":"bg-slate-50 text-slate-500 group-hover:bg-slate-100"),children:e.icon}),f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{className:"text-sm font-medium "+(e.active?"text-slate-900":"text-slate-600"),children:e.label}),void 0!==e.count&&f.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.count," items"]})]})]}),f.jsx(ls,{checked:e.active,onCheckedChange:e.onToggle,className:"scale-75 data-[state=checked]:bg-blue-500"})]},e.id))})]})}),f.jsx(je,{size:"icon",onClick:()=>t(!s),className:"h-12 w-12 rounded-full shadow-lg transition-all duration-300 "+(s?"bg-slate-900 rotate-90":"bg-white hover:bg-slate-50 text-slate-700"),children:s?f.jsx(k,{className:"h-5 w-5 text-white"}):f.jsx(b,{className:"h-5 w-5"})})]})}function x({isVisible:e,drivers:s=[],onDriverSelect:t,onClose:a,onDriversChange:l}){const[i,r]=j.useState(""),[n,c]=j.useState("all"),[d,o]=j.useState(!1),x=j.useMemo(()=>{const e=s.length;return{total:e,active:s.filter(e=>"active"===e.status).length,actionRequired:s.filter(e=>"suspended"===e.status||75>e.safetyScore).length,avgScore:e>0?Math.round(s.reduce((e,s)=>e+(s.safetyScore||0),0)/e):0}},[s]),m=j.useMemo(()=>s.filter(e=>(e.name.toLowerCase().includes(i.toLowerCase())||e.email.toLowerCase().includes(i.toLowerCase()))&&("all"===n||e.status===n)),[s,i,n]);return f.jsx(is,{children:e&&f.jsxs(rs.div,{initial:{x:-400,opacity:0},animate:{x:0,opacity:1},exit:{x:-400,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"absolute left-4 top-20 bottom-8 w-[400px] bg-white/95 backdrop-blur-md border border-slate-200 shadow-2xl rounded-2xl overflow-hidden flex flex-col z-40",children:[f.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-start bg-slate-50/50",children:[f.jsxs("div",{children:[f.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 text-slate-800",children:[f.jsx(_,{className:"w-5 h-5 text-blue-600"}),"Driver Roster"]}),f.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[s.length," total • ",x.active," on duty"]})]}),f.jsx(je,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8 -mt-1 -mr-1",children:f.jsx(G,{className:"w-4 h-4"})})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3 bg-slate-50/30 border-b border-slate-100",children:[f.jsxs("div",{className:"bg-white p-2 rounded-lg border border-slate-100 shadow-sm flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-slate-500 uppercase font-semibold",children:"Avg Safety"}),f.jsx("div",{className:"text-lg font-bold "+(90>x.avgScore?75>x.avgScore?"text-red-600":"text-amber-600":"text-green-600"),children:x.avgScore})]}),f.jsx(B,{className:"w-4 h-4 text-slate-300"})]}),f.jsxs("div",{className:"bg-white p-2 rounded-lg border border-slate-100 shadow-sm flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-slate-500 uppercase font-semibold",children:"Attention"}),f.jsx("div",{className:"text-lg font-bold text-slate-700",children:x.actionRequired})]}),f.jsx(S,{className:"w-4 h-4 text-amber-500"})]})]}),f.jsxs("div",{className:"p-3 space-y-3",children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("div",{className:"relative flex-1",children:[f.jsx(q,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400"}),f.jsx(Le,{placeholder:"Search name or ID...",className:"pl-9 h-9 text-sm",value:i,onChange:e=>r(e.target.value)})]}),f.jsxs(Ie,{open:d,onOpenChange:o,children:[f.jsx(Te,{asChild:!0,children:f.jsx(je,{size:"icon",className:"h-9 w-9 shrink-0",children:f.jsx(H,{className:"h-4 w-4"})})}),f.jsxs(Fe,{children:[f.jsx(ze,{children:f.jsx(De,{children:"Add New Driver"})}),f.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=new FormData(e.target),a={id:`d-${Date.now()}`,name:t.get("name"),email:t.get("email"),status:"active",safetyScore:100,licenseNumber:t.get("license"),department:t.get("department"),joinedDate:(new Date).toISOString()};l&&l([...s,a]),o(!1)},className:"space-y-4 mt-2",children:[f.jsxs("div",{className:"grid w-full gap-1.5",children:[f.jsx(ns,{htmlFor:"name",children:"Full Name"}),f.jsx(Le,{id:"name",name:"name",placeholder:"John Doe",required:!0})]}),f.jsxs("div",{className:"grid w-full gap-1.5",children:[f.jsx(ns,{htmlFor:"email",children:"Email"}),f.jsx(Le,{id:"email",name:"email",type:"email",placeholder:"john@example.com",required:!0})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ns,{htmlFor:"license",children:"License #"}),f.jsx(Le,{id:"license",name:"license",placeholder:"DL-12345",required:!0})]}),f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ns,{htmlFor:"department",children:"Department"}),f.jsx(Le,{id:"department",name:"department",placeholder:"Logistics"})]})]}),f.jsx(je,{type:"submit",className:"w-full",children:"Create Driver"})]})]})]})]}),f.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 no-scrollbar",children:["all","active","off-duty","suspended"].map(e=>f.jsx(je,{variant:n===e?"secondary":"ghost",size:"sm",onClick:()=>c(e),className:"h-7 text-xs capitalize rounded-full px-3",children:e.replace("-"," ")},e))})]}),f.jsx(Oe,{className:"flex-1",children:f.jsxs("div",{className:"p-2 space-y-1",children:[m.map(e=>f.jsxs("div",{onClick:()=>t(e),className:"group flex items-center justify-between p-3 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-200 cursor-pointer transition-all",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 font-semibold text-sm border-2 border-white shadow-sm",children:e.name.charAt(0)}),f.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-white "+("active"===e.status?"bg-green-500":"suspended"===e.status?"bg-red-500":"bg-slate-400")})]}),f.jsxs("div",{children:[f.jsx("div",{className:"font-medium text-sm text-slate-900 leading-none",children:e.name}),f.jsxs("div",{className:"text-[11px] text-slate-500 mt-1 flex items-center gap-1",children:[f.jsx(ve,{variant:"outline",className:"h-4 px-1 text-[9px] font-normal border-slate-200 text-slate-500",children:e.department||"General"}),e.safetyScore>=90&&f.jsxs("span",{className:"flex items-center text-amber-500",children:[f.jsx(W,{className:"w-3 h-3 mr-0.5"}),"Elite"]})]})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"text-sm font-bold "+(90>e.safetyScore?75>e.safetyScore?"text-red-500":"text-amber-500":"text-green-600"),children:e.safetyScore}),f.jsxs(we,{children:[f.jsx(ye,{asChild:!0,children:f.jsx(je,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",children:f.jsx(Q,{className:"h-4 w-4 text-slate-400"})})}),f.jsxs(Ce,{align:"end",children:[f.jsx(Ee,{onClick:s=>{s.stopPropagation(),t(e)},children:"View Details"}),f.jsx(Ee,{children:"Assign Vehicle"}),f.jsx(Se,{}),f.jsx(Ee,{className:"text-red-600",children:"Suspend Driver"})]})]})]})]},e.id)),0===m.length&&f.jsx("div",{className:"text-center py-10 text-slate-400",children:f.jsx("p",{className:"text-sm",children:"No drivers found."})})]})})]})})}function m({driver:e,onClose:s,vehicles:t=[]}){if(!e)return null;const a=t.find(s=>s.id===e.assignedVehicle);return f.jsx(is,{children:f.jsxs(rs.div,{initial:{x:400,opacity:0},animate:{x:0,opacity:1},exit:{x:400,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"absolute right-4 top-20 bottom-8 w-[400px] bg-white/95 backdrop-blur-md border border-slate-200 shadow-2xl rounded-2xl overflow-hidden flex flex-col z-40",children:[f.jsxs("div",{className:"relative h-32 bg-gradient-to-br from-slate-900 to-slate-800 shrink-0",children:[f.jsx(je,{variant:"ghost",size:"icon",onClick:s,className:"absolute right-2 top-2 text-white/50 hover:text-white hover:bg-white/10","aria-label":"Close driver details",children:f.jsx(G,{className:"w-5 h-5"})}),f.jsx("div",{className:"absolute -bottom-10 left-6",children:f.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white bg-slate-200 shadow-md flex items-center justify-center text-2xl font-bold text-slate-600",children:e.name.charAt(0)})}),f.jsxs("div",{className:"absolute bottom-3 right-4 flex gap-2",children:[f.jsxs(je,{size:"sm",variant:"secondary",className:"h-7 text-xs bg-white/10 text-white hover:bg-white/20 border-none backdrop-blur-sm",children:[f.jsx(Y,{className:"w-3 h-3 mr-1.5"}),"Call"]}),f.jsxs(je,{size:"sm",variant:"secondary",className:"h-7 text-xs bg-white/10 text-white hover:bg-white/20 border-none backdrop-blur-sm",children:[f.jsx(Z,{className:"w-3 h-3 mr-1.5"}),"Email"]})]})]}),f.jsxs("div",{className:"pt-12 px-6 pb-6 flex-1 flex flex-col overflow-hidden",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:e.name}),f.jsxs("div",{className:"flex items-center gap-2 mt-1 text-slate-500 text-sm",children:[f.jsx(ve,{variant:"outline",className:"rounded-md font-normal",children:e.id}),f.jsx("span",{children:"•"}),f.jsx("span",{children:e.department||"Unassigned Dept"})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-6 mb-6",children:[f.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100 text-center",children:[f.jsx("div",{className:"text-xl font-bold "+(90>e.safetyScore?"text-amber-600":"text-green-600"),children:e.safetyScore}),f.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 mt-0.5",children:"Safety"})]}),f.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100 text-center",children:[f.jsx("div",{className:"text-xl font-bold text-slate-700",children:"4.9"}),f.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 mt-0.5",children:"Rating"})]}),f.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100 text-center",children:[f.jsx("div",{className:"text-xl font-bold text-blue-600",children:"98%"}),f.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 mt-0.5",children:"On-Time"})]})]}),f.jsxs(Me,{defaultValue:"overview",className:"flex-1 flex flex-col min-h-0",children:[f.jsxs(Re,{className:"w-full justify-start h-10 p-1 bg-slate-100/80 mb-4",children:[f.jsx(Ve,{value:"overview",className:"text-xs",children:"Overview"}),f.jsx(Ve,{value:"activity",className:"text-xs",children:"Activity"}),f.jsx(Ve,{value:"vehicle",className:"text-xs",children:"Vehicle"})]}),f.jsxs(Oe,{className:"flex-1 -mx-6 px-6",children:[f.jsxs(Pe,{value:"overview",className:"space-y-6 mt-0",children:[f.jsxs("div",{className:"space-y-3",children:[f.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Current Status"}),f.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-xl shadow-sm",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(R,{className:"w-5 h-5 text-blue-500"}),f.jsxs("div",{children:[f.jsx("div",{className:"font-semibold text-sm capitalize",children:e.status}),f.jsx("div",{className:"text-xs text-slate-500",children:"Since 08:00 AM"})]})]}),f.jsx(ve,{variant:"active"===e.status?"default":"secondary",children:e.status})]})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Assigned Vehicle"}),f.jsxs("div",a?{className:"p-3 bg-white border border-slate-200 rounded-xl shadow-sm hover:border-blue-300 transition-colors cursor-pointer group",children:[f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{className:"flex gap-3",children:[f.jsx("div",{className:"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center",children:f.jsx(D,{className:"w-5 h-5 text-slate-600"})}),f.jsxs("div",{children:[f.jsxs("div",{className:"font-semibold text-sm group-hover:text-blue-600 transition-colors",children:[a.make," ",a.model]}),f.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:a.number})]})]}),f.jsx("div",{className:"text-right",children:f.jsx(ve,{variant:"outline",className:"text-[10px]",children:a.status})})]}),f.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-slate-500",children:[f.jsx(M,{className:"w-3.5 h-3.5"}),"Loading Dock B, Warehouse 4"]})]}:{className:"text-center p-6 border-2 border-dashed border-slate-200 rounded-xl",children:[f.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"No vehicle currently assigned"}),f.jsx(je,{variant:"outline",size:"sm",children:"Assign Vehicle"})]})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Compliance"}),f.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-100 flex justify-between items-center",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(J,{className:"w-4 h-4 text-slate-500"}),f.jsx("span",{className:"text-sm font-medium",children:"Commercial License"})]}),f.jsxs("span",{className:"text-xs text-slate-500",children:["Exp: ",e.licenseExpiry]})]})]})]}),f.jsx(Pe,{value:"activity",className:"mt-0",children:f.jsx("div",{className:"space-y-4",children:[{id:1,type:"trip",title:"Route #402 Completed",time:"2 hours ago",score:98},{id:2,type:"alert",title:"Hard Braking Event",time:"5 hours ago",score:-5},{id:3,type:"system",title:"Shift Started",time:"8 hours ago",score:null}].map(e=>f.jsxs("div",{className:"relative pl-6 pb-6 border-l border-slate-200 last:pb-0",children:[f.jsx("div",{className:"absolute -left-1.5 top-0 w-3 h-3 rounded-full border-2 border-white "+("alert"===e.type?"bg-red-500":"bg-blue-500")}),f.jsxs("div",{className:"flex justify-between items-start -mt-1",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-sm font-semibold",children:e.title}),f.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:e.time})]}),e.score&&f.jsxs(ve,{variant:e.score>0?"secondary":"destructive",className:"text-[10px]",children:[e.score>0?"+":"",e.score," pts"]})]})]},e.id))})}),f.jsx(Pe,{value:"vehicle",className:"mt-0 p-1",children:a?f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 flex flex-col items-center",children:[f.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-3",children:f.jsx(D,{className:"w-8 h-8 text-blue-600"})}),f.jsxs("h3",{className:"font-bold text-lg",children:[a.make," ",a.model]}),f.jsx("div",{className:"text-sm text-slate-500",children:a.number}),f.jsx(ve,{className:"mt-2",variant:"active"===a.status?"default":"secondary",children:a.status})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-100",children:[f.jsx("div",{className:"text-xs text-slate-500 uppercase font-semibold",children:"Fuel Level"}),f.jsxs("div",{className:"text-lg font-bold text-slate-900",children:[a.fuelLevel||"76","%"]})]}),f.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-100",children:[f.jsx("div",{className:"text-xs text-slate-500 uppercase font-semibold",children:"Odometer"}),f.jsxs("div",{className:"text-lg font-bold text-slate-900",children:[(a.mileage||0).toLocaleString()," mi"]})]})]})]}):f.jsx("div",{className:"text-center py-10 text-slate-400",children:f.jsx("p",{children:"No vehicle assigned."})})})]})]})]})]})})}function h({isVisible:e,geofences:s,onGeofencesChange:t,onClose:a}){const[l,i]=j.useState(""),[r,n]=j.useState("all"),[c,d]=j.useState(!1),[o,x]=j.useState(null),[m,h]=j.useState({name:"",description:"",type:"circle",color:"#3B82F6",active:!0,triggers:{onEnter:!0,onExit:!0,onDwell:!1},notifyUsers:[],notifyRoles:[],alertPriority:"medium"}),u=s.filter(e=>(e.name.toLowerCase().includes(l.toLowerCase())||e.description.toLowerCase().includes(l.toLowerCase()))&&("all"===r||e.type===r)),p=()=>{x(null),h({name:"",description:"",type:"circle",color:"#3B82F6",active:!0,triggers:{onEnter:!0,onExit:!0,onDwell:!1},notifyUsers:[],notifyRoles:[],alertPriority:"medium"})};return e?f.jsxs(f.Fragment,{children:[f.jsxs(fe,{className:"fixed top-24 right-6 w-96 shadow-2xl z-40 border border-white/20 bg-white/80 backdrop-blur-xl animate-in slide-in-from-right-10 rounded-2xl overflow-hidden ring-1 ring-black/5 flex flex-col max-h-[calc(100vh-120px)]",children:[f.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/50 to-transparent pointer-events-none"}),f.jsxs($e,{className:"pb-4 border-b border-black/5 flex flex-row items-center justify-between space-y-0 relative z-10 bg-white/40 shrink-0",children:[f.jsxs("div",{children:[f.jsxs(Ue,{className:"text-base font-bold flex items-center gap-2 text-slate-800",children:[f.jsx("div",{className:"p-1.5 bg-blue-500/10 rounded-md border border-blue-500/20",children:f.jsx(K,{weight:"fill",className:"text-blue-600 w-4 h-4"})}),"Geofences"]}),f.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.filter(e=>e.active).length," active monitoring"]})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(je,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-black/5 rounded-full",onClick:()=>{p(),d(!0)},children:f.jsx(X,{className:"w-4 h-4 text-slate-700"})}),f.jsx(je,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-black/5 rounded-full",onClick:a,children:f.jsx(ee,{className:"w-4 h-4 text-slate-500"})})]})]}),f.jsxs(ge,{className:"pt-4 flex-1 overflow-hidden flex flex-col",children:[f.jsx("div",{className:"space-y-3 shrink-0 mb-4",children:f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("div",{className:"relative flex-1",children:[f.jsx(se,{className:"absolute left-2.5 top-2.5 w-3.5 h-3.5 text-muted-foreground"}),f.jsx(Le,{placeholder:"Search...",value:l,onChange:e=>i(e.target.value),className:"pl-8 h-8 text-sm"})]}),f.jsxs(ds,{value:r,onValueChange:n,children:[f.jsxs(os,{className:"w-[100px] h-8 text-sm px-2",children:[f.jsx(te,{className:"w-3 h-3 mr-1"}),f.jsx(xs,{placeholder:"Type"})]}),f.jsxs(ms,{children:[f.jsx(hs,{value:"all",children:"All"}),f.jsx(hs,{value:"circle",children:"Circle"}),f.jsx(hs,{value:"polygon",children:"Polygon"}),f.jsx(hs,{value:"rectangle",children:"Rect"})]})]})]})}),f.jsx("div",{className:"space-y-2 overflow-y-auto pr-2 flex-1",children:0===u.length?f.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No geofences found."}):u.map(e=>{return f.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white/50 hover:bg-white hover:border-slate-300 transition-all group",children:[f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:e.color}}),f.jsx("div",{className:"font-medium text-sm truncate max-w-[140px]",title:e.name,children:e.name})]}),f.jsx(ls,{checked:e.active,onCheckedChange:()=>{return a=e.id,void t(s.map(e=>e.id===a?{...e,active:!e.active}:e));var a},className:"scale-75 origin-right"})]}),f.jsxs("div",{className:"flex items-center justify-between mt-2",children:[f.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[f.jsxs(ve,{variant:"outline",className:"text-[10px] h-4 px-1 py-0",children:[(a=e.type,{circle:"○",polygon:"▱",rectangle:"▭"}[a])," ",e.type]}),"medium"!==e.alertPriority&&f.jsx(ve,{variant:"secondary",className:"text-[10px] h-4 px-1 py-0 capitalize",children:e.alertPriority})]}),f.jsxs("div",{className:"flex opacity-0 group-hover:opacity-100 transition-opacity",children:[f.jsx(je,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>(e=>{x(e),h(e),d(!0)})(e),children:f.jsx(ae,{className:"w-3 h-3"})}),f.jsx(je,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>(e=>{const a={...e,id:`geofence-${Date.now()}`,name:`${e.name} (Copy)`,createdAt:(new Date).toISOString(),lastModified:(new Date).toISOString()};t([...s,a]),cs.success("Geofence duplicated")})(e),children:f.jsx(le,{className:"w-3 h-3"})}),f.jsx(je,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:text-red-500",onClick:()=>{return a=e.id,t(s.filter(e=>e.id!==a)),void cs.success("Geofence deleted");var a},children:f.jsx(ie,{className:"w-3 h-3"})})]})]})]},e.id);var a})})]})]}),f.jsx(Ie,{open:c,onOpenChange:e=>{d(e),e||p()},children:f.jsxs(Fe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[f.jsxs(ze,{children:[f.jsx(De,{children:o?"Edit Geofence":"Create Geofence"}),f.jsx(_e,{children:"Define a geographic boundary"})]}),f.jsxs("div",{className:"grid gap-4 py-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"geofence-name",children:"Name *"}),f.jsx(Le,{id:"geofence-name",value:m.name,onChange:e=>h({...m,name:e.target.value})})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"geofence-type",children:"Type"}),f.jsxs(ds,{value:m.type,onValueChange:e=>h({...m,type:e}),children:[f.jsx(os,{id:"geofence-type",children:f.jsx(xs,{})}),f.jsxs(ms,{children:[f.jsx(hs,{value:"circle",children:"Circle"}),f.jsx(hs,{value:"polygon",children:"Polygon"}),f.jsx(hs,{value:"rectangle",children:"Rectangle"})]})]})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"geofence-description",children:"Description"}),f.jsx(us,{id:"geofence-description",value:m.description,onChange:e=>h({...m,description:e.target.value}),rows:2})]}),"circle"===m.type&&f.jsxs("div",{className:"grid grid-cols-3 gap-4 bg-slate-50 p-3 rounded-md border",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"center-lat",className:"text-xs",children:"Latitude"}),f.jsx(Le,{id:"center-lat",type:"number",step:"0.000001",value:m.center?.lat||"",onChange:e=>h({...m,center:{lat:parseFloat(e.target.value),lng:m.center?.lng||0}}),className:"h-8"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"center-lng",className:"text-xs",children:"Longitude"}),f.jsx(Le,{id:"center-lng",type:"number",step:"0.000001",value:m.center?.lng||"",onChange:e=>h({...m,center:{lat:m.center?.lat||0,lng:parseFloat(e.target.value)}}),className:"h-8"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"radius",className:"text-xs",children:"Radius (m)"}),f.jsx(Le,{id:"radius",type:"number",value:m.radius||500,onChange:e=>h({...m,radius:parseInt(e.target.value)}),className:"h-8"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"alert-priority",children:"Priority"}),f.jsxs(ds,{value:m.alertPriority,onValueChange:e=>h({...m,alertPriority:e}),children:[f.jsx(os,{id:"alert-priority",children:f.jsx(xs,{})}),f.jsxs(ms,{children:[f.jsx(hs,{value:"low",children:"Low"}),f.jsx(hs,{value:"medium",children:"Medium"}),f.jsx(hs,{value:"high",children:"High"}),f.jsx(hs,{value:"critical",children:"Critical"})]})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx(ns,{htmlFor:"color",children:"Color"}),f.jsx(Le,{id:"color",type:"color",value:m.color,onChange:e=>h({...m,color:e.target.value})})]})]}),f.jsxs("div",{className:"space-y-3 border-t pt-3",children:[f.jsx(ns,{className:"text-xs text-muted-foreground uppercase",children:"Trigger Events"}),f.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(ls,{id:"trigger-enter",checked:m.triggers?.onEnter,onCheckedChange:e=>h({...m,triggers:{...m.triggers,onEnter:e}})}),f.jsx(ns,{htmlFor:"trigger-enter",className:"text-sm",children:"Entry"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(ls,{id:"trigger-exit",checked:m.triggers?.onExit,onCheckedChange:e=>h({...m,triggers:{...m.triggers,onExit:e}})}),f.jsx(ns,{htmlFor:"trigger-exit",className:"text-sm",children:"Exit"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(ls,{id:"trigger-dwell",checked:m.triggers?.onDwell,onCheckedChange:e=>h({...m,triggers:{...m.triggers,onDwell:e}})}),f.jsx(ns,{htmlFor:"trigger-dwell",className:"text-sm",children:"Dwell"})]})]})]})]}),f.jsxs(Ge,{children:[f.jsx(je,{variant:"outline",onClick:()=>{d(!1),p()},children:"Cancel"}),f.jsx(je,{onClick:()=>{if(!m.name)return void cs.error("Please enter a geofence name");if("circle"===m.type&&!m.center)return void cs.error("Please set a center point for the circle geofence");const e={id:o?.id||`geofence-${Date.now()}`,tenantId:"tenant-demo",name:m.name,description:m.description||"",type:m.type,center:m.center,radius:m.radius||500,coordinates:m.coordinates||[],color:m.color||"#3B82F6",active:!1!==m.active,triggers:m.triggers||{onEnter:!0,onExit:!0,onDwell:!1},notifyUsers:m.notifyUsers||[],notifyRoles:m.notifyRoles||[],alertPriority:m.alertPriority||"medium",createdBy:"Current User",createdAt:o?.createdAt||(new Date).toISOString(),lastModified:(new Date).toISOString()};o?(t(s.map(s=>s.id===e.id?e:s)),cs.success("Geofence updated successfully")):(t([...s,e]),cs.success("Geofence created successfully")),d(!1),p()},children:o?"Update":"Create"})]})]})})]}):null}function u({geofence:e,onClose:s,breachedVehicleIds:t,vehicles:a}){if(!e)return null;const l=a.filter(e=>t.includes(e.id));return f.jsx(is,{children:e&&f.jsxs(rs.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"fixed inset-y-0 right-0 z-50 w-full sm:w-[400px] bg-white border-l shadow-2xl overflow-hidden flex flex-col",children:[f.jsxs("div",{className:"bg-slate-50 border-b p-4 flex items-start justify-between",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(ve,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:e.type}),f.jsx(ve,e.active?{className:"bg-green-500 hover:bg-green-600",children:"Active Monitoring"}:{variant:"secondary",children:"Inactive"})]}),f.jsx("h2",{className:"text-xl font-bold text-slate-900",children:e.name}),f.jsx("p",{className:"text-sm text-slate-500",children:e.description||"No description provided"})]}),f.jsx(je,{variant:"ghost",size:"icon",onClick:s,className:"rounded-full hover:bg-slate-200",children:f.jsx(G,{className:"w-5 h-5 text-slate-500"})})]}),f.jsx(Oe,{className:"flex-1 p-4 bg-slate-50/50",children:f.jsxs("div",{className:"space-y-6",children:[f.jsxs(fe,{className:"border-l-4 border-l-blue-500 shadow-sm relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5",children:f.jsx(R,{className:"w-24 h-24"})}),f.jsx($e,{className:"pb-2",children:f.jsxs(Ue,{className:"text-sm font-medium text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[f.jsx(_,{className:"w-4 h-4"})," Live Occupancy"]})}),f.jsxs(ge,{children:[f.jsxs("div",{className:"flex items-baseline gap-2",children:[f.jsx("span",{className:"text-4xl font-bold text-slate-900",children:l.length}),f.jsx("span",{className:"text-sm text-slate-500",children:"vehicles inside"})]}),l.length>0&&f.jsx("div",{className:"mt-4 space-y-2",children:l.map(e=>f.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border border-slate-100 shadow-sm",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),f.jsxs("div",{children:[f.jsx("div",{className:"font-medium text-sm",children:e.name||e.number}),f.jsx("div",{className:"text-[10px] text-slate-400",children:"Entered 2m ago"})]})]}),f.jsx(je,{size:"sm",variant:"ghost",className:"h-6 text-xs",children:"View"})]},e.id))})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsx(fe,{children:f.jsxs(ge,{className:"p-4",children:[f.jsxs("div",{className:"flex items-center gap-2 text-slate-500 mb-2",children:[f.jsx(L,{className:"w-4 h-4"}),f.jsx("span",{className:"text-xs font-semibold uppercase",children:"Avg Dwell"})]}),f.jsx("div",{className:"text-2xl font-bold",children:"14m"}),f.jsx("div",{className:"text-xs text-green-600 font-medium",children:"↓ 2m vs avg"})]})}),f.jsx(fe,{children:f.jsxs(ge,{className:"p-4",children:[f.jsxs("div",{className:"flex items-center gap-2 text-slate-500 mb-2",children:[f.jsx(re,{className:"w-4 h-4"}),f.jsx("span",{className:"text-xs font-semibold uppercase",children:"Alerts (24h)"})]}),f.jsx("div",{className:"text-2xl font-bold text-amber-600",children:"3"}),f.jsx("div",{className:"text-xs text-slate-400",children:"2 entry, 1 dwell"})]})})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("h3",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[f.jsx(re,{className:"w-4 h-4 text-slate-500"}),"Active Triggers"]}),f.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.triggers.onEnter&&f.jsx("div",{className:"bg-emerald-50 text-emerald-700 border border-emerald-100 px-3 py-2 rounded text-xs font-medium text-center",children:"Entry"}),e.triggers.onExit&&f.jsx("div",{className:"bg-blue-50 text-blue-700 border border-blue-100 px-3 py-2 rounded text-xs font-medium text-center",children:"Exit"}),e.triggers.onDwell&&f.jsx("div",{className:"bg-amber-50 text-amber-700 border border-amber-100 px-3 py-2 rounded text-xs font-medium text-center",children:"Dwell"})]})]}),f.jsx(ps,{}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("h3",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[f.jsx(ne,{className:"w-4 h-4 text-slate-500"}),"Recent Activity"]}),f.jsx("div",{className:"relative pl-4 border-l border-slate-200 space-y-6",children:[1,2,3].map(e=>f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute -left-[21px] top-1 w-2.5 h-2.5 rounded-full bg-slate-300 border-2 border-white"}),f.jsxs("div",{className:"text-xs text-slate-500 mb-0.5",children:["Today, ",10+e,":30 AM"]}),f.jsxs("div",{className:"text-sm font-medium text-slate-800",children:["Vehicle ",100+e," Entered Area"]}),f.jsx("div",{className:"text-xs text-slate-500",children:"Duration: 45m • Driver: John Doe"})]},e))})]})]})}),f.jsxs("div",{className:"p-4 border-t bg-white flex gap-2",children:[f.jsx(je,{className:"flex-1",variant:"outline",children:"Edit Rules"}),f.jsx(je,{className:"flex-1",variant:"destructive",children:"Deactivate"})]})]})})}function p({filters:e,onFilterChange:s,onClose:t,isVisible:a}){const l=Xe({mutationFn:async()=>Ae.trafficCameras.sync(),onSuccess:()=>cs.success("Camera data synchronized"),onError:()=>cs.error("Failed to sync camera data")}),{data:i=[]}=Ke({queryKey:["trafficCameras","sources"],queryFn:async()=>await Ae.trafficCameras.sources.list()});return a?f.jsxs(fe,{className:"fixed top-24 right-6 w-80 shadow-2xl z-40 border border-white/20 bg-white/80 backdrop-blur-xl animate-in slide-in-from-right-10 rounded-2xl overflow-hidden ring-1 ring-black/5",children:[f.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/50 to-transparent pointer-events-none"}),f.jsxs($e,{className:"pb-4 border-b border-black/5 flex flex-row items-center justify-between space-y-0 relative z-10 bg-white/40",children:[f.jsxs("div",{children:[f.jsxs(Ue,{className:"text-base font-bold flex items-center gap-2 text-slate-800",children:[f.jsx("div",{className:"p-1.5 bg-blue-500/10 rounded-md border border-blue-500/20",children:f.jsx(U,{weight:"fill",className:"text-blue-600 w-4 h-4"})}),"Traffic Feed"]}),f.jsxs("div",{className:"flex items-center mt-1 ml-1 gap-1.5",children:[f.jsxs("div",{className:"relative flex h-2 w-2",children:[f.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),f.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),f.jsx("span",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-semibold",children:"Live Monitoring"})]})]}),f.jsx(je,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-black/5 rounded-full",onClick:t,children:f.jsx(ee,{className:"w-4 h-4 text-slate-500"})})]}),f.jsxs(ge,{className:"pt-4 space-y-4",children:[f.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[f.jsxs("span",{children:[i.length," Sources Active"]}),f.jsxs(je,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>l.mutate(),disabled:l.isPending,children:[f.jsx(ce,{className:"w-3 h-3 mr-1 "+(l.isPending?"animate-spin":"")}),"Sync"]})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"relative",children:[f.jsx(se,{className:"absolute left-2.5 top-2.5 w-3.5 h-3.5 text-muted-foreground"}),f.jsx(Le,{placeholder:"Search cameras...",value:e.search,onChange:e=>s("search",e.target.value),className:"pl-8 h-8 text-sm"})]}),f.jsxs(ds,{value:e.status,onValueChange:e=>s("status",e),children:[f.jsx(os,{className:"h-8 text-sm",children:f.jsx(xs,{placeholder:"Status"})}),f.jsxs(ms,{children:[f.jsx(hs,{value:"all",children:"All Statuses"}),f.jsx(hs,{value:"operational",children:"Operational Only"}),f.jsx(hs,{value:"offline",children:"Offline Only"})]})]}),f.jsxs(ds,{value:e.source,onValueChange:e=>s("source",e),children:[f.jsx(os,{className:"h-8 text-sm",children:f.jsx(xs,{placeholder:"Source"})}),f.jsxs(ms,{children:[f.jsx(hs,{value:"all",children:"All Sources"}),i.map(e=>f.jsx(hs,{value:e.id,children:e.name},e.id))]})]})]}),f.jsxs("div",{className:"pt-2 border-t flex gap-4 justify-center",children:[f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),f.jsx("span",{className:"text-xs text-muted-foreground",children:"Active"})]}),f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),f.jsx("span",{className:"text-xs text-muted-foreground",children:"Offline"})]})]})]})]}):null}import{r as j,j as f,cJ as g,be as v,cm as b,cu as N,cs as w,ct as y,b1 as C,a8 as k,I as S,cK as E,aB as A,aC as L,Y as I,aA as T,a5 as F,_ as z,O as D,aH as O,aD as M,ax as R,aW as V,a4 as P,cL as $,ac as U,U as _,X as G,V as B,S as q,cG as H,cM as W,cN as Q,av as Y,au as Z,cO as J,at as K,br as X,bs as ee,b8 as se,bt as te,cP as ae,ci as le,cj as ie,cQ as re,cR as ne,bi as ce,R as de,W as oe,cS as xe}from"./react-core-hQu9tqS1.js";import{c as me}from"./react-router-cBrq_s0x.js";import{M as he}from"./MapFirstLayout-DjypJrVA.js";import{P as ue}from"./ProfessionalFleetMap-CXhovPIf.js";import{q as pe,h as je,C as fe,f as ge,B as ve,N as be,p as Ne,z as we,E as ye,F as Ce,O as ke,H as Se,G as Ee,o as Ae,I as Le,D as Ie,t as Te,j as Fe,k as ze,l as De,S as Oe,T as Me,a as Re,b as Ve,c as Pe,d as $e,e as Ue,m as _e,n as Ge,r as Be,Q as qe,M as He}from"./index-BDwglPMF.js";import{al as We,an as Qe,at as Ye,ar as Ze,ap as Je}from"./form-vendor-DKCvS-hL.js";import{u as Ke,b as Xe}from"./query-vendor--Fe2N4Al.js";import{a7 as es,a8 as ss,a9 as ts,aa as as}from"./ui-radix-C-X5Qx_8.js";import{S as ls}from"./switch-9MiV1CpI.js";import{A as is,m as rs}from"./animation-vendor-Cf_i_fm0.js";import{L as ns}from"./label-C9sYRYKW.js";import{t as cs}from"./index-savvei9t.js";import{S as ds,a as os,b as xs,c as ms,d as hs}from"./select-Bmd3s7f4.js";import{T as us}from"./textarea-BOBjqKNu.js";import{S as ps}from"./separator-Dey2K2dP.js";import"./lazy-modules-Bs19xeuI.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./sheet-B4c1gADU.js";import"./ui-dialogs-C2yTnBPV.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";var js=(e=>(e.PING="ping",e.PONG="pong",e.CONNECTION_STATUS="connection:status",e.VEHICLE_LOCATION="vehicle:location",e.VEHICLE_STATUS="vehicle:status",e.VEHICLE_TELEMETRY="vehicle:telemetry",e.VEHICLE_ALERT="vehicle:alert",e.FLEET_STATUS="fleet:status",e.FLEET_SUMMARY="fleet:summary",e.MAINTENANCE_ALERT="maintenance:alert",e.MAINTENANCE_DUE="maintenance:due",e.MAINTENANCE_COMPLETE="maintenance:complete",e.DRIVER_STATUS="driver:status",e.DRIVER_LOCATION="driver:location",e.DRIVER_ALERT="driver:alert",e.GEOFENCE_BREACH="geofence:breach",e.GEOFENCE_ENTER="geofence:enter",e.GEOFENCE_EXIT="geofence:exit",e.FUEL_ALERT="fuel:alert",e.FUEL_TRANSACTION="fuel:transaction",e.NOTIFICATION="notification",e.ALERT="alert",e.SYSTEM_STATUS="system:status",e.SYSTEM_ALERT="system:alert",e))(js||{});We({type:Qe(),timestamp:Qe().datetime(),id:Qe().optional()});const fs=We({vehicleId:Qe(),latitude:Ze().min(-90).max(90),longitude:Ze().min(-180).max(180),speed:Ze().min(0).optional(),heading:Ze().min(0).max(360).optional(),altitude:Ze().optional(),accuracy:Ze().min(0).optional(),timestamp:Qe().datetime()}),gs=We({vehicleId:Qe(),status:Ye(["active","idle","maintenance","offline","service"]),battery:Ze().min(0).max(100).optional(),fuel:Ze().min(0).max(100).optional(),odometer:Ze().min(0).optional(),engineHours:Ze().min(0).optional(),timestamp:Qe().datetime()}),vs=We({vehicleId:Qe(),rpm:Ze().min(0).optional(),speed:Ze().min(0).optional(),engineTemp:Ze().optional(),oilPressure:Ze().optional(),coolantTemp:Ze().optional(),batteryVoltage:Ze().optional(),fuelLevel:Ze().min(0).max(100).optional(),diagnosticCodes:Je(Qe()).optional(),timestamp:Qe().datetime()}),bs=We({vehicleId:Qe(),alertType:Ye(["due","overdue","critical","scheduled","completed"]),service:Qe(),description:Qe(),priority:Ye(["low","medium","high","critical"]),dueDate:Qe().datetime().optional(),odometer:Ze().optional(),estimatedCost:Ze().optional(),timestamp:Qe().datetime()}),Ns=We({totalVehicles:Ze().min(0),active:Ze().min(0),idle:Ze().min(0),maintenance:Ze().min(0),offline:Ze().min(0),alerts:Ze().min(0),averageSpeed:Ze().min(0).optional(),totalMiles:Ze().min(0).optional(),fuelEfficiency:Ze().min(0).optional(),timestamp:Qe().datetime()}),ws=We({driverId:Qe(),status:Ye(["active","inactive","on_break","off_duty"]),vehicleId:Qe().optional(),location:We({lat:Ze(),lng:Ze()}).optional(),hoursWorked:Ze().min(0).optional(),timestamp:Qe().datetime()}),ys=We({vehicleId:Qe(),geofenceId:Qe(),geofenceName:Qe(),breachType:Ye(["enter","exit","dwell"]),location:We({lat:Ze(),lng:Ze()}),timestamp:Qe().datetime()}),Cs={ping:null,pong:null,"connection:status":null,"vehicle:location":fs,"vehicle:status":gs,"vehicle:telemetry":vs,"vehicle:alert":null,"fleet:status":Ns,"fleet:summary":null,"maintenance:alert":bs,"maintenance:due":bs,"maintenance:complete":bs,"driver:status":ws,"driver:location":null,"driver:alert":null,"geofence:breach":ys,"geofence:enter":ys,"geofence:exit":ys,"fuel:alert":We({vehicleId:Qe(),alertType:Ye(["low","critical","theft","anomaly"]),currentLevel:Ze().min(0).max(100),threshold:Ze().min(0).max(100).optional(),location:We({lat:Ze(),lng:Ze()}).optional(),timestamp:Qe().datetime()}),"fuel:transaction":null,notification:We({id:Qe(),title:Qe(),message:Qe(),type:Ye(["info","warning","error","success"]),priority:Ye(["low","medium","high","critical"]),category:Qe().optional(),actionUrl:Qe().optional(),timestamp:Qe().datetime()}),alert:null,"system:status":null,"system:alert":null},ks=de.memo(function({initialLayer:r}={}){const{data:n,isLoading:c,error:g}=Be(),{data:v}=qe(),[b,N]=j.useState([]),[w,y]=j.useState([]),[C,k]=j.useState(!0),[S,E]=j.useState(null),{locations:A}=function(e={}){const{enabled:s=!0}=e,[t,l]=j.useState(new Map);return a(js.VEHICLE_LOCATION,j.useCallback(e=>{l(s=>{const t=new Map(s);return t.set(e.vehicleId,e),t})},[]),{enabled:s,validate:!0}),{locations:t,getLocation:j.useCallback(e=>t.get(e),[t])}}(),{status:L}=function(e={}){const{enabled:s=!0}=e,[t,l]=j.useState(null),[i,r]=j.useState([]);return a(js.FLEET_STATUS,j.useCallback(e=>{l(e),r(s=>[...s.slice(-99),e])},[]),{enabled:s,validate:!0}),{status:t,history:i}}(),{alerts:I}=function(e={}){const{enabled:s=!0,vehicleId:t=null,maxAlerts:l=100}=e,[i,r]=j.useState([]);return a(js.MAINTENANCE_ALERT,j.useCallback(e=>{t&&e.vehicleId!==t||r(s=>[e,...s].slice(0,l))},[t,l]),{enabled:s,validate:!0}),{alerts:i,clearAlerts:j.useCallback(()=>{r([])},[]),removeAlert:j.useCallback(e=>{r(s=>s.filter(s=>s.timestamp!==e))},[])}}({maxAlerts:50});!function(e={}){const{enabled:s=!0,geofenceId:t=null,vehicleId:l=null,maxBreaches:i=100}=e,[r,n]=j.useState([]);a(js.GEOFENCE_BREACH,j.useCallback(e=>{t&&e.geofenceId!==t||l&&e.vehicleId!==l||n(s=>[e,...s].slice(0,i))},[t,l,i]),{enabled:s,validate:!0}),j.useCallback(()=>{n([])},[])}({maxBreaches:50}),j.useEffect(()=>{v&&y(v)},[v]);const[T]=me(),[F,R]=j.useState(!1),[V,$]=j.useState({search:"",status:"all",source:"all"}),[U,G]=j.useState(),[B,q]=j.useState(!1),[H,W]=j.useState(null),[Q,Y]=j.useState([{id:"demo-1",tenantId:"demo",name:"Main HQ",description:"Headquarters geofence",type:"circle",active:!0,color:"#3B82F6",center:{lat:30.4383,lng:-84.2807},radius:1e3,triggers:{onEnter:!0,onExit:!0,onDwell:!1},notifyUsers:[],notifyRoles:[],alertPriority:"medium",createdBy:"system",createdAt:(new Date).toISOString(),lastModified:(new Date).toISOString()}]),[Z,J]=j.useState(!1),[K,X]=j.useState(null),{activeBreaches:ee,breachesByGeofence:se}=function(e,s){return j.useMemo(()=>{const t=[],a={};return s.forEach(s=>{s.active&&s.center&&s.radius&&e.forEach(e=>{const l=e.latitude||e.location?.lat,i=e.longitude||e.location?.lng;null!=l&&null!=i&&(function(e,s,t,a){const l=e*Math.PI/180,i=t*Math.PI/180,r=(t-e)*Math.PI/180,n=(a-s)*Math.PI/180,c=Math.sin(r/2)*Math.sin(r/2)+Math.cos(l)*Math.cos(i)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3}(s.center.lat,s.center.lng,l,i)>s.radius||(t.push({id:`${s.id}-${e.id}-${Date.now()}`,vehicleId:e.id,geofenceId:s.id,timestamp:(new Date).toISOString(),type:"enter"}),a[s.id]||(a[s.id]=[]),a[s.id]?.push(e.id)))})}),{activeBreaches:t,breachesByGeofence:a}},[e,s])}(b,Q),te=ee.length,ae=Object.keys(se).filter(e=>(se[e]?.length||0)>0);j.useEffect(()=>{const e=T.get("layer");"cameras"!==e&&"traffic-cameras"!==r||R(!0),"geofences"!==e&&"geofences"!==r||q(!0),"drivers"!==e&&"drivers"!==r||J(!0)},[T,r]),j.useEffect(()=>{const e=setTimeout(()=>{if(C&&0===b.length){const e=He(50);N(e),k(!1)}},5e3);return()=>clearTimeout(e)},[C,b.length]),j.useEffect(()=>{if(!c)if(g){const e=He(50);N(e),k(!1)}else if(n){let e=[];Array.isArray(n)?e=n:"object"==typeof n&&"data"in n&&Array.isArray(n.data)&&(e=n.data),e.length>0&&(Ne.info("[LiveFleetDashboard] API data loaded successfully:",e.length,"vehicles"),N(e),k(!1))}},[c,g,n]),j.useEffect(()=>{0!==A.size&&N(e=>e.map(e=>{const s=A.get(e.id);return s?{...e,location:{lat:s.latitude,lng:s.longitude},latitude:s.latitude,longitude:s.longitude,speed:s.speed,heading:s.heading,lastUpdate:s.timestamp}:e}))},[A]);const le=b.find(e=>e.id===S)||b[0],ie=L?.active??b.filter(e=>"active"===e.status).length,re=L?.maintenance??b.filter(e=>"maintenance"===e.status||"service"===e.status).length,ne=L?.totalVehicles??b.length,ce=I.filter(e=>"high"===e.priority||"critical"===e.priority).length,de=[{id:"dispatch",label:"Dispatch",icon:f.jsx(D,{className:"h-5 w-5"}),onClick:()=>{}},{id:"maintenance",label:"Maintenance",icon:f.jsx(oe,{className:"h-5 w-5"}),onClick:()=>{}},{id:"alerts",label:"Alerts",icon:f.jsx(P,{className:"h-5 w-5"}),onClick:()=>{},badge:ce>0?ce:re},{id:"fuel",label:"Fuel",icon:f.jsx(z,{className:"h-5 w-5"}),onClick:()=>{}}],pe=f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Fleet Overview"}),f.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Real-time vehicle monitoring"})]}),f.jsx(l,{variant:"badge",showDetails:!0})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[f.jsx(fe,{className:"bg-white/50 dark:bg-slate-900/50 backdrop-blur-md border-slate-200 dark:border-slate-800",children:f.jsxs(ge,{className:"pt-3 pb-2 px-2 sm:pt-4 sm:pb-3 sm:px-3",children:[f.jsx("div",{className:"text-xl sm:text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:ie}),f.jsx("div",{className:"text-[10px] sm:text-xs text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wide",children:"Active"})]})}),f.jsx(fe,{className:"bg-white/50 dark:bg-slate-900/50 backdrop-blur-md border-slate-200 dark:border-slate-800",children:f.jsxs(ge,{className:"pt-3 pb-2 px-2 sm:pt-4 sm:pb-3 sm:px-3",children:[f.jsx("div",{className:"text-xl sm:text-2xl font-bold text-amber-600 dark:text-amber-400",children:re}),f.jsx("div",{className:"text-[10px] sm:text-xs text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wide",children:"Maint."})]})}),f.jsx(fe,{className:"bg-white/50 dark:bg-slate-900/50 backdrop-blur-md border-slate-200 dark:border-slate-800",children:f.jsxs(ge,{className:"pt-3 pb-2 px-2 sm:pt-4 sm:pb-3 sm:px-3",children:[f.jsx("div",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-slate-100",children:ne}),f.jsx("div",{className:"text-[10px] sm:text-xs text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wide",children:"Total"})]})})]}),le&&f.jsxs(fe,{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg border-slate-200 dark:border-slate-700 shadow-lg",children:[f.jsx($e,{className:"pb-3 border-b border-slate-100 dark:border-slate-800",children:f.jsxs(Ue,{className:"text-lg flex items-center justify-between",children:[f.jsx("span",{className:"font-mono text-slate-900 dark:text-slate-100",children:le.vehicleNumber||le.number||"N/A"}),f.jsx(ve,{className:"active"===le.status?"bg-emerald-500 hover:bg-emerald-600":"bg-slate-500",children:le.status})]})}),f.jsxs(ge,{className:"space-y-3 pt-3",children:[f.jsxs("div",{className:"flex items-center text-sm",children:[f.jsx("div",{className:"p-1.5 rounded-md bg-slate-100 dark:bg-slate-800 mr-3",children:f.jsx(D,{className:"h-4 w-4 text-slate-500 dark:text-slate-400"})}),f.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:le.name||`${le.make||""} ${le.model||""}`.trim()||"Unknown Vehicle"})]}),f.jsxs("div",{className:"flex items-center text-sm",children:[f.jsx("div",{className:"p-1.5 rounded-md bg-slate-100 dark:bg-slate-800 mr-3",children:f.jsx(M,{className:"h-4 w-4 text-slate-500 dark:text-slate-400"})}),f.jsxs("span",{className:"font-mono text-slate-600 dark:text-slate-300",children:[le.location?.lat?.toFixed(4)||le.latitude?.toFixed(4)||"0.0000",","," ",le.location?.lng?.toFixed(4)||le.longitude?.toFixed(4)||"0.0000"]})]})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Quick Actions"}),f.jsx("div",{className:"md:hidden",children:f.jsx(s,{actions:de,layout:"horizontal-scroll"})}),f.jsxs("div",{className:"hidden md:grid grid-cols-2 gap-2",children:[f.jsxs(je,{variant:"outline",size:"sm",className:"w-full","data-testid":"dispatch-action",children:[f.jsx(D,{className:"h-4 w-4 mr-1"}),"Dispatch"]}),f.jsxs(je,{variant:"outline",size:"sm",className:"w-full","data-testid":"maintenance-action",children:[f.jsx(oe,{className:"h-4 w-4 mr-1"}),"Maintenance"]}),f.jsxs(je,{variant:"outline",size:"sm",className:"w-full","data-testid":"alerts-action",children:[f.jsx(P,{className:"h-4 w-4 mr-1"}),"Alerts"]}),f.jsxs(je,{variant:"outline",size:"sm",className:"w-full","data-testid":"fuel-action",children:[f.jsx(z,{className:"h-4 w-4 mr-1"}),"Fuel"]})]})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Recent Activity"}),f.jsx("div",{className:"md:hidden space-y-0 max-h-64 overflow-y-auto border-t border-slate-200",children:b.slice(0,10).map(e=>f.jsx(t,{vehicle:e,onClick:e=>E(e.id),variant:"list"},e.id))}),f.jsx("div",{className:"hidden md:block space-y-2 max-h-64 overflow-y-auto",children:b.slice(0,10).map(e=>f.jsxs("div",{className:"p-3 rounded-lg border cursor-pointer transition-colors "+(S===e.id?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-slate-300"),onClick:()=>E(e.id),"data-testid":`vehicle-list-item-${e.id}`,children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"font-medium text-sm",children:e.vehicleNumber||e.number||"N/A"}),f.jsx(ve,{variant:"active"===e.status?"default":"secondary",className:"text-xs",children:e.status})]}),f.jsx("div",{className:"text-xs text-slate-500 mt-1",children:e.name||`${e.make||""} ${e.model||""}`.trim()||"Unknown Vehicle"})]},e.id))})]})]}),be=le&&f.jsxs("div",{className:"space-y-4",children:[f.jsxs("h3",{className:"text-lg font-bold",children:["Vehicle Details: ",le.vehicleNumber||le.number||"N/A"]}),f.jsx("div",{className:"space-y-2",children:f.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[f.jsx("div",{className:"font-semibold",children:"Vehicle:"}),f.jsx("div",{children:le.name||`${le.make||""} ${le.model||""}`.trim()||"Unknown"}),f.jsx("div",{className:"font-semibold",children:"Year:"}),f.jsx("div",{children:le.year||"N/A"}),f.jsx("div",{className:"font-semibold",children:"Status:"}),f.jsx("div",{children:f.jsx(ve,{variant:"active"===le.status?"default":"secondary",children:le.status})})]})})]});if(C)return f.jsx("div",{className:"flex items-center justify-center h-screen",children:f.jsxs("div",{className:"text-center",children:[f.jsx(O,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),f.jsx("p",{className:"mt-4 text-slate-600",children:"Loading fleet data..."})]})});const we=f.jsx(e,{onZoomIn:()=>{},onZoomOut:()=>{},onLocate:()=>{},onToggleLayers:()=>{}});return f.jsxs("div",{className:"relative h-full w-full",children:[f.jsx(he,{mapComponent:f.jsxs(ue,{onVehicleSelect:E,children:[f.jsx(d,{visible:F,filters:V,onCameraSelect:e=>G(e.id),selectedCameraId:U}),f.jsx(i,{visible:B,geofences:Q,onGeofenceSelect:W,breachedGeofenceIds:ae})]}),sidePanel:pe,drawerContent:be,mapControls:we}),f.jsx(p,{isVisible:F,filters:V,onFilterChange:(e,s)=>$(t=>({...t,[e]:s})),onClose:()=>R(!1)}),f.jsx(h,{isVisible:B,geofences:Q,onGeofencesChange:Y,onClose:()=>q(!1)}),f.jsx(u,{geofence:H,onClose:()=>W(null),vehicles:b,breachedVehicleIds:H&&se[H.id]||[]}),f.jsx(x,{isVisible:Z,drivers:w,onDriverSelect:X,onClose:()=>J(!1),onDriversChange:y}),f.jsx(m,{driver:K,vehicles:b,onClose:()=>X(null)}),f.jsx(o,{layers:[{id:"traffic-cameras",label:"Traffic Cameras",icon:f.jsx(xe,{className:"w-4 h-4"}),active:F,count:12,onToggle:R},{id:"geofences",label:"Geofences",icon:f.jsx(M,{className:"w-4 h-4"}),active:B,count:te>0?te:Q.filter(e=>e.active).length,onToggle:q},{id:"drivers",label:"Drivers",icon:f.jsx(_,{className:"w-4 h-4"}),active:Z,count:w.length,onToggle:J}]})]})});export{ks as LiveFleetDashboard};
