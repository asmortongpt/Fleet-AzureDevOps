function e(){const e=l(),r=t.useMemo(()=>e.vehicles||[],[e.vehicles]),a=t.useMemo(()=>e.facilities||[],[e.facilities]),{data:i}=m(),[o,s]=(u(),t.useState(w)),[g,y]=t.useState(null),[j,v]=t.useState(h);t.useMemo(()=>{const e=Array.isArray(i)?i:i?.data||[];if(!e)return[];try{return e.map(e=>({id:e.id,type:e.incident_type||"hazard",severity:e.severity||"minor",location:{lat:parseFloat(e.latitude)||0,lng:parseFloat(e.longitude)||0},description:e.description||"No description available",impactedRoutes:e.impacted_routes||[],estimatedDelay:e.estimated_delay||0,reportedAt:e.incident_date||e.created_at||(new Date).toISOString()}))}catch(t){return f.error("Error transforming incident data:",t),[]}},[i]);const S=t.useMemo(()=>[],[]);t.useMemo(()=>o.filter(e=>e.enabled),[o]),t.useCallback(e=>{s(t=>t.map(t=>t.id===e?{...t,enabled:!t.enabled}:t))},[]);const b=t.useMemo(()=>o.find(e=>"weather"===e.id)?.enabled??!1,[o]),{refetch:D}=c({queryKey:["weather",j[0],j[1]],queryFn:()=>(async(e,t)=>{try{const r=`https://api.weather.gov/points/${e.toFixed(4)},${t.toFixed(4)}`,a=await fetch(r,{headers:{"User-Agent":"Fleet Management System (contact@fleetdemo.com)",Accept:"application/geo+json"}});if(!a.ok)throw new Error(`Failed to fetch grid point: ${a.status} ${a.statusText}`);const i=await a.json();if(!i.properties?.forecast)throw new Error("Invalid response from NWS API: missing forecast URL");const o=i.properties.forecast,s=`https://api.weather.gov/alerts/active?point=${e},${t}`,[n,c]=await Promise.all([fetch(o,{headers:{"User-Agent":"Fleet Management System (contact@fleetdemo.com)",Accept:"application/geo+json"}}),fetch(s,{headers:{"User-Agent":"Fleet Management System (contact@fleetdemo.com)",Accept:"application/geo+json"}})]);if(!n.ok)throw new Error(`Failed to fetch forecast: ${n.status}`);const d=await n.json(),p=c.ok?await c.json():{features:[]},l=d.properties?.periods?.[0];if(!l)throw new Error("No forecast periods available");return{temperature:l.temperature||0,conditions:l.shortForecast||"Unknown",windSpeed:parseInt(l.windSpeed)||0,windDirection:l.windDirection||"N",humidity:l.relativeHumidity?.value||0,visibility:10,precipitation:0,alerts:(p.features||[]).map(e=>({id:e.id||`alert-${Date.now()}`,event:e.properties?.event||"Weather Alert",severity:e.properties?.severity?.toLowerCase()||"minor",urgency:e.properties?.urgency?.toLowerCase()||"expected",certainty:e.properties?.certainty?.toLowerCase()||"possible",area:e.properties?.areaDesc||"Unknown area",headline:e.properties?.headline||"",description:e.properties?.description||"",instruction:e.properties?.instruction||"",onset:e.properties?.onset||(new Date).toISOString(),expires:e.properties?.expires||(new Date).toISOString()}))}}catch(r){throw f.error("Error fetching weather data:",r),r}})(j[0],j[1]),enabled:b,staleTime:3e5,gcTime:6e5,retry:1,retryDelay:e=>Math.min(1e3*2**e,3e4)});return t.useCallback(()=>{D()},[D]),t.useCallback(e=>{switch(e.toLowerCase()){case"extreme":case"critical":return"destructive";case"severe":case"major":return"default";case"moderate":case"minor":return"secondary";default:return"outline"}},[]),t.useCallback(()=>n.jsx(p,{className:"h-6 w-full"}),[]),n.jsx("div",{className:"relative h-full w-full",children:n.jsx(d,{cameras:S,vehicles:r,facilities:a,onCameraClick:e=>y(e),className:"w-full h-full"})})}import{r as t,cp as r,cq as a,ac as i,C as o,bm as s,j as n}from"./react-core-hQu9tqS1.js";import{u as c}from"./query-vendor--Fe2N4Al.js";import{U as d}from"./UniversalMap-ZyGzQ1ui.js";import{S as p}from"./skeleton-D5f7LGYG.js";import{u as l,J as m,K as u,p as f}from"./index-BDwglPMF.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./GoogleMap-BAYip6gy.js";import"./react-router-cBrq_s0x.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";const h=[30.4383,-84.2807],w=[{id:"traffic",name:"Live Traffic",type:"traffic",enabled:!0,icon:r,description:"Real-time traffic conditions and congestion",dataSource:"Google Traffic / HERE Maps",requiresData:!1},{id:"weather",name:"Weather Radar",type:"weather",enabled:!0,icon:a,description:"NWS weather radar and alerts",dataSource:"weather.gov API",requiresData:!0},{id:"cameras",name:"Traffic Cameras",type:"camera",enabled:!1,icon:i,description:"DOT traffic camera feeds",dataSource:"State DOT APIs",requiresData:!0},{id:"incidents",name:"Traffic Incidents",type:"incident",enabled:!0,icon:o,description:"Accidents, construction, road closures",dataSource:"Safety Incidents API",requiresData:!0},{id:"charging",name:"EV Charging Stations",type:"charging",enabled:!1,icon:s,description:"Public charging network locations",dataSource:"OCPI / ChargePoint",requiresData:!0}];export{e as EnhancedMapLayers};
