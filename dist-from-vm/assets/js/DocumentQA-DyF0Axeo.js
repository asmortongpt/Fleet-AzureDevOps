function e(){const[e,A]=s.useState([{id:"welcome",type:"answer",text:"Hello! I'm your Fleet Document Assistant. I can help you find information across all your fleet documents. Ask me anything about your policies, maintenance procedures, safety protocols, or any other fleet documentation.",timestamp:new Date}]),[E,F]=s.useState(""),[I,$]=s.useState("all"),K=s.useRef(null),z=s.useRef(null),G=u(),{data:H}=x({queryKey:["documents","categories"],queryFn:async()=>(await _.get("/documents/categories/all",{method:"GET"})).categories||[],staleTime:3e5,gcTime:6e5}),{data:Q}=x({queryKey:["documents","queries","history"],queryFn:async()=>(await _.get("/documents/queries/history",{method:"GET",params:{limit:"10"}})).queries||[],staleTime:12e4,gcTime:3e5}),R=h({mutationFn:async e=>await _.get("/documents/ask",{method:"POST",body:{question:e,categoryId:"all"!==I?I:void 0,maxSources:5}}),onSuccess:(e,s)=>{const t={id:`q-${Date.now()}`,type:"question",text:s,timestamp:new Date},a={id:e.query_id||`a-${Date.now()}`,type:"answer",text:e.answer,sources:e.sources,confidence:e.confidence,timestamp:new Date};A(e=>[...e,t,a]),G.invalidateQueries({queryKey:["documents","queries","history"]})},onError:(e,s)=>{k.error("Error asking question:",e),p.error("Failed to get answer. Please try again.");const t={id:`q-${Date.now()}`,type:"question",text:s,timestamp:new Date},a={id:`e-${Date.now()}`,type:"answer",text:"I'm sorry, I encountered an error while processing your question. Please try again or rephrase your question.",timestamp:new Date};A(e=>[...e,t,a])}}),W=h({mutationFn:async({messageId:e,rating:s})=>{await _.get(`/documents/queries/${e}/feedback`,{method:"POST",body:{rating:s}})},onSuccess:()=>{p.success("Thank you for your feedback!")},onError:e=>{k.error("Error submitting feedback:",e),p.error("Failed to submit feedback")}});s.useEffect(()=>{K.current&&(K.current.scrollTop=K.current.scrollHeight)},[e]);const M=async()=>{if(!E.trim()||R.isPending)return;const e=E.trim();F(""),z.current?.focus(),await R.mutateAsync(e)},O=(e,s)=>{W.mutate({messageId:e,rating:s})};return t.jsxs("div",{className:"h-[calc(100vh-200px)] flex gap-4",children:[t.jsx("div",{className:"flex-1 flex flex-col",children:t.jsxs(j,{className:"flex-1 flex flex-col",children:[t.jsx(f,{className:"border-b",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-primary text-primary-foreground rounded-lg",children:t.jsx(a,{className:"w-6 h-6",weight:"bold"})}),t.jsxs("div",{children:[t.jsx(g,{children:"Document Q&A Assistant"}),t.jsx(y,{children:"Ask questions about your fleet documents"})]})]}),t.jsxs(D,{value:I,onValueChange:$,children:[t.jsx(S,{className:"w-[200px]",children:t.jsx(T,{placeholder:"All Categories"})}),t.jsxs(C,{children:[t.jsx(P,{value:"all",children:"All Categories"}),H?.map(e=>t.jsx(P,{value:e.id,children:e.category_name},e.id))]})]})]})}),t.jsxs(N,{className:"flex-1 flex flex-col p-0",children:[t.jsx(v,{className:"flex-1 p-6",ref:K,children:t.jsxs("div",{className:"space-y-6",children:[e.map(e=>t.jsxs("div",{className:"flex gap-4 "+("question"===e.type?"flex-row-reverse":""),children:[t.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center "+("question"===e.type?"bg-primary text-primary-foreground":"bg-muted"),children:t.jsx("question"===e.type?r:a,{className:"w-5 h-5",weight:"bold"})}),t.jsxs("div",{className:"flex-1 "+("question"===e.type?"text-right":""),children:[t.jsxs("div",{className:"inline-block max-w-[80%] rounded-lg p-4 "+("question"===e.type?"bg-primary text-primary-foreground":"bg-muted"),children:[t.jsx("p",{className:"whitespace-pre-wrap",children:e.text}),void 0!==e.confidence&&t.jsx("div",{className:"mt-2 pt-2 border-t border-border/50",children:t.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80",children:[t.jsx(i,{className:"w-3 h-3"}),"Confidence: ",Math.round(100*e.confidence),"%"]})})]}),e.sources&&e.sources.length>0&&t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsxs("p",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[t.jsx(n,{className:"w-4 h-4"}),"Sources (",e.sources.length,")"]}),e.sources.map((e,s)=>t.jsx(j,{className:"bg-card/50",children:t.jsxs(N,{className:"p-3",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(c,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:e.document_name})]}),t.jsxs(w,{variant:"secondary",className:"text-xs",children:[Math.round(100*e.similarity_score),"% match"]})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.chunk_text}),e.page_number&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Page ",e.page_number]})]})},e.chunk_id))]}),"answer"===e.type&&"welcome"!==e.id&&t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx(b,{variant:"ghost",size:"sm",onClick:()=>O(e.id,5),children:t.jsx(l,{className:"w-4 h-4"})}),t.jsx(b,{variant:"ghost",size:"sm",onClick:()=>O(e.id,1),children:t.jsx(o,{className:"w-4 h-4"})})]})]})]},e.id)),R.isPending&&t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:t.jsx(d,{className:"w-5 h-5 animate-spin",weight:"bold"})}),t.jsx("div",{className:"flex-1",children:t.jsx("div",{className:"inline-block rounded-lg p-4 bg-muted",children:t.jsx("p",{className:"text-muted-foreground",children:"Thinking..."})})})]})]})}),t.jsxs("div",{className:"border-t p-4 space-y-3",children:[1===e.length&&t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("p",{className:"w-full text-sm text-muted-foreground mb-1",children:"Suggested questions:"}),["What's our maintenance policy for electric vehicles?","How often should vehicles be inspected?","What are the safety requirements for drivers?","Tell me about our fuel management procedures","What's the process for reporting incidents?"].map((e,s)=>t.jsx(b,{variant:"outline",size:"sm",onClick:()=>F(e),children:e},s))]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(q,{ref:z,placeholder:"Ask a question about your fleet documents...",value:E,onChange:e=>F(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},disabled:R.isPending,className:"flex-1"}),t.jsx(b,{onClick:M,disabled:!E.trim()||R.isPending,children:R.isPending?t.jsx(d,{className:"w-5 h-5 animate-spin"}):t.jsx(m,{className:"w-5 h-5",weight:"fill"})})]})]})]})]})}),t.jsxs(j,{className:"w-80",children:[t.jsxs(f,{children:[t.jsx(g,{className:"text-lg",children:"Recent Questions"}),t.jsx(y,{children:"Your query history"})]}),t.jsx(N,{children:t.jsx(v,{className:"h-[calc(100vh-350px)]",children:t.jsx("div",{className:"space-y-2",children:0===(Q?.length??0)?t.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No history yet. Start asking questions!"}):Q?.map(e=>t.jsx(j,{className:"cursor-pointer hover:bg-accent transition-colors",onClick:()=>(e=>{F(e.query_text),z.current?.focus()})(e),children:t.jsxs(N,{className:"p-3",children:[t.jsx("p",{className:"text-sm font-medium line-clamp-2 mb-1",children:e.query_text}),t.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:e.response_text}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()}),e.feedback_rating&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(l,{className:"w-3 h-3 text-green-600"}),t.jsxs("span",{className:"text-xs",children:[e.feedback_rating,"/5"]})]})]})]})},e.id))})})})]})]})}import{r as s,j as t,ap as a,cZ as r,c_ as i,c$ as n,aq as c,d0 as l,d1 as o,d2 as d,d3 as m}from"./react-core-hQu9tqS1.js";import{a as u,u as x,b as h}from"./query-vendor--Fe2N4Al.js";import{t as p}from"./index-savvei9t.js";import{C as j,d as f,e as g,i as y,f as N,S as v,B as w,h as b,I as q,p as k,o as _}from"./index-BDwglPMF.js";import{S as D,a as S,b as T,c as C,d as P}from"./select-Bmd3s7f4.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";export{e as DocumentQA};
