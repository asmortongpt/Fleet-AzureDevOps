function e({trigger:e,vehicleId:n="",driverId:l="",onSuccess:d,defaultValues:c}){const[o,x]=s.useState(!1),[h,p]=s.useState({vehicle_id:n,driver_id:l,usage_type:"business",business_purpose:"",business_percentage:100,personal_notes:"",miles_total:0,trip_date:(new Date).toISOString().split("T")[0],start_location:"",end_location:"",start_odometer:0,end_odometer:0,...c}),{data:D}=u({queryKey:ie.policies(),queryFn:async()=>(await _.personalUse.getPolicies()).data,staleTime:3e5,gcTime:6e5,retry:2,enabled:!0}),P=function(){const e=m();return j({mutationFn:async e=>(await _.personalUse.createTripUsage(e)).data,onSuccess:s=>{e.invalidateQueries({queryKey:ie.tripUsages()}),e.setQueryData(ie.tripUsage(s.id),s)},onError:e=>{v.error("Error creating trip usage:",{error:e})}})}(),q=()=>{if(!D?.charge_personal_use||!D.personal_use_rate_per_mile)return 0;let e=0;return"personal"===h.usage_type?e=h.miles_total:"mixed"===h.usage_type&&(e=h.miles_total*((100-(h.business_percentage??50))/100)),e*D.personal_use_rate_per_mile},U=h.business_percentage??50,O="business"===h.usage_type?h.miles_total:"mixed"===h.usage_type?h.miles_total*(U/100):0,E="personal"===h.usage_type?h.miles_total:"mixed"===h.usage_type?h.miles_total*((100-U)/100):0;return r.jsxs(y,{open:o,onOpenChange:x,children:[r.jsx(N,{asChild:!0,children:e||r.jsxs(f,{children:[r.jsx(a,{className:"w-4 h-4 mr-2"}),"Record Trip Usage"]})}),r.jsxs(b,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[r.jsx(w,{children:r.jsxs(T,{className:"flex items-center gap-2",children:[r.jsx(i,{className:"w-5 h-5"}),"Personal vs Business Trip Classification"]})}),r.jsxs("div",{className:"space-y-6 py-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx(V,{className:"text-base font-semibold",children:"Trip Usage Type *"}),r.jsxs(K,{value:h.usage_type,onValueChange:e=>{p({...h,usage_type:e,business_percentage:"business"===e?100:"personal"===e?0:50})},className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-accent cursor-pointer",children:[r.jsx(B,{value:"business",id:"business"}),r.jsxs(V,{htmlFor:"business",className:"flex-1 cursor-pointer",children:[r.jsx("div",{className:"font-semibold",children:"Business Use"}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Official organization business - Full federal rate reimbursement"})]})]}),r.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-accent cursor-pointer",children:[r.jsx(B,{value:"personal",id:"personal"}),r.jsxs(V,{htmlFor:"personal",className:"flex-1 cursor-pointer",children:[r.jsx("div",{className:"font-semibold",children:"Personal Use"}),r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Private/personal use - ",D?.charge_personal_use?"Subject to charges":"No reimbursement"]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-accent cursor-pointer",children:[r.jsx(B,{value:"mixed",id:"mixed"}),r.jsxs(V,{htmlFor:"mixed",className:"flex-1 cursor-pointer",children:[r.jsx("div",{className:"font-semibold",children:"Mixed Use"}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Combination of business and personal - Pro-rated calculation"})]})]})]}),!D?.allow_personal_use&&"business"!==h.usage_type&&r.jsxs(F,{variant:"destructive",children:[r.jsx(t,{className:"h-4 w-4"}),r.jsx(S,{children:"Personal use is not permitted per organization policy"})]})]}),"mixed"===h.usage_type&&r.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-accent/50",children:[r.jsxs(V,{className:"text-base font-semibold",children:["Business Percentage: ",h.business_percentage??50,"%"]}),r.jsx(Q,{value:[h.business_percentage??50],onValueChange:([e])=>p({...h,business_percentage:e??50}),min:1,max:99,step:1,className:"w-full"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-muted-foreground",children:"Business Miles"}),r.jsxs("div",{className:"font-semibold",children:[O.toFixed(1)," mi"]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-muted-foreground",children:"Personal Miles"}),r.jsxs("div",{className:"font-semibold",children:[E.toFixed(1)," mi"]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"trip_date",children:"Trip Date *"}),r.jsx(A,{id:"trip_date",type:"date",value:h.trip_date,onChange:e=>p({...h,trip_date:e.target.value}),max:(new Date).toISOString().split("T")[0]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"miles_total",children:"Total Miles *"}),r.jsx(A,{id:"miles_total",type:"number",min:"0",step:"0.1",value:h.miles_total||"",onChange:e=>p({...h,miles_total:parseFloat(e.target.value)||0}),placeholder:"0.0"})]})]}),("business"===h.usage_type||"mixed"===h.usage_type)&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs(V,{htmlFor:"business_purpose",children:["Business Purpose * ",r.jsx("span",{className:"text-xs text-muted-foreground",children:"(Federal requirement)"})]}),r.jsx(z,{id:"business_purpose",value:h.business_purpose,onChange:e=>p({...h,business_purpose:e.target.value}),placeholder:"e.g., Client meeting, site visit, training session...",rows:2})]}),"personal"===h.usage_type&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"personal_notes",children:"Personal Notes (Optional)"}),r.jsx(z,{id:"personal_notes",value:h.personal_notes,onChange:e=>p({...h,personal_notes:e.target.value}),placeholder:"Optional notes about personal use...",rows:2})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"start_location",children:"Start Location"}),r.jsx(A,{id:"start_location",value:h.start_location,onChange:e=>p({...h,start_location:e.target.value}),placeholder:"e.g., Office, Home..."})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"end_location",children:"End Location"}),r.jsx(A,{id:"end_location",value:h.end_location,onChange:e=>p({...h,end_location:e.target.value}),placeholder:"e.g., Client site, Airport..."})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"start_odometer",children:"Start Odometer (Optional)"}),r.jsx(A,{id:"start_odometer",type:"number",min:"0",step:"0.1",value:h.start_odometer||"",onChange:e=>p({...h,start_odometer:parseFloat(e.target.value)||0}),placeholder:"0.0"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(V,{htmlFor:"end_odometer",children:"End Odometer (Optional)"}),r.jsx(A,{id:"end_odometer",type:"number",min:"0",step:"0.1",value:h.end_odometer||"",onChange:e=>p({...h,end_odometer:parseFloat(e.target.value)||0}),placeholder:"0.0"})]})]}),q()>0&&r.jsxs(F,{children:[r.jsx(t,{className:"h-4 w-4"}),r.jsxs(S,{children:[r.jsx("strong",{children:"Estimated Personal Use Charge:"})," $",q().toFixed(2),r.jsx("br",{}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:["Based on ",E.toFixed(1)," personal miles at $",D?.personal_use_rate_per_mile??0,"/mile"]})]})]})]}),r.jsxs(C,{children:[r.jsx(f,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),r.jsx(f,{onClick:()=>{const e=(()=>{if(!h.vehicle_id)return"Vehicle is required";if(!h.driver_id)return"Driver is required";if(0>=h.miles_total)return"Miles must be greater than 0";if(!h.trip_date)return"Trip date is required";if(("business"===h.usage_type||"mixed"===h.usage_type)&&!h.business_purpose.trim())return"Business purpose is required for business and mixed trips (federal requirement)";const e=h.business_percentage??50;if(!("mixed"!==h.usage_type||e>0&&100>e))return"Business percentage must be between 1-99 for mixed trips";if(D&&!D.allow_personal_use&&"business"!==h.usage_type)return"Personal use is not permitted per organization policy";if(h.start_odometer&&h.end_odometer){if(h.start_odometer>=h.end_odometer)return"End odometer must be greater than start odometer";const e=h.end_odometer-h.start_odometer;if(Math.abs(e-h.miles_total)>5)return`Odometer readings (${e} mi) don't match entered miles (${h.miles_total} mi)`}return null})();e?g.error(e):P.mutate(h,{onSuccess:e=>{g.success("pending"===e.approval_status?"Trip recorded and submitted for approval":"Trip recorded successfully");const s=q();s>0&&g.info(`Estimated personal use charge: $${s.toFixed(2)}`),x(!1),p({vehicle_id:n,driver_id:l,usage_type:"business",business_purpose:"",business_percentage:100,personal_notes:"",miles_total:0,trip_date:(new Date).toISOString().split("T")[0],start_location:"",end_location:"",start_odometer:0,end_odometer:0}),d?.()},onError:e=>{g.error(e.response?.data?.error||e.message||"Failed to record trip usage")}})},disabled:P.isPending,children:P.isPending?"Recording...":"Record Trip"})]})]})]})}import{r as s,j as r,br as a,c5 as i,bh as t,R as n,bi as l,bj as d,bq as c,C as o,by as x,ah as h,as as p}from"./react-core-hQu9tqS1.js";import{u,a as m,b as j}from"./query-vendor--Fe2N4Al.js";import{t as g}from"./index-savvei9t.js";import{p as v,o as _,D as y,t as N,h as f,j as b,k as w,l as T,A as F,w as S,I as A,n as C,T as D,a as P,b as q,c as U,C as O,d as E,e as k,i as L,f as R,P as $,y as I,B as M}from"./index-BDwglPMF.js";import{L as V}from"./label-C9sYRYKW.js";import{R as K,a as B}from"./radio-group-am2T2p6t.js";import{S as Q}from"./slider-DpXVN0eA.js";import{T as z}from"./textarea-BOBjqKNu.js";import{S as H,a as Y,b as J,c as G,d as Z}from"./select-Bmd3s7f4.js";import{T as W,a as X,b as ee,c as se,d as re,e as ae}from"./table-_lE51wjz.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";const ie={all:["personalUse"],policies:()=>[...ie.all,"policies"],tripUsages:()=>[...ie.all,"tripUsages"],tripUsage:e=>[...ie.all,"tripUsage",e]},te=()=>r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}),ne=({error:e,onRetry:s})=>r.jsxs(F,{variant:"destructive",className:"m-4",children:[r.jsx(x,{className:"h-4 w-4"}),r.jsx(I,{children:"Error"}),r.jsxs(S,{className:"flex items-center justify-between",children:[r.jsx("span",{children:e}),r.jsxs(f,{variant:"outline",size:"sm",onClick:s,children:[r.jsx(l,{className:"w-4 h-4 mr-2"}),"Retry"]})]})]}),le=({message:e})=>r.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground",children:[r.jsx(i,{className:"w-16 h-16 mb-4 opacity-50"}),r.jsx("p",{children:e})]}),de=async e=>{const s=localStorage.getItem("token"),r=await fetch(e,{headers:{Authorization:`Bearer ${s}`}});if(!r.ok)throw new Error("Failed to fetch");return r.json()},ce=async(e,s,r)=>{const a=localStorage.getItem("token"),i=await fetch(e,{method:s,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:r?JSON.stringify(r):void 0});if(!i.ok){const e=await i.json();throw new Error(e.error||"Failed to perform action")}return i.json()},oe=({})=>{const t=m(),[_,y]=s.useState("driver"),[N,b]=s.useState(""),[w,T]=s.useState("30days"),[A,C]=s.useState("all"),[V,K]=s.useState("all");n.useEffect(()=>{localStorage.getItem("token");const e=JSON.parse(localStorage.getItem("user")||"{}");b(e.id||""),y(e.role||"driver")},[]);const{data:B,isLoading:Q}=u({queryKey:["personal-use-limits",N],queryFn:()=>de(`/api/personal-use-policies/limits/${N}`),enabled:"driver"===_&&!!N,staleTime:3e4,gcTime:6e4}),{data:z,isLoading:ie}=u({queryKey:["trip-usage",N],queryFn:()=>de(`/api/trip-usage?driver_id=${N}&limit=50`),enabled:"driver"===_&&!!N,staleTime:3e4,gcTime:6e4}),{data:oe,isLoading:xe}=u({queryKey:["personal-use-charges-dashboard",N],queryFn:()=>de(`/api/personal-use-charges?driver_id=${N}`),enabled:"driver"===_&&!!N,staleTime:3e4,gcTime:6e4}),{data:he,isLoading:pe,error:ue}=u({queryKey:["trip-usage-pending-approval"],queryFn:()=>de("/api/trip-usage/pending-approval"),enabled:"driver"!==_,staleTime:3e4,gcTime:6e4});n.useEffect(()=>{ue&&(v.error("Failed to fetch dashboard data:",ue),g.error(ue instanceof Error?ue.message:"Failed to load dashboard data"))},[ue]);const me=B?.data||null,je=z?.data||[],ge=oe?.data||[],ve=he?.data||[],_e=ve.length>0?{total_members:ve.length||0,pending_approvals:ve.filter(e=>"pending"===e.approval_status).length||0,drivers_near_limit:0,total_charges_this_month:0}:null,ye="driver"===_?Q||ie||xe:pe,Ne=ue,{mutate:fe}=j({mutationFn:async e=>ce(`/api/trip-usage/${e}/approve`,"POST",{}),onSuccess:()=>{g.success("Trip approved successfully"),t.invalidateQueries({queryKey:["trip-usage-pending-approval"]})},onError:e=>{g.error(e instanceof Error?e.message:"Failed to approve trip")}}),{mutate:be}=j({mutationFn:async({tripId:e,reason:s})=>ce(`/api/trip-usage/${e}/reject`,"POST",{rejection_reason:s}),onSuccess:()=>{g.success("Trip rejected"),t.invalidateQueries({queryKey:["trip-usage-pending-approval"]})},onError:e=>{g.error(e instanceof Error?e.message:"Failed to reject trip")}}),we=e=>{const s={pending:{variant:"secondary",icon:p},approved:{variant:"default",icon:h},rejected:{variant:"destructive",icon:x},auto_approved:{variant:"outline",icon:h}}[e]||{variant:"secondary",icon:p},{variant:a,icon:i}=s;return r.jsxs(M,{variant:a,className:"flex items-center gap-1",children:[r.jsx(i,{className:"w-3 h-3"}),e.replace("_"," ")]})},Te=e=>r.jsx(M,{className:{business:"bg-green-500/10 text-green-700 dark:text-green-400",personal:"bg-blue-500/10 text-blue-700 dark:text-blue-400",mixed:"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400"}[e]||"bg-gray-500/10",children:e});return ye?r.jsx(te,{}):Ne&&Ne instanceof Error?r.jsx(ne,{error:Ne.message,onRetry:()=>t.invalidateQueries({queryKey:["trip-usage-pending-approval"]})}):r.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[r.jsx(i,{className:"w-8 h-8"}),"Personal Use Dashboard"]}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"driver"===_?"Track your personal vs business vehicle usage":"Manage team personal use approvals and compliance"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(f,{variant:"outline",onClick:()=>{"driver"===_?(t.invalidateQueries({queryKey:["personal-use-limits",N]}),t.invalidateQueries({queryKey:["trip-usage",N]}),t.invalidateQueries({queryKey:["personal-use-charges-dashboard",N]})):t.invalidateQueries({queryKey:["trip-usage-pending-approval"]})},children:[r.jsx(l,{className:"w-4 h-4 mr-2"}),"Refresh"]}),r.jsxs(f,{variant:"outline",onClick:()=>{const e="driver"===_?je:ve,s=[["Date","Vehicle","Miles","Type","Status","Purpose"].join(","),...(e||[]).map(e=>[new Date(e.trip_date||"").toLocaleDateString(),e.vehicle_id||"",e.miles_total||0,e.usage_type||"",e.approval_status||"",e.business_purpose||""].join(","))].join("\n"),r=new Blob([s],{type:"text/csv"}),a=window.URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=`trip-usage-${(new Date).toISOString().split("T")[0]}.csv`,i.click(),g.success("Report exported successfully")},children:[r.jsx(d,{className:"w-4 h-4 mr-2"}),"Export"]}),"driver"===_&&r.jsx(e,{trigger:r.jsxs(f,{children:[r.jsx(a,{className:"w-4 h-4 mr-2"}),"Record Trip"]}),driverId:N,onSuccess:()=>{t.invalidateQueries({queryKey:["trip-usage",N]}),t.invalidateQueries({queryKey:["personal-use-charges-dashboard",N]})}})]})]}),r.jsxs(D,{defaultValue:"driver"===_?"overview":"approvals",className:"space-y-4",children:[r.jsx(P,{children:r.jsxs(r.Fragment,"driver"===_?{children:[r.jsx(q,{value:"overview",children:"Overview"}),r.jsx(q,{value:"trips",children:"Trip History"}),r.jsx(q,{value:"charges",children:"Charges"})]}:{children:[r.jsx(q,{value:"approvals",children:"Approval Queue"}),r.jsx(q,{value:"team",children:"Team Overview"}),r.jsx(q,{value:"violations",children:"Policy Violations"})]})}),"driver"===_&&r.jsxs(r.Fragment,{children:[r.jsxs(U,{value:"overview",className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsxs(k,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Monthly Personal Use"}),r.jsx(c,{className:"w-5 h-5 text-muted-foreground"})]}),r.jsx(L,{children:me?.current_month?.period||(new Date).toISOString().slice(0,7)})]}),r.jsxs(R,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsxs("span",{children:[(me?.current_month?.personal_miles??0).toFixed(1)," miles"]}),r.jsx("span",{className:"text-muted-foreground",children:me?.current_month?.limit?`of ${me.current_month.limit} miles`:"No limit set"})]}),r.jsx($,{value:me?.current_month?.percentage_used||0,className:95>(me?.current_month?.percentage_used||0)?80>(me?.current_month?.percentage_used||0)?"":"bg-yellow-500":"bg-red-500"}),r.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[(me?.current_month?.percentage_used??0).toFixed(1),"% used"]})]}),me?.current_month?.exceeds_limit&&r.jsxs(F,{variant:"destructive",children:[r.jsx(o,{className:"h-4 w-4"}),r.jsx(S,{children:"Monthly limit exceeded! Additional usage may require approval."})]}),!me?.current_month?.exceeds_limit&&(me?.current_month?.percentage_used||0)>=80&&r.jsxs(F,{children:[r.jsx(o,{className:"h-4 w-4"}),r.jsxs(S,{children:["Approaching monthly limit (",(me?.current_month?.percentage_used??0).toFixed(0),"% used)"]})]})]})]}),r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsxs(k,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Annual Personal Use"}),r.jsx(c,{className:"w-5 h-5 text-muted-foreground"})]}),r.jsx(L,{children:me?.current_year?.period||(new Date).getFullYear().toString()})]}),r.jsxs(R,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsxs("span",{children:[(me?.current_year?.personal_miles??0).toFixed(1)," miles"]}),r.jsx("span",{className:"text-muted-foreground",children:me?.current_year?.limit?`of ${me.current_year.limit} miles`:"No limit set"})]}),r.jsx($,{value:me?.current_year?.percentage_used||0,className:95>(me?.current_year?.percentage_used||0)?80>(me?.current_year?.percentage_used||0)?"":"bg-yellow-500":"bg-red-500"}),r.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[(me?.current_year?.percentage_used??0).toFixed(1),"% used"]})]}),me?.current_year?.exceeds_limit&&r.jsxs(F,{variant:"destructive",children:[r.jsx(o,{className:"h-4 w-4"}),r.jsx(S,{children:"Annual limit exceeded! Additional usage may require approval."})]}),!me?.current_year?.exceeds_limit&&(me?.current_year?.percentage_used||0)>=80&&r.jsxs(F,{children:[r.jsx(o,{className:"h-4 w-4"}),r.jsxs(S,{children:["Approaching annual limit (",(me?.current_year?.percentage_used??0).toFixed(0),"% used)"]})]})]})]})]}),me?.warnings?.length>0&&r.jsxs(F,{variant:"destructive",className:"mb-6",children:[r.jsx(o,{className:"h-4 w-4"}),r.jsx(I,{children:"Usage Alerts"}),r.jsx(S,{className:"space-y-2",children:me.warnings.map((e,s)=>r.jsxs("div",{children:["- ",e]},s))})]}),r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsxs(k,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Recent Trips"}),r.jsx(f,{variant:"link",size:"sm",className:"p-0 h-auto",children:"View All"})]}),r.jsx(L,{children:"Your most recent trip classifications"})]}),r.jsx(R,{children:je.length>0?r.jsxs(W,{children:[r.jsx(X,{children:r.jsxs(ee,{children:[r.jsx(se,{children:"Date"}),r.jsx(se,{children:"Vehicle"}),r.jsx(se,{children:"Miles"}),r.jsx(se,{children:"Type"}),r.jsx(se,{children:"Status"})]})}),r.jsx(re,{children:je.slice(0,5).map(e=>r.jsxs(ee,{children:[r.jsx(ae,{children:new Date(e.trip_date||"").toLocaleDateString()}),r.jsx(ae,{children:e.vehicle_id||"N/A"}),r.jsx(ae,{children:e.miles_total?.toFixed(1)||0}),r.jsx(ae,{children:e.usage_type?Te(e.usage_type):"N/A"}),r.jsx(ae,{children:e.approval_status?we(e.approval_status):"N/A"})]},e.id))})]}):r.jsx(le,{message:"No recent trips recorded"})})]}),r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsxs(k,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Recent Charges"}),r.jsx(f,{variant:"link",size:"sm",className:"p-0 h-auto",children:"View All"})]}),r.jsx(L,{children:"Personal use charges and fees"})]}),r.jsx(R,{children:ge.length>0?r.jsxs(W,{children:[r.jsx(X,{children:r.jsxs(ee,{children:[r.jsx(se,{children:"Date"}),r.jsx(se,{children:"Amount"}),r.jsx(se,{children:"Type"}),r.jsx(se,{children:"Status"})]})}),r.jsx(re,{children:ge.slice(0,5).map(e=>r.jsxs(ee,{children:[r.jsx(ae,{children:new Date(e.date||"").toLocaleDateString()}),r.jsxs(ae,{children:["$",(e.amount||0).toFixed(2)]}),r.jsx(ae,{children:e.type||"N/A"}),r.jsx(ae,{children:e.status||"N/A"})]},e.id))})]}):r.jsx(le,{message:"No charges recorded"})})]})]}),r.jsxs(U,{value:"trips",className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[r.jsx("div",{className:"w-48",children:r.jsxs(H,{value:w,onValueChange:e=>T(e),children:[r.jsx(Y,{children:r.jsx(J,{placeholder:"Date Range"})}),r.jsxs(G,{children:[r.jsx(Z,{value:"30days",children:"Last 30 Days"}),r.jsx(Z,{value:"90days",children:"Last 90 Days"}),r.jsx(Z,{value:"year",children:"This Year"})]})]})}),r.jsx("div",{className:"w-48",children:r.jsxs(H,{value:A,onValueChange:C,children:[r.jsx(Y,{children:r.jsx(J,{placeholder:"Usage Type"})}),r.jsxs(G,{children:[r.jsx(Z,{value:"all",children:"All Types"}),r.jsx(Z,{value:"business",children:"Business"}),r.jsx(Z,{value:"personal",children:"Personal"}),r.jsx(Z,{value:"mixed",children:"Mixed"})]})]})}),r.jsx("div",{className:"w-48",children:r.jsxs(H,{value:V,onValueChange:K,children:[r.jsx(Y,{children:r.jsx(J,{placeholder:"Status"})}),r.jsxs(G,{children:[r.jsx(Z,{value:"all",children:"All Statuses"}),r.jsx(Z,{value:"pending",children:"Pending"}),r.jsx(Z,{value:"approved",children:"Approved"}),r.jsx(Z,{value:"rejected",children:"Rejected"})]})]})})]}),r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsx(k,{children:"Trip History"}),r.jsx(L,{children:"All recorded trips and classifications"})]}),r.jsx(R,{children:je.length>0?r.jsxs(W,{children:[r.jsx(X,{children:r.jsxs(ee,{children:[r.jsx(se,{children:"Date"}),r.jsx(se,{children:"Vehicle"}),r.jsx(se,{children:"Miles"}),r.jsx(se,{children:"Type"}),r.jsx(se,{children:"Status"}),r.jsx(se,{children:"Purpose"})]})}),r.jsx(re,{children:je.map(e=>r.jsxs(ee,{children:[r.jsx(ae,{children:new Date(e.trip_date||"").toLocaleDateString()}),r.jsx(ae,{children:e.vehicle_id||"N/A"}),r.jsx(ae,{children:e.miles_total?.toFixed(1)||0}),r.jsx(ae,{children:e.usage_type?Te(e.usage_type):"N/A"}),r.jsx(ae,{children:e.approval_status?we(e.approval_status):"N/A"}),r.jsx(ae,{children:e.business_purpose||"N/A"})]},e.id))})]}):r.jsx(le,{message:"No trips recorded for the selected filters"})})]})]}),r.jsx(U,{value:"charges",className:"space-y-6",children:r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsx(k,{children:"Personal Use Charges"}),r.jsx(L,{children:"Charges and fees for personal vehicle usage"})]}),r.jsx(R,{children:ge.length>0?r.jsxs(W,{children:[r.jsx(X,{children:r.jsxs(ee,{children:[r.jsx(se,{children:"Date"}),r.jsx(se,{children:"Amount"}),r.jsx(se,{children:"Type"}),r.jsx(se,{children:"Status"}),r.jsx(se,{children:"Description"})]})}),r.jsx(re,{children:ge.map(e=>r.jsxs(ee,{children:[r.jsx(ae,{children:new Date(e.date||"").toLocaleDateString()}),r.jsxs(ae,{children:["$",(e.amount||0).toFixed(2)]}),r.jsx(ae,{children:e.type||"N/A"}),r.jsx(ae,{children:e.status||"N/A"}),r.jsx(ae,{children:e.description||"N/A"})]},e.id))})]}):r.jsx(le,{message:"No charges recorded"})})]})})]}),"driver"!==_&&r.jsxs(r.Fragment,{children:[r.jsx(U,{value:"approvals",className:"space-y-6",children:r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsx(k,{children:"Pending Approvals"}),r.jsx(L,{children:"Trip classifications awaiting review"})]}),r.jsx(R,{children:ve.length>0?r.jsxs(W,{children:[r.jsx(X,{children:r.jsxs(ee,{children:[r.jsx(se,{children:"Date"}),r.jsx(se,{children:"Driver"}),r.jsx(se,{children:"Vehicle"}),r.jsx(se,{children:"Miles"}),r.jsx(se,{children:"Type"}),r.jsx(se,{children:"Status"}),r.jsx(se,{children:"Actions"})]})}),r.jsx(re,{children:ve.map(e=>r.jsxs(ee,{children:[r.jsx(ae,{children:new Date(e.trip_date||"").toLocaleDateString()}),r.jsx(ae,{children:e.driver_name||"N/A"}),r.jsx(ae,{children:e.vehicle_name||e.vehicle_id||"N/A"}),r.jsx(ae,{children:e.miles_total?.toFixed(1)||0}),r.jsx(ae,{children:e.usage_type?Te(e.usage_type):"N/A"}),r.jsx(ae,{children:e.approval_status?we(e.approval_status):"N/A"}),r.jsx(ae,{children:"pending"===e.approval_status&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx(f,{size:"sm",variant:"outline",onClick:()=>{fe(e.id||"")},children:"Approve"}),r.jsx(f,{size:"sm",variant:"destructive",onClick:()=>(e=>{const s=prompt("Enter rejection reason:");s&&be({tripId:e,reason:s})})(e.id||""),children:"Reject"})]})})]},e.id))})]}):r.jsx(le,{message:"No trips pending approval"})})]})}),r.jsxs(U,{value:"team",className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[r.jsxs(O,{children:[r.jsx(E,{className:"pb-2",children:r.jsx(k,{className:"text-sm font-medium",children:"Team Members"})}),r.jsx(R,{children:r.jsx("div",{className:"text-2xl font-bold",children:_e?.total_members||0})})]}),r.jsxs(O,{children:[r.jsx(E,{className:"pb-2",children:r.jsx(k,{className:"text-sm font-medium",children:"Pending Approvals"})}),r.jsx(R,{children:r.jsx("div",{className:"text-2xl font-bold",children:_e?.pending_approvals||0})})]}),r.jsxs(O,{children:[r.jsx(E,{className:"pb-2",children:r.jsx(k,{className:"text-sm font-medium",children:"Drivers Near Limit"})}),r.jsx(R,{children:r.jsx("div",{className:"text-2xl font-bold",children:_e?.drivers_near_limit||0})})]}),r.jsxs(O,{children:[r.jsx(E,{className:"pb-2",children:r.jsx(k,{className:"text-sm font-medium",children:"Charges This Month"})}),r.jsx(R,{children:r.jsxs("div",{className:"text-2xl font-bold",children:["$",(_e?.total_charges_this_month||0).toFixed(2)]})})]})]}),r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsx(k,{children:"Team Trip History"}),r.jsx(L,{children:"Recent trips across all team members"})]}),r.jsx(R,{children:r.jsx(le,{message:"Team trip history will be displayed here"})})]})]}),r.jsx(U,{value:"violations",className:"space-y-6",children:r.jsxs(O,{children:[r.jsxs(E,{children:[r.jsx(k,{children:"Policy Violations"}),r.jsx(L,{children:"Drivers exceeding personal use limits or with unapproved trips"})]}),r.jsx(R,{children:r.jsx(le,{message:"Policy violations will be displayed here"})})]})})]})]})]})};export{oe as PersonalUseDashboard};
