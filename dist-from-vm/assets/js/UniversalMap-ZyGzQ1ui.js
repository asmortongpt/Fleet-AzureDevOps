function e(e){const t=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]'].join(", ");return Array.from(e.querySelectorAll(t)).filter(e=>e.offsetWidth>0&&e.offsetHeight>0&&"hidden"!==window.getComputedStyle(e).visibility&&!e.hasAttribute("inert"))}function t(e){const t=e.toLowerCase().split("+"),r=t[t.length-1];return{ctrl:t.includes("ctrl")||t.includes("control"),alt:t.includes("alt"),shift:t.includes("shift"),meta:t.includes("meta")||t.includes("cmd")||t.includes("command"),key:r}}function r(e,t){return e.key.toLowerCase()===t.key&&e.ctrlKey===t.ctrl&&e.altKey===t.alt&&e.shiftKey===t.shift&&e.metaKey===t.meta}function n(e,t={}){const{enabled:r=!0,detectMemoryLeaks:n=!0,memoryLeakCallback:o,slowRenderThreshold:a=50}=t,[s,i]=m.useState({renderCount:0,avgRenderTime:0,maxRenderTime:0,customMetrics:[],warnings:[]}),c=m.useRef([]),l=m.useRef([]),u=m.useRef([]),d=m.useRef([]),p=m.useCallback(e=>r&&"undefined"!=typeof performance&&"function"==typeof performance.now?performance.now():Date.now(),[r]),h=m.useCallback((e,t,n)=>{if(!r)return;const o="undefined"!=typeof performance&&"function"==typeof performance.now?performance.now():Date.now();f(e,o-t,n)},[r]),f=m.useCallback((e,t,n)=>{if(!r)return;const o="number"!=typeof t||isNaN(t)?0:t;l.current.push({name:e,duration:o,timestamp:Date.now()}),l.current.length>100&&(l.current=l.current.slice(-100)),o>a&&(u.current.push({message:`Slow operation detected: ${e} took ${o.toFixed(2)}ms`,severity:o>2*a?"high":"medium"}),u.current.length>10&&(u.current=u.current.slice(-10))),i(e=>({...e,customMetrics:[...l.current],warnings:[...u.current]}))},[r,a]);return m.useEffect(()=>{if(!r)return;const e=performance.now();return()=>{const t=performance.now()-e;c.current.push(t),c.current.length>100&&(c.current=c.current.slice(-100));const r=c.current.length,n=c.current.reduce((e,t)=>e+t,0)/r,o=Math.max(...c.current);i(e=>({...e,renderCount:r,avgRenderTime:n,maxRenderTime:o}))}}),m.useEffect(()=>{if(!r||!n)return;let e=null;try{e=new g(e=>{d.current.push(e.memoryIncrease),d.current.length>10&&(d.current=d.current.slice(-10));const t=d.current[d.current.length-1];let r="stable";if(d.current.length>=3){const e=d.current.slice(-3);e[2]>e[1]&&e[1]>e[0]?r="increasing":e[1]>e[2]&&e[0]>e[1]&&(r="decreasing")}i(e=>({...e,latestMemoryUsage:t,memoryTrend:r})),"function"==typeof o&&o(e),e.detected&&(u.current.push({message:`Memory leak detected: +${e.memoryIncrease.toFixed(1)}MB`,severity:"high"}),i(e=>({...e,warnings:[...u.current]})))}),e.start()}catch(t){}return()=>{e&&e.stop()}},[r,n,o]),{startMetric:p,endMetric:h,recordMetric:f,metrics:s}}function o({vehicles:o=[],facilities:a=[],cameras:s=[],showVehicles:i=!0,showFacilities:c=!0,showCameras:l=!1,mapStyle:u="osm",center:d=w,zoom:h=b,className:f="",enableClustering:g=!1,autoFitBounds:x=!0,minHeight:k=500,maxFitBoundsZoom:S=v,enableAnnouncements:E=!0,ariaLabel:M="Interactive fleet management map"}){(function(n={}){const{enableAnnouncements:o=!0,enableKeyboardShortcuts:a=!0,enableFocusManagement:s=!0,announcementDebounce:i=500,shortcuts:c=[],announceMarkerChanges:l=!0,announceZoomChanges:u=!1,announceCenterChanges:d=!1}=n,[p,h]=m.useState(!1),[f,g]=m.useState(c),y=m.useRef(null),w=m.useRef(null),b=m.useRef(""),v=m.useRef(null);m.useEffect(()=>{h(function(){if("undefined"==typeof window)return!1;const e=window.navigator.userAgent.toLowerCase();return!!["nvda","jaws","voiceover","talkback","narrator"].some(t=>e.includes(t))||!!window.matchMedia("(prefers-reduced-motion: reduce)").matches}());const e=t=>{"Tab"===t.key&&(h(!0),window.removeEventListener("keydown",e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),m.useEffect(()=>{if(o&&"undefined"!=typeof window)return y.current=function(e,t="polite"){if("undefined"==typeof document)return{update:()=>{},cleanup:()=>{}};let r=document.getElementById(e);return r||(r=document.createElement("div"),r.id=e,r.setAttribute("role","assertive"===t?"alert":"status"),r.setAttribute("aria-live",t),r.setAttribute("aria-atomic","true"),r.style.cssText="\n      position: absolute;\n      left: -10000px;\n      width: 1px;\n      height: 1px;\n      overflow: hidden;\n    ",document.body.appendChild(r)),{update:e=>{r&&(r.textContent=e)},cleanup:()=>{r&&r.parentNode&&r.parentNode.removeChild(r)}}}("map-accessibility-live-region","polite"),()=>{y.current?.cleanup(),y.current=null}},[o]),m.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const x=m.useCallback((e,t="polite")=>{o&&e&&e!==b.current&&(w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{b.current=e,y.current?y.current.update(e):function(e,t="polite",r=1e3){if(!e||"undefined"==typeof document)return;const n=document.createElement("div");n.setAttribute("role","assertive"===t?"alert":"status"),n.setAttribute("aria-live",t),n.setAttribute("aria-atomic","true"),n.style.cssText="\n    position: absolute;\n    left: -10000px;\n    width: 1px;\n    height: 1px;\n    overflow: hidden;\n  ",document.body.appendChild(n),setTimeout(()=>{n.textContent=e},100),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},r+100)}(e,t)},i))},[o,i]);m.useCallback(e=>{const{type:t,message:r,priority:n="polite"}=e;("markers_updated"!==t||l)&&("zoom_changed"!==t||u)&&("center_changed"!==t||d)&&x(r,"error"===t?"assertive":n)},[x,l,u,d]),m.useCallback((e,t=!0)=>{s&&e&&function(e,t={}){if(!e)return;const{preventScroll:r=!1,smooth:n=!0}=t;0>e.tabIndex&&(e.tabIndex=-1),e.focus({preventScroll:r}),!r&&n&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}(e,{smooth:t})},[s]),m.useCallback((t,r)=>s?function(t,r={}){const{initialFocus:n,onEscape:o,returnFocusOnDeactivate:a=!0,allowOutsideClick:s=!1}=r;let i=null,c=!1;const l=r=>{if(c){if("Escape"===r.key&&o)return r.preventDefault(),void o();if("Tab"===r.key){const n=e(t);if(0===n.length)return void r.preventDefault();const o=n[0],a=n[n.length-1];r.shiftKey?document.activeElement===o&&(r.preventDefault(),a.focus()):document.activeElement===a&&(r.preventDefault(),o.focus())}}},u=e=>{c&&!s&&(t.contains(e.target)||(e.preventDefault(),e.stopPropagation()))};return{activate:()=>{if(c)return;i=document.activeElement,c=!0,document.addEventListener("keydown",l),document.addEventListener("click",u,!0);const r=e(t),o=n||r[0];o&&setTimeout(()=>o.focus(),0)},deactivate:()=>{c&&(c=!1,document.removeEventListener("keydown",l),document.removeEventListener("click",u,!0),a&&i&&setTimeout(()=>i?.focus(),0))},update:()=>{if(c){const r=e(t);r.length>0&&!r.includes(document.activeElement)&&r[0].focus()}}}}(t,r):{activate:()=>{},deactivate:()=>{},update:()=>{}},[s]),m.useCallback(e=>{g(t=>[...t.filter(t=>t.key!==e.key),e])},[]),m.useCallback(e=>{g(t=>t.filter(t=>t.key!==e))},[]),m.useCallback(()=>[...f],[f]);m.useEffect(()=>{if(!a||0===f.length)return;const e=e=>{for(const n of f)if(r(e,t(n.key))){!1!==n.preventDefault&&e.preventDefault(),n.handler();break}};return window.addEventListener("keydown",e),v.current=e,()=>{v.current&&window.removeEventListener("keydown",v.current)}},[a,f])})({enableAnnouncements:E,announceMarkerChanges:!0}),n(0,{enabled:"undefined"!=typeof window&&!1});const[C,R]=m.useState(!1),[L,N]=m.useState(!0),[T,j]=m.useState(null),[I,A]=m.useState(!1),z=m.useRef(null);m.useRef(null),m.useRef(null),m.useRef(null),m.useRef(null),m.useRef(null),m.useRef(null);const D=m.useRef(!0);return m.useMemo(()=>y[u],[u]),m.useEffect(()=>(D.current=!0,()=>{D.current=!1}),[]),function(e,t){const r=m.useRef(!1),n=m.useRef();m.useEffect(()=>(r.current=!0,n.current=void 0,()=>{r.current=!1,"function"==typeof n.current&&n.current()}),t)}(0,[I]),p.jsxs("div",{ref:z,className:`leaflet-map-container ${f}`,style:{minHeight:`${k}px`},role:"region","aria-label":M,children:[L&&p.jsx("div",{className:"loading",children:"Loading map..."}),T&&p.jsx("div",{className:"error",children:T})]})}function a({componentName:e="Application",position:t="bottom-right",defaultExpanded:r=!1,showFPS:n=!0,showMemory:o=!0,showWebVitals:a=!0,detectMemoryLeaks:s=!0}){return null}function s(){try{const e=void 0;return"string"==typeof e&&e.length>0}catch(e){return!1}}function i(e){return"leaflet"===e||"google"===e}function c(e){if(e&&i(e))return e;const t=s(),r=function(e,t=null){try{return"undefined"!=typeof window&&window.localStorage?localStorage.getItem(e)??t:t}catch(r){return t}}(S);return r&&i(r)&&("google"!==r||t)?r:t?"google":"leaflet"}function l(e){const{vehicles:t=[],facilities:r=[],cameras:s=[],showVehicles:i=!0,showFacilities:l=!0,showCameras:u=!0,showRoutes:d=!1,center:g=x,zoom:y=k,className:w="",onMapReady:b,onMapError:v,forceProvider:S,enableClustering:C=!0,clusterThreshold:R=E,enablePerformanceMonitoring:L=!1,showPerformanceMonitor:N=!1}=e,[T,j]=m.useState(()=>c(S)),[I,A]=m.useState("idle"),[z,D]=m.useState(!1),F=n(0,{enabled:L,slowRenderThreshold:50}),_=m.useRef(!0),G=m.useRef(null),P=m.useRef(null),O=m.useMemo(()=>{if(function(e){if(!Array.isArray(e)||2!==e.length)return!1;const[t,r]=e;return!("number"!=typeof t||"number"!=typeof r||isNaN(t)||isNaN(r)||-90>t||t>90||-180>r||r>180)}(g))return g;const e=function(e=[],t=[],r=[]){const n=[];if(e.forEach(e=>{!e.location?.lat||!e.location?.lng||-90>e.location.lat||e.location.lat>90||-180>e.location.lng||e.location.lng>180||n.push([e.location.lat,e.location.lng])}),t.forEach(e=>{!e.location?.lat||!e.location?.lng||-90>e.location.lat||e.location.lat>90||-180>e.location.lng||e.location.lng>180||n.push([e.location.lat,e.location.lng])}),r.forEach(e=>{!e.latitude||!e.longitude||-90>e.latitude||e.latitude>90||-180>e.longitude||e.longitude>180||n.push([e.latitude,e.longitude])}),0===n.length)return x;const o=n.reduce((e,[t])=>e+t,0),a=n.reduce((e,[,t])=>e+t,0);return[o/n.length,a/n.length]}(t,r,s);return e},[g,t,r,s]),$=m.useMemo(()=>{const e="number"!=typeof y||isNaN(y)?k:y;return Math.max(1,Math.min(20,e))},[y]),U=m.useMemo(()=>{let e=0;return i&&(e+=t.length),l&&(e+=r.length),u&&(e+=s.length),e},[t.length,r.length,s.length,i,l,u]),B=m.useMemo(()=>C&&U>R,[C,U,R]),K=m.useCallback(e=>{f.error(`Map provider "${T}" encountered error:`,e),_.current&&(A("error"),v?.(e,T),"google"!==T||z||(D(!0),j("leaflet"),A("loading")))},[T,z,v]),V=m.useCallback(()=>{if(!_.current)return;const e=performance.now();F.recordMetric("timeToInteractive",e,{provider:T,markerCount:U,clustering:B}),A("ready"),b?.(T)},[T,b,F,U,B]),Z=m.useCallback(()=>{_.current&&(P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{const e=c(S);e!==T&&(j(e),A("loading"),D(!1))},100))},[T,S]);m.useEffect(()=>{_.current=!0;const e=F.startMetric("mapInit");return A("loading"),()=>{_.current=!1,P.current&&clearTimeout(P.current),G.current&&G.current(),F.recordMetric("componentLifetime",Date.now()-e)}},[]),m.useEffect(()=>{if(S)return;const e=()=>{window.removeEventListener("storage",Z)};return window.addEventListener("storage",Z),G.current=e,e},[Z,S]),m.useEffect(()=>{A("loading")},[T]);const H={vehicles:t,facilities:r,cameras:s,showVehicles:i,showFacilities:l,showCameras:u,showRoutes:d,center:O,zoom:$,className:w};return p.jsx(M,{onError:e=>K(e),children:p.jsxs("div",{className:"relative w-full h-full min-h-[500px]",children:["loading"===I&&p.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/80 dark:bg-gray-900/80",children:p.jsxs("div",{className:"flex flex-col items-center gap-3",children:[p.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),p.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Loading ","google"===T?"Google Maps":"OpenStreetMap","..."]})]})}),"google"===T?m.createElement(h,{...H,key:"google-map",onError:K,onReady:V}):m.createElement(o,{...H,key:"leaflet-map",onError:K,onReady:V}),B&&p.jsxs("div",{className:"absolute bottom-4 left-4 z-40 bg-white/90 dark:bg-gray-800/90 px-3 py-1.5 rounded-md shadow-md text-xs text-gray-600 dark:text-gray-300",children:["Clustering ",U," markers"]}),!1,N&&p.jsx(a,{componentName:`UniversalMap (${T})`,position:"bottom-right",defaultExpanded:!1,metrics:F.metrics,showFPS:!0,showMemory:!0,showWebVitals:!0,detectMemoryLeaks:!0})]})})}function u(){return c()}function d(e,t=!0){if(!i(e))return f.error(`Invalid map provider: ${e}`),!1;if("google"===e&&!s())return f.error("Cannot set Google Maps provider: API key not available"),!1;const r=function(e,t){try{return!("undefined"==typeof window||!window.localStorage||(localStorage.setItem(e,t),0))}catch(r){return!1}}(S,e);return r&&t&&"undefined"!=typeof window&&window.location.reload(),r}import{r as m,j as p}from"./react-core-hQu9tqS1.js";import{G as h}from"./GoogleMap-BAYip6gy.js";import{p as f}from"./index-BDwglPMF.js";class g{sampleRate;windowSize;memoryLeakThreshold;memorySnapshots=[];intervalId=null;callback;constructor(e,t={}){this.sampleRate=t.sampleRate??5e3,this.windowSize=t.windowSize??10,this.memoryLeakThreshold=t.memoryLeakThreshold??50,this.callback=e}start(){this.intervalId=setInterval(()=>{try{const e=function(){if("undefined"!=typeof performance&&"memory"in performance){const e=performance.memory;if(e&&"number"==typeof e.usedJSHeapSize)return e.usedJSHeapSize/1048576}return 0}();this.memorySnapshots.push(e),this.memorySnapshots.length>this.windowSize&&this.memorySnapshots.shift(),this.detectLeak()}catch(e){f.error("Error during memory sampling:",e)}},this.sampleRate)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.memorySnapshots=[]}detectLeak(){if(this.windowSize>this.memorySnapshots.length)return;const e=this.memorySnapshots[this.memorySnapshots.length-1]-this.memorySnapshots[0];e>this.memoryLeakThreshold&&this.callback({detected:!0,memoryIncrease:e,increase:e,threshold:this.memoryLeakThreshold,timestamp:new Date})}}const y={osm:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer">OpenStreetMap</a> contributors',maxZoom:19,subdomains:["a","b","c"]},dark:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions" target="_blank" rel="noopener noreferrer">CARTO</a>',maxZoom:19,subdomains:["a","b","c","d"]},topo:{url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org" target="_blank" rel="noopener noreferrer">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org" target="_blank" rel="noopener noreferrer">OpenTopoMap</a>',maxZoom:17,subdomains:["a","b","c"]},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:19}},w=[30.4383,-84.2807],b=12,v=15,x=[30.4383,-84.2807],k=13,S="fleet_map_provider",E=100;class M extends m.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){f.error("Map Error Boundary caught an error:",e,t),this.setState({errorInfo:t}),this.props.onError?.(e,t)}render(){return this.state.hasError?p.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full bg-gray-50 dark:bg-gray-900 p-6",children:p.jsxs("div",{className:"max-w-md text-center",children:[p.jsx("div",{className:"mb-4 text-red-500",children:p.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Map Failed to Load"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:this.state.error?.message||"An unexpected error occurred while loading the map."}),p.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Reload Page"})]})}):this.props.children}}export{l as U,u as g,d as s};
