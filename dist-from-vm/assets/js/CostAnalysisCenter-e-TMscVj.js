function e(){const{canViewFinancial:e,isAdmin:B}=k(),[F,O]=s.useState(null),[E,R]=s.useState([]),[U,I]=s.useState([]),[T,P]=s.useState(!0),[M,z]=s.useState("overview"),[V,Y]=s.useState({startDate:new Date((new Date).getFullYear(),(new Date).getMonth(),1),endDate:new Date});if(!e&&!B)return t.jsx("div",{className:"p-6",children:t.jsx(x,{children:t.jsxs(h,{children:[t.jsx(j,{children:"Access Restricted"}),t.jsx(m,{children:"You do not have permission to view cost analysis data."})]})})});s.useEffect(()=>{q()},[V]);const q=async()=>{P(!0);try{const e=await g.get(`/cost-analysis/summary?startDate=${V.startDate.toISOString()}&endDate=${V.endDate.toISOString()}`);O(e??null);const s=await g.get("/cost-analysis/budget-status");R(s??[]);const t=await g.get("/cost-analysis/forecast?months=3");I(t??[])}catch(e){u.error("Error fetching cost data:",e),o.error("Failed to load cost analysis data")}finally{P(!1)}},G=e=>"increasing"===e?t.jsx(c,{className:"h-4 w-4 text-red-500",weight:"bold"}):t.jsx(d,"decreasing"===e?{className:"h-4 w-4 text-green-500",weight:"bold"}:{className:"h-4 w-4 text-gray-500",weight:"bold"}),K=e=>({Fuel:"bg-blue-500",Maintenance:"bg-orange-500",Insurance:"bg-purple-500",Depreciation:"bg-gray-500",Driver:"bg-green-500",Administrative:"bg-yellow-500"}[e]||"bg-gray-400");return T?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading cost analysis..."})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[t.jsx(a,{className:"h-8 w-8 text-green-600",weight:"fill"}),"Cost Analysis Command Center"]}),t.jsx("p",{className:"text-gray-600 mt-2",children:"Real-time cost tracking, forecasting, and anomaly detection"})]}),(B||e)&&t.jsxs(p,{onClick:async()=>{try{const e=await fetch(`/api/cost-analysis/export?startDate=${V.startDate.toISOString()}&endDate=${V.endDate.toISOString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Export failed");const s=await e.blob(),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`cost-analysis-${V.startDate.toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a),o.success("Cost data exported successfully")}catch(e){u.error("Error exporting data:",e),o.error("Failed to export data")}},className:"flex items-center gap-2",children:[t.jsx(r,{className:"h-4 w-4",weight:"bold"}),"Export to Excel"]})]}),F&&t.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[t.jsxs(x,{children:[t.jsx(h,{className:"pb-3",children:t.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(a,{className:"h-4 w-4",weight:"fill"}),"Total Costs"]})}),t.jsxs(f,{children:[t.jsxs("div",{className:"text-2xl font-bold",children:["$",F.totalCost.toLocaleString()]}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Current period"})]})]}),t.jsxs(x,{children:[t.jsx(h,{className:"pb-3",children:t.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(i,{className:"h-4 w-4",weight:"fill"}),"Categories"]})}),t.jsxs(f,{children:[t.jsx("div",{className:"text-2xl font-bold",children:F.categoryBreakdown.length}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Active cost categories"})]})]}),t.jsxs(x,{children:[t.jsx(h,{className:"pb-3",children:t.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(n,{className:"h-4 w-4 text-red-600",weight:"fill"}),"Anomalies"]})}),t.jsxs(f,{children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:F.anomalies.length}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Unusual spending detected"})]})]}),t.jsxs(x,{children:[t.jsx(h,{className:"pb-3",children:t.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(l,{className:"h-4 w-4",weight:"fill"}),"Budget Status"]})}),t.jsxs(f,{children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[E.filter(e=>!e.isOverBudget).length,"/",E.length]}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"On track"})]})]})]}),t.jsxs(y,{value:M,onValueChange:z,children:[t.jsxs(v,{children:[t.jsx(N,{value:"overview",children:"Overview"}),t.jsx(N,{value:"breakdown",children:"Category Breakdown"}),t.jsx(N,{value:"budget",children:"Budget Tracking"}),t.jsx(N,{value:"forecast",children:"Forecast"}),t.jsx(N,{value:"anomalies",children:"Anomalies"})]}),t.jsx(b,{value:"overview",className:"space-y-6",children:F&&t.jsxs(t.Fragment,{children:[t.jsxs(x,{children:[t.jsxs(h,{children:[t.jsx(j,{children:"Cost Distribution"}),t.jsx(m,{children:"Breakdown by category"})]}),t.jsx(f,{children:t.jsx("div",{className:"space-y-4",children:F.categoryBreakdown.map(e=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${K(e.category)}`}),t.jsx("span",{className:"font-medium",children:e.category}),G(e.trend)]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-bold",children:["$",e.amount.toLocaleString()]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[e.percentage.toFixed(1),"%"]})]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full ${K(e.category)}`,style:{width:`${e.percentage}%`}})})]},e.category))})})]}),t.jsxs(x,{children:[t.jsxs(h,{children:[t.jsx(j,{children:"Top Expenses"}),t.jsx(m,{children:"Largest individual costs this period"})]}),t.jsx(f,{children:t.jsxs(S,{children:[t.jsx(C,{children:t.jsxs(D,{children:[t.jsx($,{children:"Description"}),t.jsx($,{children:"Category"}),t.jsx($,{children:"Date"}),t.jsx($,{className:"text-right",children:"Amount"})]})}),t.jsx(L,{children:F.topExpenses.map((e,s)=>t.jsxs(D,{children:[t.jsx(A,{className:"font-medium",children:e.description}),t.jsx(A,{children:t.jsx(w,{variant:"secondary",children:e.category})}),t.jsx(A,{children:new Date(e.date).toLocaleDateString()}),t.jsxs(A,{className:"text-right font-bold",children:["$",e.amount.toLocaleString()]})]},s))})]})})]})]})}),t.jsx(b,{value:"breakdown",className:"space-y-6",children:F&&t.jsxs(x,{children:[t.jsxs(h,{children:[t.jsx(j,{children:"Detailed Category Analysis"}),t.jsx(m,{children:"Cost trends and forecasts by category"})]}),t.jsx(f,{children:t.jsxs(S,{children:[t.jsx(C,{children:t.jsxs(D,{children:[t.jsx($,{children:"Category"}),t.jsx($,{children:"Current Spend"}),t.jsx($,{children:"Percentage"}),t.jsx($,{children:"Trend"}),t.jsx($,{children:"Forecasted"}),t.jsx($,{children:"Change"})]})}),t.jsx(L,{children:F.categoryBreakdown.map(e=>{const s=e.forecastedAmount-e.amount,a=s/e.amount*100;return t.jsxs(D,{children:[t.jsx(A,{className:"font-medium",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${K(e.category)}`}),e.category]})}),t.jsxs(A,{className:"font-bold",children:["$",e.amount.toLocaleString()]}),t.jsxs(A,{children:[e.percentage.toFixed(1),"%"]}),t.jsx(A,{children:G(e.trend)}),t.jsxs(A,{children:["$",e.forecastedAmount.toLocaleString()]}),t.jsx(A,{children:t.jsxs("span",{className:s>0?"text-red-600":"text-green-600",children:[s>0?"+":"","$",s.toLocaleString()," ","(",a>0?"+":"",a.toFixed(1),"%)"]})})]},e.category)})})]})})]})}),t.jsx(b,{value:"budget",className:"space-y-6",children:t.jsxs(x,{children:[t.jsxs(h,{children:[t.jsx(j,{children:"Budget Tracking"}),t.jsx(m,{children:"Current budget status by category"})]}),t.jsx(f,{children:t.jsxs(S,{children:[t.jsx(C,{children:t.jsxs(D,{children:[t.jsx($,{children:"Category"}),t.jsx($,{children:"Allocated"}),t.jsx($,{children:"Spent"}),t.jsx($,{children:"Remaining"}),t.jsx($,{children:"Usage"}),t.jsx($,{children:"Forecasted"})]})}),t.jsx(L,{children:E.map(e=>t.jsxs(D,{children:[t.jsx(A,{className:"font-medium",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${K(e.category)}`}),e.category]})}),t.jsxs(A,{children:["$",e.allocated.toLocaleString()]}),t.jsxs(A,{className:e.isOverBudget?"text-red-600 font-bold":"",children:["$",e.spent.toLocaleString()]}),t.jsxs(A,{className:0>e.remaining?"text-red-600":"text-green-600",children:["$",e.remaining.toLocaleString()]}),t.jsxs(A,{children:[t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full "+(e.isOverBudget?"bg-red-500":"bg-blue-500"),style:{width:`${Math.min(e.percentageUsed,100)}%`}})}),t.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.percentageUsed.toFixed(1),"%"]})]}),t.jsxs(A,{children:["$",e.forecastedSpend.toLocaleString()]})]},e.category))})]})})]})}),t.jsx(b,{value:"forecast",className:"space-y-6",children:t.jsxs(x,{children:[t.jsxs(h,{children:[t.jsx(j,{children:"Cost Forecast"}),t.jsx(m,{children:"Predicted costs for upcoming periods"})]}),t.jsx(f,{children:t.jsxs(S,{children:[t.jsx(C,{children:t.jsxs(D,{children:[t.jsx($,{children:"Period"}),t.jsx($,{children:"Predicted Amount"}),t.jsx($,{children:"Range"}),t.jsx($,{children:"Confidence"})]})}),t.jsx(L,{children:U.map((e,s)=>t.jsxs(D,{children:[t.jsx(A,{className:"font-medium",children:e.period}),t.jsxs(A,{className:"font-bold",children:["$",e.predictedAmount.toLocaleString()]}),t.jsxs(A,{children:["$",e.lowerBound.toLocaleString()," - $",e.upperBound.toLocaleString()]}),t.jsxs(A,{children:[(100*e.confidence).toFixed(1),"%"]})]},s))})]})})]})}),t.jsx(b,{value:"anomalies",className:"space-y-6",children:F?.anomalies&&t.jsxs(x,{children:[t.jsxs(h,{children:[t.jsx(j,{children:"Cost Anomalies"}),t.jsx(m,{children:"Unusual spending patterns detected"})]}),t.jsx(f,{children:F.anomalies.length>0?t.jsxs(S,{children:[t.jsx(C,{children:t.jsxs(D,{children:[t.jsx($,{children:"Date"}),t.jsx($,{children:"Category"}),t.jsx($,{children:"Amount"}),t.jsx($,{children:"Reason"})]})}),t.jsx(L,{children:F.anomalies.map(e=>t.jsxs(D,{children:[t.jsx(A,{children:new Date(e.date).toLocaleDateString()}),t.jsx(A,{children:t.jsx(w,{variant:"destructive",children:e.category})}),t.jsxs(A,{className:"font-bold text-red-600",children:["$",e.amount.toLocaleString()]}),t.jsx(A,{children:e.reason})]},e.id))})]}):t.jsx("div",{className:"text-center py-8 text-gray-500",children:"No anomalies detected for this period."})})]})})]})]})}import{r as s,j as t,aK as a,bj as r,bA as i,C as n,bB as l,b5 as c,bk as d}from"./react-core-hQu9tqS1.js";import{t as o}from"./index-savvei9t.js";import{C as x,d as h,e as j,i as m,o as g,p as u,h as p,f,T as y,a as v,b as N,c as b,B as w}from"./index-BDwglPMF.js";import{T as S,a as C,b as D,c as $,d as L,e as A}from"./table-_lE51wjz.js";import{u as k}from"./usePermissions-CvNvsKyo.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./query-vendor--Fe2N4Al.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";export{e as CostAnalysisCenter};
