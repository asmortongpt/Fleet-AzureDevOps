function e(){const e=u(),[G,J]=s.useState(""),[W,Y]=s.useState("all"),[H,Z]=s.useState(!1),[ee,se]=s.useState(null),[ae,te]=s.useState(!1),[le,de]=s.useState("list"),[re,ie]=s.useState(null),[ce,ne]=s.useState({categoryId:"",tags:"",description:"",isPublic:!1});s.useRef(null);const{data:oe=[],isLoading:me}=h({queryKey:["documents"],queryFn:async()=>(await L.get("/documents")).documents||[],gcTime:3e5}),{data:xe=[],isLoading:ue}=h({queryKey:["documents","categories"],queryFn:async()=>(await L.get("/documents/categories/all")).categories||[],gcTime:3e5}),{data:he,isLoading:je}=h({queryKey:["documents","stats"],queryFn:async()=>(await L.get("/documents/analytics/stats")).documents,gcTime:3e5}),pe=me||ue||je,ge=j({mutationFn:async()=>{if(!re)throw new Error("Please select a file");const e=new FormData;e.append("file",re),e.append("categoryId",ce.categoryId),e.append("tags",JSON.stringify(ce.tags.split(",").map(e=>e.trim()).filter(e=>e))),e.append("description",ce.description),e.append("isPublic",ce.isPublic.toString());const s=await fetch("undefined/documents/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:e});if(!s.ok)throw new Error("Upload failed");return s.json()},onSuccess:()=>{p.success("Document uploaded successfully"),Z(!1),ie(null),ne({categoryId:"",tags:"",description:"",isPublic:!1}),e.invalidateQueries({queryKey:["documents"]}),e.invalidateQueries({queryKey:["documents","stats"]})},onError:e=>{T.error("Error uploading document:",e),p.error("Failed to upload document")}}),fe=j({mutationFn:async e=>L.delete(`/documents/${e}`),onSuccess:()=>{p.success("Document deleted successfully"),e.invalidateQueries({queryKey:["documents"]}),e.invalidateQueries({queryKey:["documents","stats"]})},onError:e=>{T.error("Error deleting document:",e),p.error("Failed to delete document")}}),ye=e=>{p.info("Download started"),window.open(`undefined${e.file_url}`,"_blank")},Ne=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB"][s]},ve=oe.filter(e=>(e.file_name.toLowerCase().includes(G.toLowerCase())||e.description?.toLowerCase().includes(G.toLowerCase())||e.tags?.some(e=>e.toLowerCase().includes(G.toLowerCase())))&&("all"===W||e.category_id===W));return pe?a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsx("div",{className:"text-muted-foreground",children:"Loading documents..."})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Document Management"}),a.jsx("p",{className:"text-muted-foreground",children:"Manage fleet documents with AI-powered search"})]}),a.jsxs(g,{open:H,onOpenChange:Z,children:[a.jsx(f,{asChild:!0,children:a.jsxs(y,{children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),"Upload Document"]})}),a.jsxs(N,{className:"max-w-2xl",children:[a.jsxs(v,{children:[a.jsx(w,{children:"Upload Document"}),a.jsx(b,{children:"Upload a new document to your fleet library"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"File"}),a.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[a.jsx("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>ie(e.target.files?.[0]||null),accept:".pdf,.doc,.docx,.txt,.csv,.jpg,.jpeg,.png"}),a.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[a.jsx(l,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),a.jsxs("div",re?{children:[a.jsx("p",{className:"font-medium",children:re.name}),a.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(re.size)})]}:{children:[a.jsx("p",{className:"font-medium",children:"Click to upload or drag and drop"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"PDF, DOC, DOCX, TXT, CSV, or Images"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Category"}),a.jsxs(A,{value:ce.categoryId,onValueChange:e=>ne(s=>({...s,categoryId:e})),children:[a.jsx(U,{children:a.jsx(M,{placeholder:"Select category"})}),a.jsx(B,{children:xe.map(e=>a.jsx(K,{value:e.id,children:e.category_name},e.id))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Tags (comma-separated)"}),a.jsx(C,{placeholder:"maintenance, policy, 2024",value:ce.tags,onChange:e=>ne(s=>({...s,tags:e.target.value}))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Description"}),a.jsx(R,{placeholder:"Document description...",value:ce.description,onChange:e=>ne(s=>({...s,description:e.target.value})),rows:3})]})]}),a.jsxs(_,{children:[a.jsx(y,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),a.jsxs(y,{onClick:async()=>{await ge.mutateAsync()},children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"Upload"]})]})]})]})]}),he&&a.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[a.jsxs(S,{children:[a.jsx(D,{className:"pb-2",children:a.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Documents"})}),a.jsxs(F,{children:[a.jsx("div",{className:"text-2xl font-bold",children:he.total_documents}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[he.recent_uploads," uploaded this week"]})]})]}),a.jsxs(S,{children:[a.jsx(D,{className:"pb-2",children:a.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Size"})}),a.jsxs(F,{children:[a.jsx("div",{className:"text-2xl font-bold",children:Ne(he.total_size_bytes)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Storage used"})]})]}),a.jsxs(S,{children:[a.jsx(D,{className:"pb-2",children:a.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Categories"})}),a.jsxs(F,{children:[a.jsx("div",{className:"text-2xl font-bold",children:xe.length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Document types"})]})]}),a.jsxs(S,{children:[a.jsx(D,{className:"pb-2",children:a.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"AI Ready"})}),a.jsxs(F,{children:[a.jsx("div",{className:"text-2xl font-bold",children:oe.filter(e=>"completed"===e.embedding_status).length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Searchable with AI"})]})]})]}),a.jsx(S,{children:a.jsx(F,{className:"pt-6",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),a.jsx(C,{placeholder:"Search documents...",value:G,onChange:e=>J(e.target.value),className:"pl-10"})]})}),a.jsxs(A,{value:W,onValueChange:Y,children:[a.jsx(U,{className:"w-[200px]",children:a.jsx(M,{placeholder:"All Categories"})}),a.jsxs(B,{children:[a.jsx(K,{value:"all",children:"All Categories"}),xe.map(e=>a.jsxs(K,{value:e.id,children:[e.category_name," (",e.document_count||0,")"]},e.id))]})]})]})})}),a.jsxs(S,{children:[a.jsxs(D,{children:[a.jsxs(k,{children:["Documents (",ve.length,")"]}),a.jsx(z,{children:"Manage your document library"})]}),a.jsx(F,{children:a.jsxs(O,{children:[a.jsx(P,{children:a.jsxs(E,{children:[a.jsx(V,{children:"File Name"}),a.jsx(V,{children:"Category"}),a.jsx(V,{children:"Type"}),a.jsx(V,{children:"Size"}),a.jsx(V,{children:"Uploaded"}),a.jsx(V,{children:"Actions"})]})}),a.jsx(Q,{children:ve.length>0?ve.map(e=>{return a.jsxs(E,{children:[a.jsx($,{className:"font-medium",children:a.jsxs("div",{className:"flex items-center",children:[(s=e.file_type,s.includes("pdf")?a.jsx(n,{className:"w-8 h-8 text-red-500"}):s.includes("word")||s.includes("document")?a.jsx(o,{className:"w-8 h-8 text-blue-500"}):s.includes("image")?a.jsx(m,{className:"w-8 h-8 text-green-500"}):a.jsx(x,{className:"w-8 h-8 text-gray-500"})),a.jsx("span",{className:"ml-2",children:e.file_name})]})}),a.jsx($,{children:e.category_name?a.jsx(I,{style:{backgroundColor:e.category_color},children:e.category_name}):a.jsx("span",{className:"text-muted-foreground",children:"Uncategorized"})}),a.jsx($,{children:e.file_type}),a.jsx($,{children:Ne(e.file_size)}),a.jsxs($,{children:[X(new Date(e.created_at),{addSuffix:!0}),e.uploaded_by_name&&` by ${e.uploaded_by_name}`]}),a.jsx($,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y,{variant:"outline",size:"sm",onClick:()=>{se(e),te(!0)},children:a.jsx(r,{className:"w-4 h-4"})}),a.jsx(y,{variant:"outline",size:"sm",onClick:()=>ye(e),children:a.jsx(i,{className:"w-4 h-4"})}),a.jsx(y,{variant:"destructive",size:"sm",onClick:()=>(async e=>{confirm("Are you sure you want to delete this document?")&&fe.mutate(e)})(e.id),children:a.jsx(c,{className:"w-4 h-4"})})]})})]},e.id);var s}):a.jsx(E,{children:a.jsx($,{colSpan:6,className:"text-center text-muted-foreground",children:"No documents found"})})})]})})]}),a.jsx(g,{open:ae,onOpenChange:te,children:a.jsxs(N,{className:"max-w-3xl",children:[a.jsxs(v,{children:[a.jsx(w,{children:ee?.file_name}),a.jsx(b,{children:"Document details and metadata"})]}),ee&&a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"File Type"}),a.jsx("div",{className:"text-sm",children:ee.file_type})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"File Size"}),a.jsx("div",{className:"text-sm",children:Ne(ee.file_size)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Category"}),a.jsx("div",{className:"text-sm",children:ee.category_name||"Uncategorized"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Uploaded By"}),a.jsx("div",{className:"text-sm",children:ee.uploaded_by_name||ee.uploaded_by})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Uploaded At"}),a.jsx("div",{className:"text-sm",children:new Date(ee.created_at).toLocaleString()})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Version"}),a.jsxs("div",{className:"text-sm",children:["v",ee.version_number]})]})]}),ee.description&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Description"}),a.jsx("div",{className:"text-sm",children:ee.description})]}),ee.tags?.length&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"Tags"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:ee.tags.map(e=>a.jsx(I,{variant:"secondary",children:e},e))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(q,{children:"AI Processing Status"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium",children:"OCR Status"}),a.jsx("div",{className:"text-sm text-muted-foreground",children:ee.ocr_status})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium",children:"Embedding Status"}),a.jsx("div",{className:"text-sm text-muted-foreground",children:ee.embedding_status})]})]})]})]}),a.jsxs(_,{children:[a.jsx(y,{variant:"outline",onClick:()=>te(!1),children:"Close"}),ee&&a.jsxs(y,{onClick:()=>ye(ee),children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"Download"]})]})]})})]})}import{r as s,j as a,br as t,bu as l,b8 as d,ae as r,bj as i,cj as c,cV as n,cW as o,cX as m,cY as x}from"./react-core-hQu9tqS1.js";import{a as u,u as h,b as j}from"./query-vendor--Fe2N4Al.js";import{t as p}from"./index-savvei9t.js";import{D as g,t as f,h as y,j as N,k as v,l as w,m as b,I as C,n as _,C as S,d as D,e as k,f as F,i as z,B as I,p as T,o as L}from"./index-BDwglPMF.js";import{L as q}from"./label-C9sYRYKW.js";import{S as A,a as U,b as M,c as B,d as K}from"./select-Bmd3s7f4.js";import{T as O,a as P,b as E,c as V,d as Q,e as $}from"./table-_lE51wjz.js";import{T as R}from"./textarea-BOBjqKNu.js";import{f as X}from"./date-vendor-npJ7nI92.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./ui-menus--48tEbqQ.js";export{e as DocumentManagement};
