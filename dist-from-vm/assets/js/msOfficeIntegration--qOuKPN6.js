import{o as e,p as t}from"./index-BDwglPMF.js";const a=new class{async sendTeamsMessage(a,r,n,o,s,i){try{const t=await e.teams.sendMessage(a,r,{subject:n,content:o,contentType:"html",mentions:s,attachments:i?.map(e=>({name:e.name,contentType:e.type}))});return{id:t.id,channelId:r,channelName:"",subject:n,content:o,author:t.from?.user?.displayName||"You",timestamp:t.createdDateTime||(new Date).toISOString(),attachments:i?.map(e=>e.name),mentions:s||[],reactions:[]}}catch(c){throw t.error("Error sending Teams message:",{error:c}),c}}async sendEmail(a,r,n,o,s){try{const t=await e.outlook.sendEmail({message:{subject:r,body:{contentType:"HTML",content:n},toRecipients:a.map(e=>({emailAddress:{address:e}})),ccRecipients:o?.map(e=>({emailAddress:{address:e}}))}});return{id:t.id||`email-${Date.now()}`,subject:r,from:t.from?.emailAddress?.address||"fleet@company.com",to:a,cc:o||[],date:(new Date).toISOString(),body:n,attachments:s?.map(e=>({id:`att-${Date.now()}-${e.name}`,name:e.name,type:e.type,size:e.size}))||[],isRead:!1,hasReceipt:!1}}catch(i){throw t.error("Error sending email:",{error:i}),i}}async createOutlookCalendarEvent(a,r,n,o,s,i){try{return{id:(await e.calendar.createEvent({subject:a,start:{dateTime:r,timeZone:"UTC"},end:{dateTime:n,timeZone:"UTC"},location:{displayName:o},attendees:s.map(e=>({emailAddress:{address:e},type:"required"})),body:i?{contentType:"HTML",content:i}:void 0})).id,success:!0}}catch(c){throw t.error("Error creating calendar event:",{error:c}),c}}async scheduleMaintenanceWithVendor(e,t,a,r){const n=`Maintenance Request: ${a} - ${t}`,o=`\nDear Service Provider,\n\nWe would like to schedule ${a} for ${t}.\n\nPreferred Date: ${r}\n\nPlease confirm availability and provide:\n- Service appointment time\n- Estimated cost\n- Expected completion time\n\nBest regards,\nFleet Management Team\n    `.trim();return this.sendEmail([e],n,o)}async processReceiptFromEmail(a){try{await e.outlook.getMessage(a);const t=await e.ai.processReceipt(a);return{id:`receipt-${Date.now()}`,date:(new Date).toISOString(),vendor:t.merchantName||"Auto extracted from email",category:"maintenance",amount:parseFloat(t.total||"0"),taxAmount:0,paymentMethod:"corporate-card",status:"pending",submittedBy:"email-automation",ocrData:{merchantName:t.merchantName,date:void 0,total:t.total,items:void 0}}}catch(r){throw t.error("Error processing receipt:",{error:r}),r}}async extractReceiptData(a){try{const t=new FormData;t.append("image",a);const r=e.baseURL||"",n=e.token||"",o=await fetch(`${r}/api/ai/receipt/extract`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:t});if(!o.ok)throw new Error("Failed to extract receipt data");return await o.json()}catch(r){throw t.error("Error extracting receipt data:",{error:r}),r}}async createTeamsNotification(e,t,a,r,n,o){return this.sendTeamsMessage(e,t,a,`${{low:"â„¹ï¸",medium:"âš ï¸",high:"ðŸ”´",urgent:"ðŸš¨"}[n]} **${a}**\n\n${r}${o?`\n\n[View Details](${o})`:""}`)}async logCommunication(a,r,n,o,s){const i={id:`comm-${Date.now()}`,tenantId:"default-tenant",type:a,date:(new Date).toISOString(),participants:o,subject:r,summary:n,...s,followUpRequired:!1,createdBy:"system"};try{await e.post("/api/communication-logs",i)}catch(c){t.error("Error logging communication:",{error:c})}return i}async generateMaintenanceReport(a,r,n,o){try{const t=await e.post("/api/reports/maintenance",{vehicleIds:a,startDate:r,endDate:n,format:o});return{fileUrl:t.fileUrl,fileName:t.fileName}}catch(s){throw t.error("Error generating report:",{error:s}),s}}async shareToTeams(e,t,a,r){return this.sendTeamsMessage(e,t,`Fleet Report: ${r}`,`A new fleet report has been generated and is ready for review.\n\n[Download Report](${a})`)}async syncOutlookContacts(){try{return(await e.get("/api/outlook/contacts")).value||[]}catch(a){return t.error("Error syncing contacts:",{error:a}),[]}}async createExcelInventoryReport(e){const t=["Part Number,Name,Category,Quantity,Min Stock,Cost,Location",...e.map(e=>`${e.partNumber},"${e.name}",${e.category},${e.quantityOnHand},${e.minStockLevel},${e.unitCost},${e.location}`)].join("\n");return new Blob([t],{type:"text/csv"})}async getTeamsChannels(a){try{return(await e.teams.channels.list()).value||[]}catch(r){return t.error("Error getting Teams channels:",{error:r}),[]}}async getTeamsMessages(a,r){try{return(await e.teams.listMessages(a,r)).value||[]}catch(n){return t.error("Error getting Teams messages:",{error:n}),[]}}async getEmails(a){try{return(await e.outlook.listMessages(a)).value||[]}catch(r){return t.error("Error getting emails:",{error:r}),[]}}async replyToEmail(a,r){try{await e.outlook.replyToEmail(a,{comment:r,message:{body:{contentType:"HTML",content:r}}})}catch(n){throw t.error("Error replying to email:",{error:n}),n}}};export{a as m};
