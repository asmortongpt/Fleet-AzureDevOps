async function e(){return(await i.get("/api/v1/me/permissions")).data}function n(){const{data:n,isLoading:s,isError:c,error:d,refetch:o}=a({queryKey:["user-permissions"],queryFn:e,staleTime:3e5,gcTime:6e5,retry:2}),m=t.useMemo(()=>(e,a)=>{if(!n)return!1;if(n.roles.includes("Admin"))return!0;const r={"vehicle.create":["Admin","FleetManager"],"vehicle.update":["Admin","FleetManager"],"vehicle.delete":["Admin"],"vehicle.read":["Admin","FleetManager","MaintenanceManager","Inspector","Driver","Finance","Safety","Auditor","Vendor"],"garage.view":["Admin","FleetManager","MaintenanceManager","Inspector","Driver","Finance","Safety","Auditor","Vendor"],"garage.toggleValuePanel":["Admin","Finance","FleetManager"],"damage.edit":["Admin","FleetManager","Inspector"],"damage.addManual":["Admin","FleetManager","Inspector"],"damage.autoApprove":["Admin","FleetManager","Safety"],"scan.create":["Admin","FleetManager","MaintenanceManager","Inspector"],"scan.delete":["Admin"],"maint.addRecord":["Admin","MaintenanceManager"],"maint.editRecord":["Admin","MaintenanceManager"],"maint.closeWorkOrder":["Admin","MaintenanceManager","Vendor"],"crash.read":["Admin","FleetManager","Safety","Auditor"],"crash.create":["Admin","FleetManager","Safety"],"crash.edit":["Admin","Safety"],"value.read":["Admin","Finance","FleetManager"],"value.setPurchase":["Admin","Finance"],"value.overrideMarket":["Admin","Finance"],"reports.generate":["Admin","FleetManager","MaintenanceManager","Finance","Safety","Auditor"],"reports.export":["Admin","FleetManager","MaintenanceManager","Finance","Safety","Auditor"]}[e];return!!r&&n.roles.some(e=>r.includes(e))},[n]),l=t.useMemo(()=>e=>!!n&&n.visible_modules.includes(e),[n]),u=t.useMemo(()=>e=>!!n&&n.roles.includes(e),[n]),M=t.useMemo(()=>(...e)=>!!n&&n.roles.some(n=>e.includes(n)),[n]),A=t.useMemo(()=>n?.visible_modules||[],[n]),g=t.useMemo(()=>(e,a)=>{if(!n)return!1;if(n.roles.includes("Admin"))return!0;const r={vehicle:{purchase_price:["Admin","Finance"],current_value:["Admin","Finance"],depreciation_data:["Admin","Finance"],crash_history:["Admin","FleetManager","Safety","Auditor"],crash_claim_number:["Admin","Safety"],police_report:["Admin","Safety"]},garage_hud:{purchase_price:["Admin","Finance"],current_value:["Admin","Finance"],depreciation_chart:["Admin","Finance"],crash_details_panel:["Admin","FleetManager","Safety"],maintenance_costs:["Admin","Finance","MaintenanceManager"]},maintenance:{cost:["Admin","Finance","MaintenanceManager"],labor_hours:["Admin","MaintenanceManager"],labor_rate:["Admin","MaintenanceManager"]}}[e];if(!r)return!0;const i=r[a];return!i||n.roles.some(e=>i.includes(e))},[n]);return{permissions:n,isLoading:s,isError:c,error:d,refetch:o,can:m,hasModule:l,hasRole:u,hasAnyRole:M,canAccessField:g,visibleModules:A,checkPermissionServer:async e=>{try{const n=await async function(e){return(await i.post("/api/v1/permissions/check",e)).data}(e);return n.allowed}catch(n){return r.error("Permission check failed:",n),!1}},isAdmin:n?.roles.includes("Admin")||!1,isFleetManager:n?.roles.includes("FleetManager")||!1,isDriver:n?.roles.includes("Driver")||!1,isAuditor:n?.roles.includes("Auditor")||!1,canViewFinancial:n?.permissions.can_view_financial||!1,canManageMaintenance:n?.permissions.can_manage_maintenance||!1,canViewSafety:n?.permissions.can_view_safety_data||!1}}import{u as a}from"./query-vendor--Fe2N4Al.js";import{p as r,L as i}from"./index-BDwglPMF.js";import{r as t}from"./react-core-hQu9tqS1.js";export{n as u};
