function e(){const[e,L]=s.useState([]),[B,q]=s.useState(!1),[E,G]=s.useState(0),[W,K]=s.useState(!1),[X,Q]=s.useState(null),Y=s.useRef(null),[Z,_]=s.useState({category:"fuel",status:"pending",paymentMethod:"corporate-card"}),[ee,se]=s.useState(null),te=()=>{_({category:"fuel",status:"pending",paymentMethod:"corporate-card"}),se(null),G(0),Y.current&&(Y.current.value="")},ae=(e||[]).filter(e=>"pending"===e.status).reduce((e,s)=>e+s.amount,0),ne=(e||[]).filter(e=>"approved"===e.status).reduce((e,s)=>e+s.amount,0);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Receipt Processing"}),t.jsx("p",{className:"text-muted-foreground",children:"Automated OCR extraction and expense tracking"})]}),t.jsxs(m,{open:W,onOpenChange:K,children:[t.jsx(p,{asChild:!0,children:t.jsxs(u,{children:[t.jsx(a,{className:"w-4 h-4 mr-2"}),"Upload Receipt"]})}),t.jsxs(h,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(x,{children:[t.jsx(g,{children:"Process Receipt"}),t.jsx(j,{children:"Upload a receipt image for automatic OCR extraction"})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[t.jsx(v,{ref:Y,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(s)if(s.type.startsWith("image/")){q(!0),G(0);try{const e=setInterval(()=>{G(s=>90>s?s+10:(clearInterval(e),90))},200),t=URL.createObjectURL(s);await new Promise(e=>setTimeout(e,2e3));const a=await T.extractReceiptData(s),n=`${a?.merchantName||""} ${a?.total||""} ${a?.items?.map(e=>e.description).join(" ")||""}`,r=await H.analyzeReceipt(n);clearInterval(e),G(100),se({imageUrl:t,data:a,confidence:r.confidence}),_(e=>({...e,vendor:r.vendor,amount:r.amount,category:r.category,date:a?.date||(new Date).toISOString(),imageUrl:t})),l.success("Receipt processed successfully")}catch(t){l.error("Failed to process receipt")}finally{q(!1)}}else l.error("Please upload an image file")},className:"hidden",id:"receipt-upload"}),t.jsx(k,{htmlFor:"receipt-upload",className:"cursor-pointer",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:t.jsx(n,{className:"w-8 h-8 text-primary"})}),t.jsx("div",{className:"text-sm font-medium",children:B?"Processing...":"Click to upload receipt image"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"PNG, JPG, JPEG up to 10MB"})]})})]}),B&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(r,{className:"w-4 h-4 animate-pulse"}),t.jsx("span",{className:"text-sm",children:"Processing with OCR..."})]}),t.jsx(y,{value:E})]}),ee&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-medium",children:"Extracted Data"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[t.jsx("span",{className:"text-muted-foreground",children:"Confidence:"}),t.jsxs(f,{variant:"secondary",children:[Math.round(100*ee.confidence),"%"]})]}),t.jsxs("div",{className:"p-2 bg-muted rounded",children:[t.jsx("div",{className:"text-muted-foreground",children:"Merchant:"}),t.jsx("div",{className:"font-medium",children:ee.data?.merchantName})]}),t.jsxs("div",{className:"p-2 bg-muted rounded",children:[t.jsx("div",{className:"text-muted-foreground",children:"Total:"}),t.jsxs("div",{className:"font-medium",children:["$",ee.data?.total]})]}),ee.data?.items&&ee.data?.items.length>0&&t.jsxs("div",{className:"p-2 bg-muted rounded",children:[t.jsx("div",{className:"text-muted-foreground mb-1",children:"Items:"}),ee.data?.items.map((e,s)=>t.jsxs("div",{className:"text-xs flex justify-between",children:[t.jsx("span",{children:e.description}),t.jsxs("span",{children:["$",e.amount.toFixed(2)]})]},s))]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-medium",children:"Preview"}),t.jsx("img",{src:ee.imageUrl,alt:"Receipt preview",className:"w-full rounded border"})]})]}),ee&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(k,{htmlFor:"receipt-vendor",children:"Vendor *"}),t.jsx(v,{id:"receipt-vendor",value:Z.vendor,onChange:e=>_({...Z,vendor:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(k,{htmlFor:"receipt-amount",children:"Amount *"}),t.jsx(v,{id:"receipt-amount",type:"number",step:"0.01",value:Z.amount,onChange:e=>_({...Z,amount:parseFloat(e.target.value)})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(k,{htmlFor:"receipt-category",children:"Category"}),t.jsxs(R,{value:Z.category,onValueChange:e=>_({...Z,category:e}),children:[t.jsx(O,{id:"receipt-category",children:t.jsx(I,{})}),t.jsxs(M,{children:[t.jsx(D,{value:"fuel",children:"Fuel"}),t.jsx(D,{value:"maintenance",children:"Maintenance"}),t.jsx(D,{value:"parts",children:"Parts"}),t.jsx(D,{value:"service",children:"Service"}),t.jsx(D,{value:"toll",children:"Toll"}),t.jsx(D,{value:"parking",children:"Parking"}),t.jsx(D,{value:"other",children:"Other"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(k,{htmlFor:"receipt-payment",children:"Payment Method"}),t.jsxs(R,{value:Z.paymentMethod,onValueChange:e=>_({...Z,paymentMethod:e}),children:[t.jsx(O,{id:"receipt-payment",children:t.jsx(I,{})}),t.jsxs(M,{children:[t.jsx(D,{value:"corporate-card",children:"Corporate Card"}),t.jsx(D,{value:"cash",children:"Cash"}),t.jsx(D,{value:"check",children:"Check"}),t.jsx(D,{value:"reimbursement",children:"Employee Reimbursement"})]})]})]}),t.jsxs("div",{className:"space-y-2 col-span-2",children:[t.jsx(k,{htmlFor:"receipt-notes",children:"Notes"}),t.jsx(J,{id:"receipt-notes",value:Z.notes,onChange:e=>_({...Z,notes:e.target.value}),rows:2})]})]})]}),t.jsxs(N,{children:[t.jsx(u,{variant:"outline",onClick:()=>{K(!1),te()},children:"Cancel"}),t.jsx(u,{onClick:()=>{if(!Z.vendor||!Z.amount)return void l.error("Please fill in required fields");const e={id:`receipt-${Date.now()}`,date:Z.date||(new Date).toISOString(),vendor:Z.vendor,category:Z.category,amount:Z.amount,taxAmount:Z.taxAmount||0,paymentMethod:Z.paymentMethod||"corporate-card",status:"pending",submittedBy:"Current User",imageUrl:Z.imageUrl,ocrData:ee?.data,vehicleId:Z.vehicleId,driverId:Z.driverId,workOrderId:Z.workOrderId,notes:Z.notes};L(s=>[...s||[],e]),l.success("Receipt saved successfully"),K(!1),te()},disabled:!ee,children:"Save Receipt"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[t.jsxs(w,{children:[t.jsx(b,{className:"pb-3",children:t.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"Total Receipts"})}),t.jsxs(C,{children:[t.jsx("div",{className:"text-2xl font-bold",children:(e||[]).length}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[t.jsx(i,{className:"w-3 h-3"}),"All time"]})]})]}),t.jsxs(w,{children:[t.jsx(b,{className:"pb-3",children:t.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"Pending Approval"})}),t.jsxs(C,{children:[t.jsxs("div",{className:"text-2xl font-bold text-yellow-600",children:["$",ae.toLocaleString()]}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[t.jsx(c,{className:"w-3 h-3"}),(e||[]).filter(e=>"pending"===e.status).length," receipts"]})]})]}),t.jsxs(w,{children:[t.jsx(b,{className:"pb-3",children:t.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"Approved"})}),t.jsxs(C,{children:[t.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",ne.toLocaleString()]}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[t.jsx(o,{className:"w-3 h-3"}),(e||[]).filter(e=>"approved"===e.status).length," receipts"]})]})]}),t.jsxs(w,{children:[t.jsx(b,{className:"pb-3",children:t.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"OCR Accuracy"})}),t.jsxs(C,{children:[t.jsx("div",{className:"text-2xl font-bold",children:"94.5%"}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mt-1",children:[t.jsx(r,{className:"w-3 h-3"}),"High confidence"]})]})]})]}),t.jsxs(w,{children:[t.jsxs(b,{children:[t.jsxs(S,{children:["Receipts (",(e||[]).length,")"]}),t.jsx($,{children:"Submitted expenses awaiting approval"})]}),t.jsx(C,{children:t.jsxs(P,{children:[t.jsx(F,{children:t.jsxs(A,{children:[t.jsx(U,{children:"Date"}),t.jsx(U,{children:"Vendor"}),t.jsx(U,{children:"Category"}),t.jsx(U,{children:"Amount"}),t.jsx(U,{children:"Payment Method"}),t.jsx(U,{children:"Submitted By"}),t.jsx(U,{children:"Status"}),t.jsx(U,{children:"Actions"})]})}),t.jsx(z,{children:0===(e||[]).length?t.jsx(A,{children:t.jsx(V,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No receipts found. Upload your first receipt to get started."})}):(e||[]).map(e=>{return t.jsxs(A,{children:[t.jsx(V,{children:new Date(e.date).toLocaleDateString()}),t.jsx(V,{className:"font-medium",children:e.vendor}),t.jsx(V,{children:t.jsx(f,{className:(a=e.category,{fuel:"bg-orange-100 text-orange-700",maintenance:"bg-blue-100 text-blue-700",parts:"bg-purple-100 text-purple-700",service:"bg-green-100 text-green-700",toll:"bg-cyan-100 text-cyan-700",parking:"bg-pink-100 text-pink-700",other:"bg-gray-100 text-gray-700"}[a]),variant:"secondary",children:e.category})}),t.jsxs(V,{className:"font-semibold",children:["$",e.amount.toFixed(2)]}),t.jsx(V,{className:"text-sm text-muted-foreground",children:e.paymentMethod}),t.jsx(V,{children:e.submittedBy}),t.jsx(V,{children:t.jsx(f,{className:(s=e.status,{pending:"bg-yellow-100 text-yellow-700",approved:"bg-green-100 text-green-700",rejected:"bg-red-100 text-red-700",reimbursed:"bg-blue-100 text-blue-700"}[s]),variant:"secondary",children:e.status})}),t.jsxs(V,{children:["pending"===e.status&&t.jsxs("div",{className:"flex gap-1",children:[t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,L(e=>(e||[]).map(e=>e.id===s?{...e,status:"approved",approvedBy:"Fleet Manager"}:e)),void l.success("Receipt approved");var s},children:t.jsx(o,{className:"w-4 h-4 text-green-600"})}),t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,L(e=>(e||[]).map(e=>e.id===s?{...e,status:"rejected",approvedBy:"Fleet Manager"}:e)),void l.success("Receipt rejected");var s},children:t.jsx(d,{className:"w-4 h-4 text-red-600"})})]}),e.imageUrl&&t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Q(e),children:"View"})]})]},e.id);var s,a})})]})})]})]})}import{r as s,j as t,bu as a,cE as n,cF as r,aq as i,cD as c,ah as o,bs as d}from"./react-core-hQu9tqS1.js";import{t as l}from"./index-savvei9t.js";import{D as m,t as p,h as u,j as h,k as x,l as g,m as j,I as v,P as y,B as f,n as N,C as w,d as b,e as S,f as C,i as $}from"./index-BDwglPMF.js";import{L as k}from"./label-C9sYRYKW.js";import{S as R,a as O,b as I,c as M,d as D}from"./select-Bmd3s7f4.js";import{T as P,a as F,b as A,c as U,d as z,e as V}from"./table-_lE51wjz.js";import{T as J}from"./textarea-BOBjqKNu.js";import{m as T}from"./msOfficeIntegration--qOuKPN6.js";import"./lazy-modules-Bs19xeuI.js";import"./form-vendor-DKCvS-hL.js";import"./chart-vendor-DWRb53_H.js";import"./utils-vendor-Bojdf5C8.js";import"./mui-core-BKffG9O1.js";import"./react-router-cBrq_s0x.js";import"./query-vendor--Fe2N4Al.js";import"./three-helpers-DedzJcO9.js";import"./three-core-ZrcxJ5g9.js";import"./three-react-B1s7Iy2r.js";import"./ui-radix-C-X5Qx_8.js";import"./ui-dialogs-C2yTnBPV.js";import"./animation-vendor-Cf_i_fm0.js";import"./date-vendor-npJ7nI92.js";import"./ui-menus--48tEbqQ.js";const H=new class{conversationHistory=[];async sendMessage(e,s){const t={id:`msg-${Date.now()}-user`,type:"user",content:e,timestamp:(new Date).toISOString(),context:s};this.conversationHistory.push(t);const a=await this.generateResponse(e,s),n={id:`msg-${Date.now()}-assistant`,type:"assistant",content:a.content,timestamp:(new Date).toISOString(),context:s,suggestions:a.suggestions};return this.conversationHistory.push(n),n}async draftMaintenanceEmail(e,s,t,a){const n=`Draft a professional email to ${a} requesting ${s} for vehicle ${e}. The urgency is ${t}. Include a request for cost estimate and timeline.`,r=(await(window.spark?.llm(n))??"").split("\n");return{subject:r[0]?.replace("Subject:","").trim()??"",body:r.slice(2).join("\n").trim()??""}}async summarizeMaintenanceHistory(e){const s=`Summarize this maintenance history in 2-3 sentences, highlighting patterns and recommendations: ${e.map(e=>`${e.serviceType} on ${e.createdDate} - ${e.status} - $${e.cost||0}`).join("; ")}`;return await(window.spark?.llm(s))??""}async analyzeReceipt(e){const s=`Analyze this receipt and extract: category, total amount, vendor name, and line items. Return as JSON. Receipt text: ${e}`,t=await(window.spark?.llm(s,"gpt-4o-mini",!0))??"{}",a=JSON.parse(t||"{}");return{category:a.category||"unknown",amount:parseFloat(a.amount||"0")||0,vendor:a.vendor||"Unknown Vendor",items:a.items||[],confidence:a.confidence||.8}}async suggestVendor(e,s,t){const a=`Suggest 3 vendor options for ${e} near ${s} with budget around $${t}. Return as JSON with array of vendors containing vendorName, reason, and estimatedCost.`,n=await(window.spark?.llm(a,"gpt-4o-mini",!0))??"{}";return JSON.parse(n||"{}").vendors||[]}async generateMaintenanceRecommendations(e){const s=`Based on vehicle data - Mileage: ${e.mileage}, Last Service: ${e.lastService}, Age: ${e.age} years, Type: ${e.type} - provide 3-5 specific maintenance recommendations as a JSON array.`,t=await(window.spark?.llm(s,"gpt-4o-mini",!0))??"{}";return JSON.parse(t||"{}").recommendations||[]}async draftTeamsAnnouncement(e,s,t){const a=`Create a Microsoft Teams announcement about ${e}. Details: ${s}. Urgency level: ${t}. Use appropriate formatting and emojis. Keep it professional but engaging.`;return await(window.spark?.llm(a))??""}async translateError(e){const s=`Explain vehicle diagnostic error code ${e} in simple terms and provide troubleshooting steps. Return as JSON with 'explanation' and 'steps' array.`,t=await(window.spark?.llm(s,"gpt-4o-mini",!0))??"{}",a=JSON.parse(t||"{}");return{explanation:a.explanation||"",steps:a.steps||[]}}async optimizePurchaseOrder(e){const s=`Analyze these parts orders and suggest optimization: ${e.map(e=>`${e.part} (qty: ${e.quantity}, urgency: ${e.urgency})`).join("; ")}. Return as JSON with 'suggestion' string and 'consolidatedOrders' array.`,t=await(window.spark?.llm(s,"gpt-4o-mini",!0))??"{}",a=JSON.parse(t||"{}");return{suggestion:a.suggestion||"",consolidatedOrders:a.consolidatedOrders||[]}}async generateResponse(e,s){const t=e.toLowerCase();return t.includes("maintenance")&&s?.vehicleId?{content:"I can help you with vehicle maintenance. Would you like me to:\n• Check the maintenance history\n• Schedule a service appointment\n• Draft an email to a vendor\n• Generate a maintenance report",suggestions:["Show maintenance history","Schedule service","Contact vendor","Generate report"]}:t.includes("vendor")||t.includes("contact")?{content:"I can assist with vendor communications. I can:\n• Draft professional emails\n• Create purchase orders\n• Schedule appointments\n• Track vendor responses",suggestions:["Draft email to vendor","Create purchase order","View vendor contacts","Check vendor ratings"]}:t.includes("report")||t.includes("analytics")?{content:"I can generate various reports:\n• Maintenance history reports\n• Fuel consumption analysis\n• Cost breakdown by vehicle\n• Fleet utilization metrics\n\nWhich report would you like?",suggestions:["Maintenance report","Fuel analysis","Cost report","Utilization metrics"]}:t.includes("schedule")||t.includes("appointment")?{content:"I can help schedule maintenance appointments. Please provide:\n• Vehicle ID\n• Service type needed\n• Preferred date/time\n• Vendor preference (optional)",suggestions:["Schedule oil change","Schedule tire rotation","Schedule inspection","View scheduled services"]}:{content:"I'm your Fleet Management AI Assistant. I can help you with:\n• Vehicle maintenance scheduling\n• Vendor communications\n• Report generation\n• Receipt processing\n• Parts inventory\n\nWhat would you like help with?",suggestions:["Schedule maintenance","Contact vendor","Generate report","Process receipt"]}}getConversationHistory(){return this.conversationHistory}clearHistory(){this.conversationHistory=[]}};export{e as ReceiptProcessing};
