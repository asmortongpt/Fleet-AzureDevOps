<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleet Management API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .endpoint {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }
        .endpoint-name {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .endpoint-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .endpoint-status.ok {
            background: #28a745;
            color: white;
        }
        .endpoint-status.loading {
            background: #ffc107;
            color: #333;
        }
        .endpoint-status.failed {
            background: #dc3545;
            color: white;
        }
        .data-preview {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 100px;
            overflow: auto;
        }
        .test-button {
            display: block;
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        .test-button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Fleet Management API Test</h1>
        
        <div id="health-status" class="status">
            Testing API connection...
        </div>

        <div id="endpoints"></div>

        <button class="test-button" onclick="testAllEndpoints()">üîÑ Re-test All Endpoints</button>
    </div>

    <script>
        const API_BASE = 'http://172.173.175.71:3001';
        
        const endpoints = [
            { name: 'Health Check', path: '/health' },
            { name: 'Vehicles', path: '/api/vehicles' },
            { name: 'Drivers', path: '/api/drivers' },
            { name: 'Work Orders', path: '/api/work-orders' },
            { name: 'Fuel Transactions', path: '/api/fuel-transactions' },
            { name: 'Routes', path: '/api/routes' },
            { name: 'Facilities', path: '/api/facilities' },
            { name: 'Inspections', path: '/api/inspections' },
            { name: 'Incidents', path: '/api/incidents' },
            { name: 'GPS Tracks', path: '/api/gps-tracks' }
        ];

        async function testEndpoint(endpoint) {
            try {
                const response = await fetch(API_BASE + endpoint.path);
                const data = await response.json();
                return {
                    success: true,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        async function testAllEndpoints() {
            const healthStatus = document.getElementById('health-status');
            const endpointsDiv = document.getElementById('endpoints');
            
            // Test health first
            healthStatus.className = 'status';
            healthStatus.textContent = 'Testing API connection...';
            
            const healthResult = await testEndpoint({ path: '/health' });
            
            if (healthResult.success) {
                healthStatus.className = 'status success';
                healthStatus.innerHTML = '‚úÖ API Connected Successfully<br><small>Server: ' + API_BASE + '</small>';
            } else {
                healthStatus.className = 'status error';
                healthStatus.innerHTML = '‚ùå API Connection Failed<br><small>' + healthResult.error + '</small>';
                return;
            }

            // Test all endpoints
            endpointsDiv.innerHTML = '<h2 style="margin-top: 20px;">API Endpoints</h2>';
            
            for (const endpoint of endpoints) {
                const div = document.createElement('div');
                div.className = 'endpoint';
                div.innerHTML = `
                    <div class="endpoint-name">${endpoint.name}</div>
                    <span class="endpoint-status loading">Testing...</span>
                    <div class="data-preview" id="preview-${endpoint.path}"></div>
                `;
                endpointsDiv.appendChild(div);

                const result = await testEndpoint(endpoint);
                const statusSpan = div.querySelector('.endpoint-status');
                const preview = div.querySelector('.data-preview');
                
                if (result.success) {
                    statusSpan.className = 'endpoint-status ok';
                    statusSpan.textContent = `‚úì ${result.status}`;
                    
                    const dataCount = result.data.data ? result.data.data.length : 'N/A';
                    const previewText = JSON.stringify(result.data, null, 2).substring(0, 200);
                    preview.textContent = `Records: ${dataCount}\n${previewText}...`;
                } else {
                    statusSpan.className = 'endpoint-status failed';
                    statusSpan.textContent = `‚úó Failed`;
                    preview.textContent = `Error: ${result.error}`;
                }
            }
        }

        // Auto-test on load
        window.addEventListener('load', testAllEndpoints);
    </script>
</body>
</html>
