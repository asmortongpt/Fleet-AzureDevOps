/**
 * Playwright E2E Test Suite - Fleet Management
 * Generated by UI Completeness Orchestrator
 * Base URL: https://fleet.capitaltechalliance.com
 * Total Tests: 19
 */

import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

// Configure test timeout
test.setTimeout(30000);


// ========== NAVIGATION TESTS ==========

test.describe('Dashboard Page Navigation', () => {
  test('should navigate to Dashboard page', async ({ page }) => {
    // Navigate to the page
    await page.goto('https://fleet.capitaltechalliance.com/');
    // Wait for page to load
    await page.waitForLoadState('networkidle');
    // Verify URL
    expect(page.url()).toContain('/');
    // Verify page is visible and interactive
    await expect(page.locator('body')).toBeVisible();
    // Take screenshot for visual regression
    await page.screenshot({ path: 'screenshots/dashboard.png', fullPage: true });
  });
  test('should have correct page title and meta', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/');
    // Check if page has proper title
    const title = await page.title();
    expect(title).toBeTruthy();
    expect(title).toContain('Fleet Management');
  });
  test('should load without console errors', async ({ page }) => {
    const consoleErrors: string[] = [];
    page.on('console', (msg) => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text());
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/');
    await page.waitForLoadState('networkidle');
    // Allow known non-critical errors (customize as needed)
    const criticalErrors = consoleErrors.filter(
      err => !err.includes('DevTools') && !err.includes('analytics')
    );
    expect(criticalErrors).toHaveLength(0);
  });
});

test.describe('Vehicles Page Navigation', () => {
  test('should navigate to Vehicles page', async ({ page }) => {
    // Navigate to the page
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    // Wait for page to load
    await page.waitForLoadState('networkidle');
    // Verify URL
    expect(page.url()).toContain('/vehicles');
    // Verify page is visible and interactive
    await expect(page.locator('body')).toBeVisible();
    // Take screenshot for visual regression
    await page.screenshot({ path: 'screenshots/vehicles.png', fullPage: true });
  });
  test('should have correct page title and meta', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    // Check if page has proper title
    const title = await page.title();
    expect(title).toBeTruthy();
    expect(title).toContain('Fleet Management');
  });
  test('should load without console errors', async ({ page }) => {
    const consoleErrors: string[] = [];
    page.on('console', (msg) => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text());
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    await page.waitForLoadState('networkidle');
    // Allow known non-critical errors (customize as needed)
    const criticalErrors = consoleErrors.filter(
      err => !err.includes('DevTools') && !err.includes('analytics')
    );
    expect(criticalErrors).toHaveLength(0);
  });
});

test.describe('Drivers Page Navigation', () => {
  test('should navigate to Drivers page', async ({ page }) => {
    // Navigate to the page
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    // Wait for page to load
    await page.waitForLoadState('networkidle');
    // Verify URL
    expect(page.url()).toContain('/drivers');
    // Verify page is visible and interactive
    await expect(page.locator('body')).toBeVisible();
    // Take screenshot for visual regression
    await page.screenshot({ path: 'screenshots/drivers.png', fullPage: true });
  });
  test('should have correct page title and meta', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    // Check if page has proper title
    const title = await page.title();
    expect(title).toBeTruthy();
    expect(title).toContain('Fleet Management');
  });
  test('should load without console errors', async ({ page }) => {
    const consoleErrors: string[] = [];
    page.on('console', (msg) => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text());
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    await page.waitForLoadState('networkidle');
    // Allow known non-critical errors (customize as needed)
    const criticalErrors = consoleErrors.filter(
      err => !err.includes('DevTools') && !err.includes('analytics')
    );
    expect(criticalErrors).toHaveLength(0);
  });
});

test.describe('Reports Page Navigation', () => {
  test('should navigate to Reports page', async ({ page }) => {
    // Navigate to the page
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    // Wait for page to load
    await page.waitForLoadState('networkidle');
    // Verify URL
    expect(page.url()).toContain('/reports');
    // Verify page is visible and interactive
    await expect(page.locator('body')).toBeVisible();
    // Take screenshot for visual regression
    await page.screenshot({ path: 'screenshots/reports.png', fullPage: true });
  });
  test('should have correct page title and meta', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    // Check if page has proper title
    const title = await page.title();
    expect(title).toBeTruthy();
    expect(title).toContain('Fleet Management');
  });
  test('should load without console errors', async ({ page }) => {
    const consoleErrors: string[] = [];
    page.on('console', (msg) => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text());
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    await page.waitForLoadState('networkidle');
    // Allow known non-critical errors (customize as needed)
    const criticalErrors = consoleErrors.filter(
      err => !err.includes('DevTools') && !err.includes('analytics')
    );
    expect(criticalErrors).toHaveLength(0);
  });
});

test.describe('Safety Page Navigation', () => {
  test('should navigate to Safety page', async ({ page }) => {
    // Navigate to the page
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    // Wait for page to load
    await page.waitForLoadState('networkidle');
    // Verify URL
    expect(page.url()).toContain('/safety');
    // Verify page is visible and interactive
    await expect(page.locator('body')).toBeVisible();
    // Take screenshot for visual regression
    await page.screenshot({ path: 'screenshots/safety.png', fullPage: true });
  });
  test('should have correct page title and meta', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    // Check if page has proper title
    const title = await page.title();
    expect(title).toBeTruthy();
    expect(title).toContain('Fleet Management');
  });
  test('should load without console errors', async ({ page }) => {
    const consoleErrors: string[] = [];
    page.on('console', (msg) => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text());
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    await page.waitForLoadState('networkidle');
    // Allow known non-critical errors (customize as needed)
    const criticalErrors = consoleErrors.filter(
      err => !err.includes('DevTools') && !err.includes('analytics')
    );
    expect(criticalErrors).toHaveLength(0);
  });
});


// ========== ACCESSIBILITY TESTS ==========

test.describe('Accessibility Tests - Dashboard', () => {
  test('should pass WCAG 2.2 AA accessibility checks on Dashboard', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/');
    await page.waitForLoadState('networkidle');
    // Run axe accessibility scan
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa'])
      .analyze();
    // Assert no violations
    expect(accessibilityScanResults.violations).toEqual([]);
  });
  test('should have proper ARIA labels on Dashboard', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/');
    // Check for ARIA labels on interactive elements
    const buttons = await page.locator('button').all();
    for (const button of buttons) {
      const ariaLabel = await button.getAttribute('aria-label');
      const text = await button.textContent();
      expect(ariaLabel || text).toBeTruthy();
    }
  });
  test('should support keyboard navigation on Dashboard', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/');
    // Test tab navigation
    await page.keyboard.press('Tab');
    const focusedElement = await page.evaluate(() => document.activeElement?.tagName);
    expect(focusedElement).toBeTruthy();
    // Verify focus is visible
    const hasFocusIndicator = await page.evaluate(() => {
      const element = document.activeElement;
      if (!element) return false;
      const styles = window.getComputedStyle(element);
      return styles.outline !== 'none' || styles.boxShadow !== 'none';
    });
    expect(hasFocusIndicator).toBeTruthy();
  });
});

test.describe('Accessibility Tests - Vehicles', () => {
  test('should pass WCAG 2.2 AA accessibility checks on Vehicles', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    await page.waitForLoadState('networkidle');
    // Run axe accessibility scan
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa'])
      .analyze();
    // Assert no violations
    expect(accessibilityScanResults.violations).toEqual([]);
  });
  test('should have proper ARIA labels on Vehicles', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    // Check for ARIA labels on interactive elements
    const buttons = await page.locator('button').all();
    for (const button of buttons) {
      const ariaLabel = await button.getAttribute('aria-label');
      const text = await button.textContent();
      expect(ariaLabel || text).toBeTruthy();
    }
  });
  test('should support keyboard navigation on Vehicles', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    // Test tab navigation
    await page.keyboard.press('Tab');
    const focusedElement = await page.evaluate(() => document.activeElement?.tagName);
    expect(focusedElement).toBeTruthy();
    // Verify focus is visible
    const hasFocusIndicator = await page.evaluate(() => {
      const element = document.activeElement;
      if (!element) return false;
      const styles = window.getComputedStyle(element);
      return styles.outline !== 'none' || styles.boxShadow !== 'none';
    });
    expect(hasFocusIndicator).toBeTruthy();
  });
});

test.describe('Accessibility Tests - Drivers', () => {
  test('should pass WCAG 2.2 AA accessibility checks on Drivers', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    await page.waitForLoadState('networkidle');
    // Run axe accessibility scan
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa'])
      .analyze();
    // Assert no violations
    expect(accessibilityScanResults.violations).toEqual([]);
  });
  test('should have proper ARIA labels on Drivers', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    // Check for ARIA labels on interactive elements
    const buttons = await page.locator('button').all();
    for (const button of buttons) {
      const ariaLabel = await button.getAttribute('aria-label');
      const text = await button.textContent();
      expect(ariaLabel || text).toBeTruthy();
    }
  });
  test('should support keyboard navigation on Drivers', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    // Test tab navigation
    await page.keyboard.press('Tab');
    const focusedElement = await page.evaluate(() => document.activeElement?.tagName);
    expect(focusedElement).toBeTruthy();
    // Verify focus is visible
    const hasFocusIndicator = await page.evaluate(() => {
      const element = document.activeElement;
      if (!element) return false;
      const styles = window.getComputedStyle(element);
      return styles.outline !== 'none' || styles.boxShadow !== 'none';
    });
    expect(hasFocusIndicator).toBeTruthy();
  });
});

test.describe('Accessibility Tests - Reports', () => {
  test('should pass WCAG 2.2 AA accessibility checks on Reports', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    await page.waitForLoadState('networkidle');
    // Run axe accessibility scan
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa'])
      .analyze();
    // Assert no violations
    expect(accessibilityScanResults.violations).toEqual([]);
  });
  test('should have proper ARIA labels on Reports', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    // Check for ARIA labels on interactive elements
    const buttons = await page.locator('button').all();
    for (const button of buttons) {
      const ariaLabel = await button.getAttribute('aria-label');
      const text = await button.textContent();
      expect(ariaLabel || text).toBeTruthy();
    }
  });
  test('should support keyboard navigation on Reports', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    // Test tab navigation
    await page.keyboard.press('Tab');
    const focusedElement = await page.evaluate(() => document.activeElement?.tagName);
    expect(focusedElement).toBeTruthy();
    // Verify focus is visible
    const hasFocusIndicator = await page.evaluate(() => {
      const element = document.activeElement;
      if (!element) return false;
      const styles = window.getComputedStyle(element);
      return styles.outline !== 'none' || styles.boxShadow !== 'none';
    });
    expect(hasFocusIndicator).toBeTruthy();
  });
});

test.describe('Accessibility Tests - Safety', () => {
  test('should pass WCAG 2.2 AA accessibility checks on Safety', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    await page.waitForLoadState('networkidle');
    // Run axe accessibility scan
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa'])
      .analyze();
    // Assert no violations
    expect(accessibilityScanResults.violations).toEqual([]);
  });
  test('should have proper ARIA labels on Safety', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    // Check for ARIA labels on interactive elements
    const buttons = await page.locator('button').all();
    for (const button of buttons) {
      const ariaLabel = await button.getAttribute('aria-label');
      const text = await button.textContent();
      expect(ariaLabel || text).toBeTruthy();
    }
  });
  test('should support keyboard navigation on Safety', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    // Test tab navigation
    await page.keyboard.press('Tab');
    const focusedElement = await page.evaluate(() => document.activeElement?.tagName);
    expect(focusedElement).toBeTruthy();
    // Verify focus is visible
    const hasFocusIndicator = await page.evaluate(() => {
      const element = document.activeElement;
      if (!element) return false;
      const styles = window.getComputedStyle(element);
      return styles.outline !== 'none' || styles.boxShadow !== 'none';
    });
    expect(hasFocusIndicator).toBeTruthy();
  });
});


// ========== PERFORMANCE TESTS ==========

test.describe('Performance Tests - Dashboard', () => {
  test('should meet Core Web Vitals targets on Dashboard', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/');
    // Measure Core Web Vitals
    const webVitals = await page.evaluate(() => {
      return new Promise((resolve) => {
        const vitals: any = {};
        // LCP - Largest Contentful Paint
        new PerformanceObserver((list) => {
          const entries = list.getEntries();
          const lastEntry = entries[entries.length - 1];
          vitals.lcp = lastEntry.renderTime || lastEntry.loadTime;
        }).observe({ entryTypes: ['largest-contentful-paint'] });
        // CLS - Cumulative Layout Shift
        let clsValue = 0;
        new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!(entry as any).hadRecentInput) {
              clsValue += (entry as any).value;
            }
          }
          vitals.cls = clsValue;
        }).observe({ entryTypes: ['layout-shift'] });
        // Wait for page to be fully loaded
        setTimeout(() => {
          // FCP - First Contentful Paint
          const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0];
          vitals.fcp = fcpEntry ? (fcpEntry as PerformancePaintTiming).startTime : 0;
          resolve(vitals);
        }, 5000);
      });
    });
    console.log('Core Web Vitals:', webVitals);
    // Assert Core Web Vitals targets
    // LCP should be < 2.5s
    expect((webVitals as any).lcp).toBeLessThan(2500);
    // CLS should be < 0.1
    expect((webVitals as any).cls).toBeLessThan(0.1);
    // FCP should be < 1.8s
    expect((webVitals as any).fcp).toBeLessThan(1800);
  });
  test('should load all resources efficiently on Dashboard', async ({ page }) => {
    const resourceSizes: number[] = [];
    page.on('response', (response) => {
      const headers = response.headers();
      const contentLength = headers['content-length'];
      if (contentLength) {
        resourceSizes.push(parseInt(contentLength));
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/');
    await page.waitForLoadState('networkidle');
    // Calculate total page weight
    const totalSize = resourceSizes.reduce((a, b) => a + b, 0);
    const totalSizeMB = totalSize / (1024 * 1024);
    console.log(`Total page weight: ${totalSizeMB.toFixed(2)} MB`);
    // Assert page weight is reasonable (< 5MB for initial load)
    expect(totalSizeMB).toBeLessThan(5);
  });
});

test.describe('Performance Tests - Vehicles', () => {
  test('should meet Core Web Vitals targets on Vehicles', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    // Measure Core Web Vitals
    const webVitals = await page.evaluate(() => {
      return new Promise((resolve) => {
        const vitals: any = {};
        // LCP - Largest Contentful Paint
        new PerformanceObserver((list) => {
          const entries = list.getEntries();
          const lastEntry = entries[entries.length - 1];
          vitals.lcp = lastEntry.renderTime || lastEntry.loadTime;
        }).observe({ entryTypes: ['largest-contentful-paint'] });
        // CLS - Cumulative Layout Shift
        let clsValue = 0;
        new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!(entry as any).hadRecentInput) {
              clsValue += (entry as any).value;
            }
          }
          vitals.cls = clsValue;
        }).observe({ entryTypes: ['layout-shift'] });
        // Wait for page to be fully loaded
        setTimeout(() => {
          // FCP - First Contentful Paint
          const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0];
          vitals.fcp = fcpEntry ? (fcpEntry as PerformancePaintTiming).startTime : 0;
          resolve(vitals);
        }, 5000);
      });
    });
    console.log('Core Web Vitals:', webVitals);
    // Assert Core Web Vitals targets
    // LCP should be < 2.5s
    expect((webVitals as any).lcp).toBeLessThan(2500);
    // CLS should be < 0.1
    expect((webVitals as any).cls).toBeLessThan(0.1);
    // FCP should be < 1.8s
    expect((webVitals as any).fcp).toBeLessThan(1800);
  });
  test('should load all resources efficiently on Vehicles', async ({ page }) => {
    const resourceSizes: number[] = [];
    page.on('response', (response) => {
      const headers = response.headers();
      const contentLength = headers['content-length'];
      if (contentLength) {
        resourceSizes.push(parseInt(contentLength));
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    await page.waitForLoadState('networkidle');
    // Calculate total page weight
    const totalSize = resourceSizes.reduce((a, b) => a + b, 0);
    const totalSizeMB = totalSize / (1024 * 1024);
    console.log(`Total page weight: ${totalSizeMB.toFixed(2)} MB`);
    // Assert page weight is reasonable (< 5MB for initial load)
    expect(totalSizeMB).toBeLessThan(5);
  });
});

test.describe('Performance Tests - Drivers', () => {
  test('should meet Core Web Vitals targets on Drivers', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    // Measure Core Web Vitals
    const webVitals = await page.evaluate(() => {
      return new Promise((resolve) => {
        const vitals: any = {};
        // LCP - Largest Contentful Paint
        new PerformanceObserver((list) => {
          const entries = list.getEntries();
          const lastEntry = entries[entries.length - 1];
          vitals.lcp = lastEntry.renderTime || lastEntry.loadTime;
        }).observe({ entryTypes: ['largest-contentful-paint'] });
        // CLS - Cumulative Layout Shift
        let clsValue = 0;
        new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!(entry as any).hadRecentInput) {
              clsValue += (entry as any).value;
            }
          }
          vitals.cls = clsValue;
        }).observe({ entryTypes: ['layout-shift'] });
        // Wait for page to be fully loaded
        setTimeout(() => {
          // FCP - First Contentful Paint
          const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0];
          vitals.fcp = fcpEntry ? (fcpEntry as PerformancePaintTiming).startTime : 0;
          resolve(vitals);
        }, 5000);
      });
    });
    console.log('Core Web Vitals:', webVitals);
    // Assert Core Web Vitals targets
    // LCP should be < 2.5s
    expect((webVitals as any).lcp).toBeLessThan(2500);
    // CLS should be < 0.1
    expect((webVitals as any).cls).toBeLessThan(0.1);
    // FCP should be < 1.8s
    expect((webVitals as any).fcp).toBeLessThan(1800);
  });
  test('should load all resources efficiently on Drivers', async ({ page }) => {
    const resourceSizes: number[] = [];
    page.on('response', (response) => {
      const headers = response.headers();
      const contentLength = headers['content-length'];
      if (contentLength) {
        resourceSizes.push(parseInt(contentLength));
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/drivers');
    await page.waitForLoadState('networkidle');
    // Calculate total page weight
    const totalSize = resourceSizes.reduce((a, b) => a + b, 0);
    const totalSizeMB = totalSize / (1024 * 1024);
    console.log(`Total page weight: ${totalSizeMB.toFixed(2)} MB`);
    // Assert page weight is reasonable (< 5MB for initial load)
    expect(totalSizeMB).toBeLessThan(5);
  });
});

test.describe('Performance Tests - Reports', () => {
  test('should meet Core Web Vitals targets on Reports', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    // Measure Core Web Vitals
    const webVitals = await page.evaluate(() => {
      return new Promise((resolve) => {
        const vitals: any = {};
        // LCP - Largest Contentful Paint
        new PerformanceObserver((list) => {
          const entries = list.getEntries();
          const lastEntry = entries[entries.length - 1];
          vitals.lcp = lastEntry.renderTime || lastEntry.loadTime;
        }).observe({ entryTypes: ['largest-contentful-paint'] });
        // CLS - Cumulative Layout Shift
        let clsValue = 0;
        new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!(entry as any).hadRecentInput) {
              clsValue += (entry as any).value;
            }
          }
          vitals.cls = clsValue;
        }).observe({ entryTypes: ['layout-shift'] });
        // Wait for page to be fully loaded
        setTimeout(() => {
          // FCP - First Contentful Paint
          const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0];
          vitals.fcp = fcpEntry ? (fcpEntry as PerformancePaintTiming).startTime : 0;
          resolve(vitals);
        }, 5000);
      });
    });
    console.log('Core Web Vitals:', webVitals);
    // Assert Core Web Vitals targets
    // LCP should be < 2.5s
    expect((webVitals as any).lcp).toBeLessThan(2500);
    // CLS should be < 0.1
    expect((webVitals as any).cls).toBeLessThan(0.1);
    // FCP should be < 1.8s
    expect((webVitals as any).fcp).toBeLessThan(1800);
  });
  test('should load all resources efficiently on Reports', async ({ page }) => {
    const resourceSizes: number[] = [];
    page.on('response', (response) => {
      const headers = response.headers();
      const contentLength = headers['content-length'];
      if (contentLength) {
        resourceSizes.push(parseInt(contentLength));
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/reports');
    await page.waitForLoadState('networkidle');
    // Calculate total page weight
    const totalSize = resourceSizes.reduce((a, b) => a + b, 0);
    const totalSizeMB = totalSize / (1024 * 1024);
    console.log(`Total page weight: ${totalSizeMB.toFixed(2)} MB`);
    // Assert page weight is reasonable (< 5MB for initial load)
    expect(totalSizeMB).toBeLessThan(5);
  });
});

test.describe('Performance Tests - Safety', () => {
  test('should meet Core Web Vitals targets on Safety', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    // Measure Core Web Vitals
    const webVitals = await page.evaluate(() => {
      return new Promise((resolve) => {
        const vitals: any = {};
        // LCP - Largest Contentful Paint
        new PerformanceObserver((list) => {
          const entries = list.getEntries();
          const lastEntry = entries[entries.length - 1];
          vitals.lcp = lastEntry.renderTime || lastEntry.loadTime;
        }).observe({ entryTypes: ['largest-contentful-paint'] });
        // CLS - Cumulative Layout Shift
        let clsValue = 0;
        new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!(entry as any).hadRecentInput) {
              clsValue += (entry as any).value;
            }
          }
          vitals.cls = clsValue;
        }).observe({ entryTypes: ['layout-shift'] });
        // Wait for page to be fully loaded
        setTimeout(() => {
          // FCP - First Contentful Paint
          const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0];
          vitals.fcp = fcpEntry ? (fcpEntry as PerformancePaintTiming).startTime : 0;
          resolve(vitals);
        }, 5000);
      });
    });
    console.log('Core Web Vitals:', webVitals);
    // Assert Core Web Vitals targets
    // LCP should be < 2.5s
    expect((webVitals as any).lcp).toBeLessThan(2500);
    // CLS should be < 0.1
    expect((webVitals as any).cls).toBeLessThan(0.1);
    // FCP should be < 1.8s
    expect((webVitals as any).fcp).toBeLessThan(1800);
  });
  test('should load all resources efficiently on Safety', async ({ page }) => {
    const resourceSizes: number[] = [];
    page.on('response', (response) => {
      const headers = response.headers();
      const contentLength = headers['content-length'];
      if (contentLength) {
        resourceSizes.push(parseInt(contentLength));
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/safety');
    await page.waitForLoadState('networkidle');
    // Calculate total page weight
    const totalSize = resourceSizes.reduce((a, b) => a + b, 0);
    const totalSizeMB = totalSize / (1024 * 1024);
    console.log(`Total page weight: ${totalSizeMB.toFixed(2)} MB`);
    // Assert page weight is reasonable (< 5MB for initial load)
    expect(totalSizeMB).toBeLessThan(5);
  });
});


// ========== INTERACTION TESTS ==========

test.describe('UI Interaction Tests', () => {
  test('should display interactive Leaflet map on dashboard', async ({ page }) => {
    await page.goto('https://fleet.capitaltechalliance.com/');
    await page.waitForLoadState('networkidle');
    // Locate the element
    const element = page.locator('[data-testid='map-container'], .leaflet-container');
    await expect(element).toBeVisible();
    // Perform interaction
    await element.click();
    await page.waitForLoadState('networkidle');
    // Verify expected result
    // Map should be interactive and show vehicle markers
    await page.waitForTimeout(500); // Allow for state updates
    // Take screenshot of result
    await page.screenshot({ path: 'screenshots/interaction-should-display-interactive-leaflet-map-on-dashboard.png' });
  });
});


// ========== WORKFLOW TESTS ==========

test.describe('Vehicle Management Workflow', () => {
  test('should complete Vehicle Management workflow', async ({ page }) => {
    // Step 1: Navigate to vehicles page
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('h1')).toContainText('Vehicle');
    await page.screenshot({ path: 'screenshots/workflow-vehicle-management-step1.png' });
    // Step 2: Click add vehicle button
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    await page.waitForLoadState('networkidle');
    await page.locator('button:has-text("Add Vehicle")').click();
    await expect(page.locator('[role="dialog"]')).toBeVisible();
    await page.screenshot({ path: 'screenshots/workflow-vehicle-management-step2.png' });
    // Step 3: Fill vehicle form
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    await page.waitForLoadState('networkidle');
    await page.locator('input[name="vin"]').fill('1HGCM82633A004352');
    await page.screenshot({ path: 'screenshots/workflow-vehicle-management-step3.png' });
  });
});


// ========== ANALYTICS TESTS ==========

test.describe('Analytics Event Tracking', () => {
  test('should track page_view analytics event', async ({ page }) => {
    // Listen for analytics calls
    const analyticsEvents: any[] = [];
    page.on('request', (request) => {
      const url = request.url();
      // Track Application Insights calls
      if (url.includes('dc.services.visualstudio.com') || url.includes('analytics')) {
        analyticsEvents.push({
          url,
          method: request.method(),
          postData: request.postData()
        });
      }
    });
    await page.goto('https://fleet.capitaltechalliance.com/');
    await page.waitForLoadState('networkidle');
    // Trigger the action that should fire the event
    // Page view should be tracked automatically
    // Wait for analytics to be sent
    await page.waitForTimeout(1000);
    // Verify event was tracked
    const eventFound = analyticsEvents.some(event => {
      return event.postData?.includes('page_view');
    });
    expect(eventFound).toBeTruthy();
  });
});


// ========== ERROR TESTS ==========

test.describe('Error Handling Tests', () => {
  test('should handle API timeout gracefully', async ({ page }) => {
    // Set up error condition: API timeout
    await page.route('**/api/**', route => {
      // Simulate API error
      route.abort('failed');
    });
    await page.goto('https://fleet.capitaltechalliance.com/vehicles');
    // Verify error is handled gracefully
    // Should show error message and retry option
    // Should show user-friendly error message
    const errorMessage = page.locator('[role="alert"], .error-message');
    await expect(errorMessage).toBeVisible({ timeout: 5000 });
    // Should not show stack traces or technical errors
    const bodyText = await page.textContent('body');
    expect(bodyText).not.toContain('undefined');
    expect(bodyText).not.toContain('null is not');
    expect(bodyText).not.toContain('Cannot read property');
  });
});

