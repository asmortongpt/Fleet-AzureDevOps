# Example Policy Definitions for Radio Fleet Dispatch
# These demonstrate the YAML policy format supported by the policy worker

# Policy 1: High Priority Fire Response
high_priority_fire:
  name: "High Priority Fire Response"
  description: "Auto-create incident for high-priority fire-related transmissions"
  enabled: true
  conditions:
    all:
      - field: priority
        operator: equals
        value: high
      - field: tags
        operator: contains
        value: "code:code_3"
      - field: entities.incident_codes
        operator: contains_any
        value: ["code 3", "code red"]
  actions:
    - type: create_incident
      params:
        incident_type: fire
        priority: high
        assign_units: true
    - type: notify
      params:
        channels: [sms, email]
        recipients: [dispatcher, fire_chief]
        template: high_priority_fire

# Policy 2: Officer Assistance Request
officer_assistance:
  name: "Officer Assistance Request"
  description: "Escalate when officer requests backup"
  enabled: true
  conditions:
    any:
      - field: transcript
        operator: contains
        value: "need backup"
      - field: transcript
        operator: contains
        value: "officer down"
      - field: intent.primary
        operator: equals
        value: request_assistance
  actions:
    - type: escalate
      params:
        priority: urgent
        notify: [supervisor, shift_commander]
    - type: create_task
      params:
        task_type: dispatch_backup
        priority: high

# Policy 3: Multiple Victims Incident
multiple_victims:
  name: "Multiple Victims Incident"
  description: "Trigger mass casualty protocol for incidents with multiple victims"
  enabled: true
  conditions:
    all:
      - field: entities.personnel_count
        operator: greater_than
        value: 3
      - field: priority
        operator: equals
        value: high
  actions:
    - type: create_incident
      params:
        incident_type: mass_casualty
        priority: critical
    - type: notify
      params:
        channels: [sms, email, push]
        recipients: [ems_supervisor, hospital_coordinator, incident_commander]
        template: mass_casualty_alert
    - type: assign_unit
      params:
        unit_types: [medic, rescue, ambulance]
        count: 3

# Policy 4: En Route Status Update
en_route_update:
  name: "En Route Status Update"
  description: "Auto-update unit status when reporting en route"
  enabled: true
  conditions:
    all:
      - field: intent.primary
        operator: equals
        value: status_update
      - field: entities.statuses
        operator: contains
        value: "en route"
      - field: entities.unit_ids
        operator: contains_any
        value: []  # Any unit ID
  actions:
    - type: update_status
      params:
        status: en_route
        update_timestamp: true
    - type: log_event
      params:
        event_type: status_change
        metadata:
          from_status: dispatched
          to_status: en_route

# Policy 5: Low Confidence Transcription Review
low_confidence_review:
  name: "Low Confidence Transcription Review"
  description: "Flag transmissions with low transcription confidence for manual review"
  enabled: true
  conditions:
    all:
      - field: confidence_score
        operator: less_than
        value: 0.7
      - field: priority
        operator: equals
        value: high
  actions:
    - type: create_task
      params:
        task_type: manual_review
        priority: medium
        description: "Review low-confidence high-priority transmission"
    - type: notify
      params:
        channels: [email]
        recipients: [qa_team]
        template: low_confidence_alert

# Policy 6: Incident Location Confirmation
location_confirmation:
  name: "Incident Location Confirmation"
  description: "Request location confirmation if no location detected in transmission"
  enabled: true
  conditions:
    all:
      - field: tags
        operator: not_contains
        value: "has:location"
      - field: intent.primary
        operator: equals
        value: incident_report
      - field: priority
        operator: contains_any
        value: [high, medium]
  actions:
    - type: create_task
      params:
        task_type: request_location
        priority: high
        description: "Request location clarification from unit"
    - type: notify
      params:
        channels: [radio]
        recipients: [transmitting_unit]
        template: location_request

# Policy 7: Automatic Unit Assignment
auto_unit_assignment:
  name: "Automatic Unit Assignment"
  description: "Auto-assign nearest available unit for emergency calls"
  enabled: false  # Disabled by default - requires autonomous_assist mode
  conditions:
    all:
      - field: priority
        operator: equals
        value: high
      - field: intent.primary
        operator: equals
        value: dispatch
      - field: tags
        operator: contains
        value: "has:location"
  actions:
    - type: assign_unit
      params:
        assignment_strategy: nearest_available
        unit_types: [patrol, rescue]
        max_distance_miles: 10
    - type: notify
      params:
        channels: [radio]
        recipients: [assigned_unit]
        template: unit_dispatch

# Policy 8: After-Hours Escalation
after_hours_escalation:
  name: "After-Hours Escalation"
  description: "Escalate high-priority calls received after hours"
  enabled: true
  conditions:
    all:
      - field: priority
        operator: equals
        value: high
      - field: timestamp.hour
        operator: greater_than
        value: 22  # After 10 PM
  actions:
    - type: escalate
      params:
        priority: urgent
        notify: [duty_officer, on_call_supervisor]
    - type: log_event
      params:
        event_type: after_hours_escalation

# Policy 9: Keyword Alert
keyword_alert:
  name: "Keyword Alert"
  description: "Alert for specific high-risk keywords in transmissions"
  enabled: true
  conditions:
    any:
      - field: transcript
        operator: regex_match
        value: "\\b(weapon|gun|knife|explosive)\\b"
      - field: transcript
        operator: regex_match
        value: "\\b(barricaded|hostage|active shooter)\\b"
  actions:
    - type: escalate
      params:
        priority: critical
        notify: [watch_commander, swat_team, incident_commander]
    - type: create_incident
      params:
        incident_type: tactical
        priority: critical
        specialized_units_required: true
    - type: notify
      params:
        channels: [sms, email, push]
        recipients: [all_supervisors]
        template: critical_keyword_alert

# Policy 10: Status Cleared - Return to Service
cleared_status:
  name: "Status Cleared - Return to Service"
  description: "Update unit status when reporting cleared/available"
  enabled: true
  conditions:
    all:
      - field: intent.primary
        operator: equals
        value: status_update
      - field: entities.statuses
        operator: contains_any
        value: ["cleared", "available", "10-8"]
  actions:
    - type: update_status
      params:
        status: available
        clear_current_assignment: true
        update_timestamp: true
    - type: log_event
      params:
        event_type: unit_available

# Notes:
# - Policies are evaluated in order
# - Multiple policies can match a single transmission
# - Actions are executed based on operational mode (monitor_only, hitl, autonomous_assist)
# - All policy evaluations are logged for audit purposes
# - Policies can be enabled/disabled without deletion
